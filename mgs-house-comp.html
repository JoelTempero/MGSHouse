<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MGS House Comp | Middleton Grange School</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=Source+Sans+Pro:wght@300;400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            /* House Colors */
            --shackleton-blue: #1e4a7c;
            --shackleton-light: #3a7bc8;
            --wilson-green: #1a5f3c;
            --wilson-light: #2d9d5f;
            --bowen-red: #8b1e1e;
            --bowen-light: #c73838;
            --scott-yellow: #c4960c;
            --scott-light: #e8b82a;
            
            /* Light Mode (Default) */
            --bg-deep: #f8fafc;
            --bg-dark: #f1f5f9;
            --bg-card: #ffffff;
            --bg-elevated: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --accent-ice: #0284c7;
            --accent-aurora: #7c3aed;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            
            /* Gradients */
            --gradient-ice: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 50%, #e0f2fe 100%);
            --gradient-aurora: linear-gradient(180deg, rgba(124, 58, 237, 0.05) 0%, transparent 50%);
            --aurora-1: rgba(30, 74, 124, 0.08);
            --aurora-2: rgba(26, 95, 60, 0.06);
            --aurora-3: rgba(139, 30, 30, 0.04);
            --grid-color: rgba(2, 132, 199, 0.05);
        }

        /* Dark Mode */
        [data-theme="dark"] {
            --bg-deep: #0a0e14;
            --bg-dark: #0f1419;
            --bg-card: #151b23;
            --bg-elevated: #1c242e;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --border-color: #2d3741;
            --accent-ice: #7dd3fc;
            --accent-aurora: #a78bfa;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.4);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.5);
            
            --gradient-ice: linear-gradient(135deg, #0c1929 0%, #1a2f4a 50%, #0f1f33 100%);
            --gradient-aurora: linear-gradient(180deg, rgba(167, 139, 250, 0.1) 0%, transparent 50%);
            --aurora-1: rgba(30, 74, 124, 0.15);
            --aurora-2: rgba(26, 95, 60, 0.12);
            --aurora-3: rgba(139, 30, 30, 0.08);
            --grid-color: rgba(125, 211, 252, 0.03);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Sans Pro', sans-serif;
            background: var(--bg-deep);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Aurora Background Effect */
        .aurora-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            background: 
                radial-gradient(ellipse 80% 50% at 20% 0%, var(--aurora-1) 0%, transparent 50%),
                radial-gradient(ellipse 60% 40% at 80% 10%, var(--aurora-2) 0%, transparent 50%),
                radial-gradient(ellipse 50% 30% at 50% 90%, var(--aurora-3) 0%, transparent 50%);
            animation: auroraShift 20s ease-in-out infinite;
        }

        @keyframes auroraShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Grid Pattern Overlay */
        .grid-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 1;
        }

        .app-container {
            position: relative;
            z-index: 2;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .theme-toggle {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: var(--accent-ice);
            color: white;
            border-color: var(--accent-ice);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            user-select: none;
        }

        .logo-crest {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-ice) 0%, var(--accent-aurora) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Playfair Display', serif;
            font-weight: 800;
            font-size: 1.2rem;
            color: var(--bg-deep);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .logo-crest:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(125, 211, 252, 0.4);
        }

        .logo-crest.clicked {
            animation: pulse 0.3s ease;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        .logo-text h1 {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .logo-text span {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: 1px solid transparent;
            color: var(--text-secondary);
            font-family: 'Source Sans Pro', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .nav-tab:hover {
            color: var(--text-primary);
            background: var(--bg-card);
        }

        .nav-tab.active {
            color: var(--accent-ice);
            background: rgba(125, 211, 252, 0.1);
            border-color: rgba(125, 211, 252, 0.3);
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Page */
        .dashboard-hero {
            text-align: center;
            margin-bottom: 3rem;
            padding: 3rem 2rem;
            background: var(--gradient-ice);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .dashboard-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M200 50 L220 100 L200 90 L180 100 Z' fill='rgba(125,211,252,0.05)'/%3E%3Cpath d='M100 150 L120 200 L100 190 L80 200 Z' fill='rgba(125,211,252,0.03)'/%3E%3Cpath d='M300 180 L320 230 L300 220 L280 230 Z' fill='rgba(125,211,252,0.04)'/%3E%3C/svg%3E");
            pointer-events: none;
            animation: snowfall 30s linear infinite;
        }

        @keyframes snowfall {
            from { transform: translateY(-10%); }
            to { transform: translateY(10%); }
        }

        .dashboard-hero h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            position: relative;
        }

        .dashboard-hero p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            position: relative;
        }

        .current-year {
            display: inline-block;
            background: rgba(125, 211, 252, 0.15);
            color: var(--accent-ice);
            padding: 0.25rem 1rem;
            border-radius: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            margin-top: 1rem;
            position: relative;
        }

        /* House Standings */
        .standings-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        @media (max-width: 1000px) {
            .standings-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .standings-grid {
                grid-template-columns: 1fr;
            }
        }

        .house-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: var(--shadow-sm);
        }

        .house-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .house-card.shackleton { --house-color: var(--shackleton-blue); --house-light: var(--shackleton-light); }
        .house-card.wilson { --house-color: var(--wilson-green); --house-light: var(--wilson-light); }
        .house-card.bowen { --house-color: var(--bowen-red); --house-light: var(--bowen-light); }
        .house-card.scott { --house-color: var(--scott-yellow); --house-light: var(--scott-light); }

        .house-card.shackleton:hover { box-shadow: var(--shadow-lg), 0 0 0 2px var(--shackleton-light); }
        .house-card.wilson:hover { box-shadow: var(--shadow-lg), 0 0 0 2px var(--wilson-light); }
        .house-card.bowen:hover { box-shadow: var(--shadow-lg), 0 0 0 2px var(--bowen-light); }
        .house-card.scott:hover { box-shadow: var(--shadow-lg), 0 0 0 2px var(--scott-light); }

        .house-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--house-color), var(--house-light));
        }

        .house-rank {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 36px;
            height: 36px;
            background: var(--bg-elevated);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1rem;
            color: var(--house-light);
            border: 2px solid var(--house-color);
        }

        .house-rank.first {
            background: linear-gradient(135deg, #ffd700 0%, #ffb700 100%);
            color: #000;
            border: none;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        }

        .house-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--house-color), var(--house-light));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }

        .house-name {
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .house-explorer {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .house-points {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--house-light);
            margin-bottom: 0.25rem;
        }

        .house-points-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .house-badges {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .badge-count {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .badge-count .icon {
            font-size: 1rem;
        }

        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.75rem;
            font-weight: 700;
        }

        .section-subtitle {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Events Section */
        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .event-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
        }

        .event-card:hover {
            border-color: var(--accent-ice);
            box-shadow: var(--shadow-md);
        }

        .event-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
        }

        .event-status.upcoming {
            background: rgba(125, 211, 252, 0.15);
            color: var(--accent-ice);
        }

        .event-status.completed {
            background: rgba(45, 157, 95, 0.15);
            color: var(--wilson-light);
        }

        .event-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .event-date {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .event-description {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .event-points {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: var(--bg-elevated);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .event-points strong {
            color: var(--scott-light);
            font-family: 'JetBrains Mono', monospace;
        }

        .event-results {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .result-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0;
        }

        .result-house {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .result-house-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .result-house-dot.shackleton { background: var(--shackleton-light); }
        .result-house-dot.wilson { background: var(--wilson-light); }
        .result-house-dot.bowen { background: var(--bowen-light); }
        .result-house-dot.scott { background: var(--scott-light); }

        .result-points {
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-muted);
        }

        /* Awards Page */
        .awards-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .awards-header h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .awards-header p {
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        .awards-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Source Sans Pro', sans-serif;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .filter-btn:hover, .filter-btn.active {
            background: rgba(125, 211, 252, 0.1);
            border-color: var(--accent-ice);
            color: var(--accent-ice);
        }

        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
        }

        .badge-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
            position: relative;
        }

        .badge-card:hover {
            transform: translateY(-3px);
            border-color: var(--accent-aurora);
        }

        .badge-card.earned {
            border-color: rgba(45, 157, 95, 0.5);
        }

        .badge-icon-wrapper {
            width: 70px;
            height: 70px;
            margin: 0 auto 1rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            position: relative;
            background: var(--bg-elevated);
            border: 3px solid var(--border-color);
            transition: all 0.3s;
        }

        .badge-card:hover .badge-icon-wrapper {
            transform: scale(1.1);
        }

        .badge-card[data-category="explorer"] .badge-icon-wrapper {
            border-color: var(--wilson-green);
            background: rgba(26, 95, 60, 0.1);
        }

        .badge-card[data-category="scholar"] .badge-icon-wrapper {
            border-color: var(--shackleton-blue);
            background: rgba(30, 74, 124, 0.1);
        }

        .badge-card[data-category="performer"] .badge-icon-wrapper {
            border-color: var(--accent-aurora);
            background: rgba(167, 139, 250, 0.1);
        }

        .badge-card[data-category="champion"] .badge-icon-wrapper {
            border-color: var(--scott-yellow);
            background: rgba(196, 150, 12, 0.1);
        }

        .badge-card[data-category="disciple"] .badge-icon-wrapper {
            border-color: var(--bowen-red);
            background: rgba(139, 30, 30, 0.1);
        }

        .badge-card.legendary .badge-icon-wrapper {
            border-color: #9b59b6;
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.2) 0%, rgba(255, 215, 0, 0.1) 100%);
            box-shadow: 0 0 15px rgba(155, 89, 182, 0.3);
        }

        /* House of the Week Card */
        .hotw-card {
            background: var(--gradient-ice);
            border-radius: 20px;
            padding: 2rem;
            border: 2px solid var(--border-color);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .hotw-card::before {
            content: 'üèÜ';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 8rem;
            opacity: 0.1;
        }

        .hotw-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .hotw-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            font-weight: 600;
        }

        .hotw-content {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .hotw-house-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: var(--shadow-md);
        }

        .hotw-house-icon.shackleton { background: linear-gradient(135deg, var(--shackleton-blue), var(--shackleton-light)); }
        .hotw-house-icon.wilson { background: linear-gradient(135deg, var(--wilson-green), var(--wilson-light)); }
        .hotw-house-icon.bowen { background: linear-gradient(135deg, var(--bowen-red), var(--bowen-light)); }
        .hotw-house-icon.scott { background: linear-gradient(135deg, var(--scott-yellow), var(--scott-light)); }

        .hotw-info h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.75rem;
            margin-bottom: 0.25rem;
        }

        .hotw-info p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .hotw-stats {
            display: flex;
            gap: 1.5rem;
            margin-left: auto;
        }

        .hotw-stat {
            text-align: center;
        }

        .hotw-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-ice);
        }

        .hotw-stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        /* Streak Badge */
        .streak-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.25rem 0.6rem;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-left: 0.5rem;
        }

        .streak-badge.cold {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
        }

        .streak-multiplier {
            font-family: 'JetBrains Mono', monospace;
            background: rgba(255,255,255,0.2);
            padding: 0.1rem 0.4rem;
            border-radius: 10px;
            font-size: 0.7rem;
        }

        /* House Feed */
        .feed-section {
            margin-top: 3rem;
        }

        .feed-container {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 1.5rem;
        }

        @media (max-width: 900px) {
            .feed-container {
                grid-template-columns: 1fr;
            }
        }

        .feed-main {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .feed-item {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.25rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
            animation: feedSlideIn 0.4s ease;
        }

        @keyframes feedSlideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .feed-item:hover {
            box-shadow: var(--shadow-md);
        }

        .feed-item-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .feed-house-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }

        .feed-house-icon.shackleton { background: linear-gradient(135deg, var(--shackleton-blue), var(--shackleton-light)); }
        .feed-house-icon.wilson { background: linear-gradient(135deg, var(--wilson-green), var(--wilson-light)); }
        .feed-house-icon.bowen { background: linear-gradient(135deg, var(--bowen-red), var(--bowen-light)); }
        .feed-house-icon.scott { background: linear-gradient(135deg, var(--scott-yellow), var(--scott-light)); }

        .feed-item-meta {
            flex: 1;
        }

        .feed-item-house {
            font-weight: 700;
            font-size: 1rem;
        }

        .feed-item-time {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .feed-item-type {
            padding: 0.25rem 0.6rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .feed-item-type.badge { background: rgba(167, 139, 250, 0.15); color: var(--accent-aurora); }
        .feed-item-type.event { background: rgba(45, 157, 95, 0.15); color: var(--wilson-light); }
        .feed-item-type.spirit { background: rgba(2, 132, 199, 0.15); color: var(--accent-ice); }
        .feed-item-type.shoutout { background: rgba(234, 179, 8, 0.15); color: var(--scott-light); }

        .feed-item-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .feed-item-content strong {
            color: var(--text-primary);
        }

        .feed-item-points {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            margin-top: 0.75rem;
            padding: 0.35rem 0.75rem;
            background: var(--bg-elevated);
            border-radius: 20px;
            font-size: 0.85rem;
            font-family: 'JetBrains Mono', monospace;
            color: var(--wilson-light);
        }

        .feed-item-image {
            margin-top: 1rem;
            border-radius: 12px;
            overflow: hidden;
            background: var(--bg-elevated);
        }

        .feed-item-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* Spirit Points Sidebar */
        .spirit-sidebar {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .spirit-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.25rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .spirit-card h4 {
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .spirit-house-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.6rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .spirit-house-row:last-child {
            border-bottom: none;
        }

        .spirit-house-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .spirit-house-dot.shackleton { background: var(--shackleton-light); }
        .spirit-house-dot.wilson { background: var(--wilson-light); }
        .spirit-house-dot.bowen { background: var(--bowen-light); }
        .spirit-house-dot.scott { background: var(--scott-light); }

        .spirit-house-name {
            flex: 1;
            font-weight: 500;
        }

        .spirit-house-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--accent-ice);
        }

        .spirit-progress {
            margin-top: 0.5rem;
        }

        .spirit-progress-bar {
            height: 6px;
            background: var(--bg-elevated);
            border-radius: 3px;
            overflow: hidden;
        }

        .spirit-progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .spirit-progress-fill.shackleton { background: var(--shackleton-light); }
        .spirit-progress-fill.wilson { background: var(--wilson-light); }
        .spirit-progress-fill.bowen { background: var(--bowen-light); }
        .spirit-progress-fill.scott { background: var(--scott-light); }

        .spirit-info {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        /* Top Participants Mini List */
        .top-participants {
            margin-top: 0.5rem;
        }

        .participant-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0;
            font-size: 0.85rem;
        }

        .participant-rank {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--bg-elevated);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--text-muted);
        }

        .participant-rank.gold { background: linear-gradient(135deg, #ffd700, #ffb700); color: #000; }
        .participant-rank.silver { background: linear-gradient(135deg, #c0c0c0, #a0a0a0); color: #000; }
        .participant-rank.bronze { background: linear-gradient(135deg, #cd7f32, #a0522d); color: #fff; }

        .participant-name {
            flex: 1;
            color: var(--text-secondary);
        }

        .participant-events {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Feed Filter Tabs */
        .feed-filters {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .feed-filter {
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
        }

        .feed-filter:hover, .feed-filter.active {
            background: var(--accent-ice);
            color: white;
            border-color: var(--accent-ice);
        }

        /* Legendary Badge Styling */
        .badge-card.legendary {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.1) 0%, rgba(255, 215, 0, 0.1) 100%);
            border: 2px solid rgba(155, 89, 182, 0.5);
            position: relative;
        }

        .badge-card.legendary::before {
            content: 'üëë';
            position: absolute;
            top: -8px;
            right: -8px;
            font-size: 1.2rem;
            background: var(--bg-card);
            border-radius: 50%;
            padding: 2px;
        }

        .badge-card.legendary:hover {
            border-color: rgba(155, 89, 182, 0.8);
            box-shadow: 0 0 20px rgba(155, 89, 182, 0.3);
        }

        .legendary-tag {
            display: inline-block;
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            font-size: 0.65rem;
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
            margin-top: 0.5rem;
            font-weight: 700;
            letter-spacing: 0.05em;
        }

        /* Badge Hunt Section */
        .badge-hunt-section {
            margin-bottom: 2rem;
        }

        .badge-hunt-card {
            background: linear-gradient(135deg, rgba(2, 132, 199, 0.1) 0%, rgba(167, 139, 250, 0.1) 100%);
            border: 2px dashed var(--accent-ice);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .badge-hunt-card::before {
            content: 'üéØ';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 6rem;
            opacity: 0.1;
        }

        .badge-hunt-card.upcoming {
            border-color: var(--text-muted);
            opacity: 0.7;
        }

        .badge-hunt-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .badge-hunt-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            font-weight: 700;
        }

        .badge-hunt-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-hunt-status.active {
            background: rgba(45, 157, 95, 0.15);
            color: var(--wilson-light);
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(45, 157, 95, 0.4); }
            50% { box-shadow: 0 0 10px 5px rgba(45, 157, 95, 0.2); }
        }

        .badge-hunt-status.upcoming {
            background: rgba(100, 116, 139, 0.15);
            color: var(--text-muted);
        }

        .badge-hunt-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .badge-hunt-reward {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg-card);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            color: var(--scott-light);
            margin-bottom: 1rem;
        }

        .badge-hunt-progress {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
        }

        .hunt-progress-item {
            background: var(--bg-card);
            padding: 0.75rem;
            border-radius: 8px;
            text-align: center;
        }

        .hunt-progress-house {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }

        .hunt-progress-bar {
            height: 8px;
            background: var(--bg-elevated);
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .hunt-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .hunt-progress-fill.shackleton { background: var(--shackleton-light); }
        .hunt-progress-fill.wilson { background: var(--wilson-light); }
        .hunt-progress-fill.bowen { background: var(--bowen-light); }
        .hunt-progress-fill.scott { background: var(--scott-light); }

        .hunt-progress-count {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1.1rem;
        }

        /* Progress Tracker / Badge Tier */
        .tier-progress-section {
            margin-bottom: 2rem;
        }

        .tier-progress-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .tier-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .tier-header h4 {
            font-family: 'Playfair Display', serif;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .current-tier-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .tier-bronze { background: rgba(205, 127, 50, 0.2); color: #cd7f32; }
        .tier-silver { background: rgba(192, 192, 192, 0.2); color: #a0a0a0; }
        .tier-gold { background: rgba(255, 215, 0, 0.2); color: #d4af00; }
        .tier-platinum { background: rgba(229, 228, 226, 0.2); color: #a0a0a0; }
        .tier-legendary { background: rgba(155, 89, 182, 0.2); color: #9b59b6; }

        .tier-progress-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .tier-progress-bar-container {
            flex: 1;
        }

        .tier-progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }

        .tier-progress-bar {
            height: 12px;
            background: var(--bg-elevated);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .tier-progress-fill {
            height: 100%;
            border-radius: 6px;
            background: linear-gradient(90deg, var(--accent-ice) 0%, var(--accent-aurora) 100%);
            transition: width 0.5s ease;
        }

        .tier-milestones {
            display: flex;
            justify-content: space-between;
            margin-top: 0.75rem;
        }

        .tier-milestone {
            text-align: center;
            font-size: 0.75rem;
        }

        .tier-milestone-icon {
            font-size: 1.25rem;
            opacity: 0.5;
        }

        .tier-milestone-icon.achieved {
            opacity: 1;
        }

        .tier-next-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: var(--bg-elevated);
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .tier-next-info strong {
            color: var(--accent-ice);
        }

        /* House Profile / Trophy Cabinet */
        .house-profiles-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
        }

        @media (max-width: 900px) {
            .house-profiles-grid {
                grid-template-columns: 1fr;
            }
        }

        .house-profile-card {
            background: var(--bg-card);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-md);
        }

        .house-profile-header {
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .house-profile-header.shackleton { background: linear-gradient(135deg, var(--shackleton-blue), var(--shackleton-light)); }
        .house-profile-header.wilson { background: linear-gradient(135deg, var(--wilson-green), var(--wilson-light)); }
        .house-profile-header.bowen { background: linear-gradient(135deg, var(--bowen-red), var(--bowen-light)); }
        .house-profile-header.scott { background: linear-gradient(135deg, var(--scott-yellow), var(--scott-light)); }

        .house-profile-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        }

        .house-profile-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .house-profile-name {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .house-profile-stats {
            display: flex;
            gap: 1.5rem;
            margin-top: 0.75rem;
        }

        .house-profile-stat {
            text-align: center;
            color: rgba(255,255,255,0.9);
        }

        .house-profile-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.25rem;
            font-weight: 700;
        }

        .house-profile-stat-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            opacity: 0.8;
        }

        .house-profile-body {
            padding: 1.25rem;
        }

        .trophy-cabinet {
            margin-bottom: 1rem;
        }

        .trophy-cabinet h5 {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .trophy-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .trophy-badge {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--bg-elevated);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            border: 2px solid var(--border-color);
            position: relative;
            cursor: default;
            transition: transform 0.2s;
        }

        .trophy-badge:hover {
            transform: scale(1.15);
            z-index: 10;
        }

        .trophy-badge.legendary {
            border-color: #9b59b6;
            box-shadow: 0 0 10px rgba(155, 89, 182, 0.3);
        }

        .trophy-badge.first {
            border-color: #ffd700;
        }

        .trophy-badge-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-elevated);
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 100;
            border: 1px solid var(--border-color);
        }

        .trophy-badge:hover .trophy-badge-tooltip {
            opacity: 1;
        }

        .trophy-show-more {
            font-size: 0.8rem;
            color: var(--accent-ice);
            cursor: pointer;
            padding: 0.25rem 0.5rem;
        }

        .recent-wins {
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
        }

        .recent-wins h5 {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .recent-win-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .recent-win-place {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            background: var(--bg-elevated);
        }

        .recent-win-place.first { background: rgba(255, 215, 0, 0.2); color: #d4af00; }

        /* Heritage Page Styles */
        .heritage-section {
            margin-bottom: 3rem;
        }

        /* Explorer Cards */
        .explorer-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        @media (max-width: 1000px) {
            .explorer-cards {
                grid-template-columns: 1fr;
            }
        }

        .explorer-card {
            background: var(--bg-card);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-md);
        }

        .explorer-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            color: white;
        }

        .explorer-card.shackleton .explorer-header { background: linear-gradient(135deg, var(--shackleton-blue), var(--shackleton-light)); }
        .explorer-card.scott .explorer-header { background: linear-gradient(135deg, var(--scott-yellow), var(--scott-light)); }
        .explorer-card.wilson .explorer-header { background: linear-gradient(135deg, var(--wilson-green), var(--wilson-light)); }
        .explorer-card.bowen .explorer-header { background: linear-gradient(135deg, var(--bowen-red), var(--bowen-light)); }

        .explorer-icon {
            font-size: 2.5rem;
        }

        .explorer-title h4 {
            font-family: 'Playfair Display', serif;
            font-size: 1.35rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .explorer-dates {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .explorer-quote {
            padding: 1rem 1.5rem;
            background: var(--bg-elevated);
            font-style: italic;
            color: var(--text-secondary);
            border-left: 4px solid var(--accent-ice);
            margin: 0;
        }

        .explorer-content {
            padding: 1.5rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .explorer-card.expanded .explorer-content {
            max-height: 2000px;
        }

        .explorer-content p {
            margin-bottom: 1rem;
            line-height: 1.7;
        }

        .explorer-expeditions {
            margin: 1.5rem 0;
        }

        .expedition {
            padding: 1rem;
            background: var(--bg-elevated);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--accent-ice);
        }

        .expedition-date {
            display: inline-block;
            background: var(--accent-ice);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .expedition-name {
            font-weight: 700;
            color: var(--text-primary);
            margin-left: 0.5rem;
        }

        .expedition p {
            margin: 0.5rem 0 0 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .explorer-middleton, .explorer-legacy {
            padding: 1rem;
            border-radius: 12px;
            margin-top: 1rem;
        }

        .explorer-middleton {
            background: linear-gradient(135deg, rgba(2, 132, 199, 0.1) 0%, rgba(167, 139, 250, 0.1) 100%);
            border: 1px dashed var(--accent-ice);
        }

        .explorer-legacy {
            background: var(--bg-elevated);
            border: 1px solid var(--border-color);
        }

        .explorer-middleton h5, .explorer-legacy h5 {
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
            color: var(--accent-ice);
        }

        .explorer-toggle {
            width: 100%;
            padding: 1rem;
            background: var(--bg-elevated);
            border: none;
            border-top: 1px solid var(--border-color);
            color: var(--accent-ice);
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .explorer-toggle:hover {
            background: var(--bg-card);
        }

        .explorer-card.expanded .explorer-toggle {
            background: var(--bg-card);
        }

        /* Timeline */
        .timeline-container {
            padding: 1rem 0;
            overflow-x: auto;
        }

        .timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, var(--accent-ice) 0%, var(--accent-aurora) 100%);
            border-radius: 2px;
        }

        .timeline-item {
            position: relative;
            padding: 1rem 0 1rem 2rem;
            border-left: none;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -2rem;
            top: 1.3rem;
            width: 16px;
            height: 16px;
            background: var(--bg-card);
            border: 3px solid var(--accent-ice);
            border-radius: 50%;
            z-index: 1;
        }

        .timeline-item.highlight::before {
            background: var(--accent-ice);
            box-shadow: 0 0 10px rgba(2, 132, 199, 0.5);
        }

        .timeline-date {
            display: inline-block;
            background: var(--bg-elevated);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--accent-ice);
            margin-bottom: 0.5rem;
        }

        .timeline-item.highlight .timeline-date {
            background: var(--accent-ice);
            color: white;
        }

        .timeline-content {
            background: var(--bg-card);
            padding: 1rem 1.25rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .timeline-content h5 {
            font-family: 'Playfair Display', serif;
            font-size: 1.05rem;
            margin-bottom: 0.5rem;
        }

        .timeline-content p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin: 0;
            line-height: 1.5;
        }

        /* Records Grid */
        .records-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.25rem;
        }

        .record-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .record-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-ice) 0%, var(--accent-aurora) 100%);
        }

        .record-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }

        .record-title {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .record-value {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .record-holder {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg-elevated);
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .record-year {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        /* Anniversaries */
        .anniversaries-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.25rem;
        }

        .anniversary-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.25rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .anniversary-card.upcoming {
            background: linear-gradient(135deg, rgba(2, 132, 199, 0.1) 0%, rgba(167, 139, 250, 0.05) 100%);
            border-color: var(--accent-ice);
        }

        .anniversary-date-box {
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 0.75rem;
            text-align: center;
            min-width: 70px;
        }

        .anniversary-card.upcoming .anniversary-date-box {
            background: var(--accent-ice);
            color: white;
        }

        .anniversary-day {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1;
        }

        .anniversary-month {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .anniversary-content h5 {
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .anniversary-content p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .anniversary-years {
            display: inline-block;
            background: var(--accent-aurora);
            color: white;
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 700;
            margin-top: 0.5rem;
        }

        /* Heritage Spotlight on Dashboard */
        .heritage-spotlight-card {
            background: linear-gradient(135deg, rgba(2, 132, 199, 0.05) 0%, rgba(167, 139, 250, 0.05) 100%);
            border: 1px dashed var(--accent-ice) !important;
        }

        .spotlight-explorer {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-card);
            border-radius: 10px;
            margin-bottom: 0.75rem;
        }

        .spotlight-explorer-icon {
            font-size: 1.75rem;
        }

        .spotlight-explorer-info h5 {
            font-size: 0.9rem;
            margin-bottom: 0.1rem;
        }

        .spotlight-explorer-info p {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin: 0;
        }

        .spotlight-quote {
            font-style: italic;
            font-size: 0.8rem;
            color: var(--text-secondary);
            padding: 0.5rem;
            background: var(--bg-elevated);
            border-radius: 8px;
            border-left: 3px solid var(--accent-ice);
            margin-bottom: 0.75rem;
        }

        .spotlight-link {
            display: block;
            text-align: center;
            padding: 0.5rem;
            background: var(--accent-ice);
            color: white;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 600;
            transition: background 0.2s;
            cursor: pointer;
        }

        .spotlight-link:hover {
            background: var(--shackleton-blue);
        }

        .upcoming-anniversary {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: var(--bg-elevated);
            border-radius: 8px;
            margin-top: 0.75rem;
            font-size: 0.8rem;
        }

        .upcoming-anniversary-icon {
            font-size: 1.25rem;
        }

        .upcoming-anniversary-days {
            background: var(--accent-aurora);
            color: white;
            padding: 0.15rem 0.4rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 700;
            margin-left: auto;
        }

        /* Community Page Styles */
        .community-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        @media (max-width: 1000px) {
            .community-grid {
                grid-template-columns: 1fr;
            }
        }

        .community-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .community-card.full-width {
            grid-column: 1 / -1;
        }

        .community-card h4 {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .community-card-desc {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        /* Widget Previews */
        .widget-preview-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .widget-preview-section:last-of-type {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .widget-preview-section h5 {
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
            color: var(--text-secondary);
        }

        .widget-preview {
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 2px dashed var(--border-color);
        }

        .widget-preview.mini {
            max-width: 300px;
        }

        .widget-preview.badge-widget {
            max-width: 250px;
        }

        .widget-standings-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            margin-bottom: 0.25rem;
            background: var(--bg-card);
            border-radius: 8px;
        }

        .widget-rank {
            font-weight: 700;
            font-size: 1rem;
            width: 24px;
            color: var(--text-muted);
        }

        .widget-house-icon {
            font-size: 1.25rem;
        }

        .widget-house-name {
            flex: 1;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .widget-house-points {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            color: var(--accent-ice);
        }

        .widget-hotw {
            text-align: center;
            padding: 1rem;
        }

        .widget-hotw-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .widget-hotw-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .widget-hotw-house {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            font-weight: 700;
            margin-top: 0.25rem;
        }

        .widget-code-section {
            margin-top: 0.75rem;
        }

        .widget-code-section label {
            font-size: 0.8rem;
            color: var(--text-muted);
            display: block;
            margin-bottom: 0.25rem;
        }

        .code-copy-container {
            display: flex;
            gap: 0.5rem;
        }

        .widget-code {
            flex: 1;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            padding: 0.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            resize: none;
            height: 50px;
            color: var(--text-primary);
        }

        /* Assembly Mode Options */
        .assembly-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 600px) {
            .assembly-options {
                grid-template-columns: 1fr;
            }
        }

        .assembly-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-elevated);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border-color);
        }

        .assembly-option:hover {
            background: var(--bg-secondary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .assembly-option-icon {
            font-size: 2rem;
        }

        .assembly-option-info {
            flex: 1;
        }

        .assembly-option-info h5 {
            font-size: 0.95rem;
            margin-bottom: 0.1rem;
        }

        .assembly-option-info p {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin: 0;
        }

        .assembly-tips {
            background: var(--accent-snow);
            border-radius: 12px;
            padding: 1rem;
        }

        .assembly-tips h5 {
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
        }

        .assembly-tips ul {
            list-style: none;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .assembly-tips li {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .assembly-tips li::before {
            content: '‚Ä¢';
            color: var(--accent-ice);
        }

        .assembly-tips kbd {
            background: var(--bg-card);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            border: 1px solid var(--border-color);
        }

        /* Photo Gallery */
        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .gallery-filters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .photo-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            aspect-ratio: 4/3;
            background: var(--bg-elevated);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .photo-item:hover {
            transform: scale(1.02);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-item-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--bg-elevated), var(--bg-secondary));
            color: var(--text-muted);
        }

        .photo-item-placeholder span {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .photo-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 0.75rem;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            color: white;
        }

        .photo-caption {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .photo-house-tag {
            display: inline-block;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-top: 0.25rem;
        }

        .photo-house-tag.shackleton { background: var(--shackleton-light); }
        .photo-house-tag.wilson { background: var(--wilson-light); }
        .photo-house-tag.bowen { background: var(--bowen-light); }
        .photo-house-tag.scott { background: var(--scott-light); }

        /* Upload Zone */
        .gallery-upload {
            margin-top: 1rem;
        }

        .upload-zone {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--bg-elevated);
        }

        .upload-zone:hover {
            border-color: var(--accent-ice);
            background: var(--accent-snow);
        }

        .upload-zone.dragover {
            border-color: var(--accent-ice);
            background: var(--accent-snow);
        }

        .upload-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .upload-zone p {
            color: var(--text-secondary);
            margin: 0;
        }

        .upload-hint {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        .upload-form {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg-elevated);
            border-radius: 12px;
        }

        /* Assembly Fullscreen Mode */
        .assembly-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 2rem;
            animation: fadeIn 0.3s ease;
        }

        .assembly-close {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .assembly-close:hover {
            background: rgba(255,255,255,0.2);
        }

        .assembly-content {
            text-align: center;
            max-width: 1200px;
            width: 100%;
        }

        .assembly-title {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            margin-bottom: 2rem;
            text-shadow: 0 2px 20px rgba(0,0,0,0.3);
        }

        .assembly-standings {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .assembly-house-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            min-width: 250px;
            transition: transform 0.3s;
        }

        .assembly-house-card:hover {
            transform: scale(1.05);
        }

        .assembly-house-card.rank-1 {
            background: linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,215,0,0.1));
            border: 2px solid rgba(255,215,0,0.5);
        }

        .assembly-house-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .assembly-house-name {
            font-family: 'Playfair Display', serif;
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .assembly-house-points {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .assembly-house-rank {
            font-size: 1rem;
            opacity: 0.7;
            margin-top: 0.5rem;
        }

        .assembly-celebration {
            animation: celebrationPulse 2s ease-in-out infinite;
        }

        @keyframes celebrationPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            animation: confettiFall 3s linear forwards;
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* Photo Lightbox */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            animation: fadeIn 0.3s ease;
        }

        .lightbox-close {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .lightbox img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 12px;
        }

        .lightbox-caption {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            text-align: center;
        }

        /* Faith & Service Page Styles */
        .faith-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        @media (max-width: 1000px) {
            .faith-grid {
                grid-template-columns: 1fr;
            }
        }

        .faith-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .faith-card.full-width {
            grid-column: 1 / -1;
        }

        .faith-card h4 {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .faith-card h5 {
            font-size: 0.95rem;
            margin: 1.25rem 0 0.75rem;
            color: var(--text-secondary);
        }

        .faith-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .faith-card-desc {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        /* Kindness Wall */
        .kindness-wall {
            display: grid;
            gap: 1rem;
            max-height: 500px;
            overflow-y: auto;
        }

        .kindness-card {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.08), rgba(167, 139, 250, 0.08));
            border-radius: 16px;
            padding: 1.25rem;
            border: 1px solid rgba(236, 72, 153, 0.2);
            position: relative;
        }

        .kindness-card::before {
            content: 'üíù';
            position: absolute;
            top: -8px;
            right: 12px;
            font-size: 1.5rem;
        }

        .kindness-person {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .kindness-house-icon {
            font-size: 1.25rem;
        }

        .kindness-action {
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .kindness-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .kindness-from {
            font-style: italic;
        }

        .kindness-reactions {
            display: flex;
            gap: 0.5rem;
        }

        .kindness-reaction {
            background: var(--bg-card);
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .kindness-reaction:hover {
            transform: scale(1.1);
        }

        /* Service Hours */
        .service-overview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .service-stat-card {
            text-align: center;
            padding: 1rem;
            background: var(--bg-elevated);
            border-radius: 12px;
        }

        .service-stat-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .service-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--accent-ice);
        }

        .service-stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .service-house-breakdown {
            margin-bottom: 1.5rem;
        }

        .service-bars {
            display: grid;
            gap: 0.75rem;
        }

        .service-bar-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .service-bar-icon {
            font-size: 1.25rem;
            width: 30px;
        }

        .service-bar-track {
            flex: 1;
            height: 24px;
            background: var(--bg-elevated);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .service-bar-fill {
            height: 100%;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.75rem;
            color: white;
            font-size: 0.8rem;
            font-weight: 700;
            transition: width 0.5s ease;
        }

        .service-bar-fill.shackleton { background: var(--shackleton-light); }
        .service-bar-fill.wilson { background: var(--wilson-light); }
        .service-bar-fill.bowen { background: var(--bowen-light); }
        .service-bar-fill.scott { background: var(--scott-light); }

        .service-leaders {
            display: grid;
            gap: 0.5rem;
        }

        .service-leader-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            background: var(--bg-elevated);
            border-radius: 10px;
        }

        .service-leader-rank {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
        }

        .service-leader-rank.gold { background: linear-gradient(135deg, #ffd700, #ffec8b); color: #8b6914; }
        .service-leader-rank.silver { background: linear-gradient(135deg, #c0c0c0, #e8e8e8); color: #666; }
        .service-leader-rank.bronze { background: linear-gradient(135deg, #cd7f32, #daa06d); color: #5c3a21; }

        .service-leader-name {
            flex: 1;
            font-weight: 600;
        }

        .service-leader-house {
            font-size: 1.25rem;
        }

        .service-leader-hours {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--accent-ice);
        }

        /* Mission Trips */
        .mission-trips {
            display: grid;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .mission-card {
            background: var(--bg-elevated);
            border-radius: 16px;
            padding: 1.25rem;
            display: flex;
            gap: 1rem;
            border-left: 4px solid var(--accent-ice);
        }

        .mission-card.active {
            border-left-color: var(--success);
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.08), transparent);
        }

        .mission-card.upcoming {
            border-left-color: var(--warning);
        }

        .mission-card.past {
            opacity: 0.7;
        }

        .mission-icon {
            font-size: 2.5rem;
        }

        .mission-info {
            flex: 1;
        }

        .mission-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .mission-location {
            color: var(--text-muted);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .mission-dates {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .mission-progress {
            margin-top: 0.75rem;
        }

        .mission-progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
        }

        .mission-progress-bar {
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
        }

        .mission-progress-fill {
            height: 100%;
            background: var(--success);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .mission-support {
            background: var(--accent-snow);
            border-radius: 12px;
            padding: 1rem;
        }

        .support-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        @media (max-width: 500px) {
            .support-options {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .support-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.75rem;
            background: var(--bg-card);
            border-radius: 10px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .support-option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .support-icon {
            font-size: 1.5rem;
        }

        /* Prayer Board */
        .prayer-card {
            max-height: none;
        }

        .prayer-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .prayer-board {
            display: grid;
            gap: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .prayer-item {
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 1rem;
            position: relative;
        }

        .prayer-item.prayer {
            border-left: 4px solid var(--accent-aurora);
        }

        .prayer-item.praise {
            border-left: 4px solid var(--success);
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), transparent);
        }

        .prayer-item.encouragement {
            border-left: 4px solid var(--warning);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.05), transparent);
        }

        .prayer-type-icon {
            position: absolute;
            top: -8px;
            right: 12px;
            font-size: 1.25rem;
            background: var(--bg-card);
            padding: 0.15rem;
            border-radius: 50%;
        }

        .prayer-message {
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .prayer-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .prayer-actions {
            display: flex;
            gap: 0.5rem;
        }

        .prayer-action {
            background: var(--bg-card);
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .prayer-action:hover {
            background: var(--accent-snow);
        }

        .prayer-action.prayed {
            background: rgba(167, 139, 250, 0.2);
            color: var(--accent-aurora);
        }

        /* Faith Quote */
        .quote-card {
            background: linear-gradient(135deg, var(--accent-snow), var(--bg-card));
            text-align: center;
            padding: 2rem;
        }

        .faith-quote {
            position: relative;
        }

        .faith-quote-text {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-style: italic;
            line-height: 1.6;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .faith-quote-text::before {
            content: '"';
            font-size: 4rem;
            position: absolute;
            top: -1.5rem;
            left: -0.5rem;
            color: var(--accent-ice);
            opacity: 0.3;
            font-family: serif;
        }

        .faith-quote-reference {
            color: var(--accent-ice);
            font-weight: 600;
        }

        /* Service Events */
        .service-events {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .service-event-card {
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            gap: 1rem;
            transition: all 0.2s;
        }

        .service-event-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .service-event-date {
            background: var(--accent-ice);
            color: white;
            padding: 0.5rem;
            border-radius: 10px;
            text-align: center;
            min-width: 55px;
        }

        .service-event-day {
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1;
        }

        .service-event-month {
            font-size: 0.7rem;
            text-transform: uppercase;
        }

        .service-event-info h5 {
            font-size: 0.95rem;
            margin: 0 0 0.25rem;
        }

        .service-event-info p {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin: 0;
        }

        .service-event-spots {
            display: inline-block;
            padding: 0.15rem 0.5rem;
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        /* Modal enhancements */
        .form-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        .form-actions .btn {
            flex: 1;
        }

        /* Analytics Section */
        .analytics-overview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 900px) {
            .analytics-overview {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .analytics-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.25rem;
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .analytics-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .analytics-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--accent-ice);
        }

        .analytics-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 1rem;
        }

        .chart-container.chart-small {
            height: 250px;
            max-width: 400px;
            margin: 1rem auto;
        }

        .activity-summary {
            display: grid;
            gap: 0.75rem;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            background: var(--bg-elevated);
            border-radius: 10px;
        }

        .activity-item-icon {
            font-size: 1.25rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-card);
            border-radius: 10px;
        }

        .activity-item-info {
            flex: 1;
        }

        .activity-item-info h5 {
            font-size: 0.9rem;
            margin-bottom: 0.1rem;
        }

        .activity-item-info p {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin: 0;
        }

        .activity-item-time {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Export Section */
        .export-options {
            display: grid;
            gap: 1rem;
        }

        .export-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-elevated);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .export-icon {
            font-size: 2rem;
            width: 50px;
            text-align: center;
        }

        .export-info {
            flex: 1;
        }

        .export-info h5 {
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .export-info p {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin: 0;
        }

        .export-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-sm {
            padding: 0.4rem 0.75rem;
            font-size: 0.8rem;
        }

        .scheduled-posts-list {
            margin-top: 1rem;
        }

        .scheduled-post-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            background: var(--bg-elevated);
            border-radius: 10px;
            margin-top: 0.75rem;
        }

        .scheduled-post-time {
            background: var(--accent-ice);
            color: white;
            padding: 0.4rem 0.75rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
            min-width: 80px;
        }

        .scheduled-post-content {
            flex: 1;
            font-size: 0.85rem;
        }

        /* Admin Roles */
        .admin-roles-list {
            display: grid;
            gap: 0.75rem;
        }

        .admin-role-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-elevated);
            border-radius: 12px;
        }

        .admin-role-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--accent-ice);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .admin-role-info {
            flex: 1;
        }

        .admin-role-info h5 {
            font-size: 0.95rem;
            margin-bottom: 0.1rem;
        }

        .admin-role-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .admin-role-badge.super {
            background: rgba(155, 89, 182, 0.2);
            color: #9b59b6;
        }

        .admin-role-badge.house {
            background: rgba(2, 132, 199, 0.2);
            color: var(--accent-ice);
        }

        .admin-role-badge.viewer {
            background: rgba(100, 116, 139, 0.2);
            color: var(--text-muted);
        }

        /* Audit Log */
        .audit-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .audit-filters select {
            flex: 1;
        }

        .audit-log {
            max-height: 400px;
            overflow-y: auto;
        }

        .audit-entry {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }

        .audit-entry:last-child {
            border-bottom: none;
        }

        .audit-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .audit-icon.points { background: rgba(45, 157, 95, 0.15); }
        .audit-icon.badges { background: rgba(232, 184, 42, 0.15); }
        .audit-icon.events { background: rgba(2, 132, 199, 0.15); }
        .audit-icon.feed { background: rgba(167, 139, 250, 0.15); }
        .audit-icon.admin { background: rgba(199, 56, 56, 0.15); }

        .audit-content {
            flex: 1;
        }

        .audit-content p {
            font-size: 0.85rem;
            margin: 0;
        }

        .audit-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        /* Settings */
        .settings-group {
            display: grid;
            gap: 1rem;
        }

        .setting-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-elevated);
            border-radius: 12px;
        }

        .setting-info {
            flex: 1;
        }

        .setting-info h5 {
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .setting-info p {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin: 0;
        }

        .danger-zone {
            border: 1px solid rgba(199, 56, 56, 0.3);
            background: rgba(199, 56, 56, 0.05);
        }

        .danger-zone h4 {
            color: var(--bowen-light);
        }

        .badge-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .badge-category {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge-earned-by {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color);
        }

        .badge-earned-houses {
            display: flex;
            justify-content: center;
            gap: 0.25rem;
        }

        .earned-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            opacity: 0.3;
        }

        .earned-dot.earned {
            opacity: 1;
        }

        .earned-dot.shackleton { background: var(--shackleton-light); }
        .earned-dot.wilson { background: var(--wilson-light); }
        .earned-dot.bowen { background: var(--bowen-light); }
        .earned-dot.scott { background: var(--scott-light); }

        /* Leaderboard Page */
        .leaderboard-table {
            background: var(--bg-card);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .leaderboard-row {
            display: grid;
            grid-template-columns: 60px 1fr 100px 80px 80px 80px;
            padding: 1rem 1.5rem;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .leaderboard-row.header {
            background: var(--bg-elevated);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
        }

        .leaderboard-row:last-child {
            border-bottom: none;
        }

        .leaderboard-rank {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .leaderboard-house {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .leaderboard-house-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .leaderboard-house-icon.shackleton { background: var(--shackleton-blue); }
        .leaderboard-house-icon.wilson { background: var(--wilson-green); }
        .leaderboard-house-icon.bowen { background: var(--bowen-red); }
        .leaderboard-house-icon.scott { background: var(--scott-yellow); }

        .leaderboard-house-name {
            font-weight: 600;
        }

        .leaderboard-points {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .leaderboard-badges, .leaderboard-events {
            color: var(--text-secondary);
        }

        .leaderboard-spirit {
            color: var(--accent-ice);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-header {
            background: linear-gradient(135deg, rgba(167, 139, 250, 0.1) 0%, rgba(125, 211, 252, 0.1) 100%);
            border: 1px solid var(--accent-aurora);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .admin-header h3 {
            font-family: 'Playfair Display', serif;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .admin-logout {
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Source Sans Pro', sans-serif;
        }

        .admin-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 0.75rem 1.25rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Source Sans Pro', sans-serif;
            font-weight: 600;
            transition: all 0.3s;
        }

        .admin-tab:hover, .admin-tab.active {
            background: var(--accent-aurora);
            color: var(--bg-deep);
            border-color: var(--accent-aurora);
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-elevated);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Source Sans Pro', sans-serif;
            font-size: 1rem;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: var(--accent-ice);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-family: 'Source Sans Pro', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-ice) 0%, var(--accent-aurora) 100%);
            color: var(--bg-deep);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(125, 211, 252, 0.4);
        }

        .btn-secondary {
            background: var(--bg-elevated);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-danger {
            background: var(--bowen-red);
            color: white;
        }

        .admin-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }

        .admin-card h4 {
            font-family: 'Playfair Display', serif;
            margin-bottom: 1rem;
        }

        .admin-list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--bg-elevated);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .admin-list-item-info h5 {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .admin-list-item-info span {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .admin-list-actions {
            display: flex;
            gap: 0.5rem;
        }

        .admin-list-actions button {
            padding: 0.5rem 0.75rem;
            font-size: 0.85rem;
        }

        /* Points Adjustment */
        .points-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        @media (max-width: 800px) {
            .points-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .points-card {
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .points-card.shackleton { border-color: var(--shackleton-blue); }
        .points-card.wilson { border-color: var(--wilson-green); }
        .points-card.bowen { border-color: var(--bowen-red); }
        .points-card.scott { border-color: var(--scott-yellow); }

        .points-card h5 {
            font-family: 'Playfair Display', serif;
            margin-bottom: 0.75rem;
        }

        .points-input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .points-input-group input {
            width: 100%;
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.25rem;
        }

        .points-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .points-btn:hover {
            background: var(--accent-ice);
            color: var(--bg-deep);
        }

        /* Login Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border-color);
        }

        .modal h3 {
            font-family: 'Playfair Display', serif;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1001;
        }

        .toast {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.success { border-left: 3px solid var(--wilson-light); }
        .toast.error { border-left: 3px solid var(--bowen-light); }
        .toast.info { border-left: 3px solid var(--accent-ice); }

        /* Footer */
        .footer {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .footer a {
            color: var(--accent-ice);
            text-decoration: none;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .dashboard-hero h2 {
                font-size: 1.75rem;
            }

            .leaderboard-row {
                grid-template-columns: 40px 1fr 80px;
            }

            .leaderboard-badges, .leaderboard-events, .leaderboard-spirit,
            .leaderboard-row.header span:nth-child(4), 
            .leaderboard-row.header span:nth-child(5),
            .leaderboard-row.header span:nth-child(6) {
                display: none;
            }

            .main-content {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="aurora-bg"></div>
    <div class="grid-overlay"></div>
    
    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <div class="logo-section" id="logoSection">
                    <div class="logo-crest" id="logoCrest">MGS</div>
                    <div class="logo-text">
                        <h1>House Competition</h1>
                        <span>Middleton Grange School</span>
                    </div>
                </div>
                <div class="header-right">
                    <nav class="nav-tabs" id="mainNav">
                        <button class="nav-tab active" data-page="dashboard">Dashboard</button>
                        <button class="nav-tab" data-page="events">Events</button>
                        <button class="nav-tab" data-page="results">Results</button>
                        <button class="nav-tab" data-page="awards">Awards</button>
                        <button class="nav-tab" data-page="houses">Houses</button>
                        <button class="nav-tab" data-page="heritage">Heritage</button>
                        <button class="nav-tab" data-page="leaderboard">Leaderboard</button>
                        <button class="nav-tab" data-page="community">Community</button>
                        <button class="nav-tab" data-page="faith">Faith & Service</button>
                    </nav>
                    <button class="theme-toggle" id="themeToggle" title="Toggle dark mode">üåô</button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- Dashboard Page -->
            <div class="page active" id="page-dashboard">
                <div class="dashboard-hero">
                    <h2>üß≠ The Race for Glory</h2>
                    <p>Four houses. One trophy. Who will claim Antarctic glory?</p>
                    <span class="current-year">2025 Season</span>
                </div>

                <!-- House of the Week -->
                <div class="hotw-card" id="houseOfTheWeek">
                    <!-- Populated by JS -->
                </div>

                <div class="section-header">
                    <div>
                        <h3 class="section-title">House Standings</h3>
                        <p class="section-subtitle">Current points tally</p>
                    </div>
                </div>

                <div class="standings-grid" id="standingsGrid">
                    <!-- Populated by JS -->
                </div>

                <div class="section-header">
                    <div>
                        <h3 class="section-title">Upcoming Events</h3>
                        <p class="section-subtitle">Mark your calendars</p>
                    </div>
                </div>

                <div class="events-grid" id="upcomingEventsPreview">
                    <!-- Populated by JS -->
                </div>

                <!-- House Feed Section -->
                <div class="feed-section">
                    <div class="section-header">
                        <div>
                            <h3 class="section-title">üì£ House Feed</h3>
                            <p class="section-subtitle">Latest achievements and shoutouts</p>
                        </div>
                    </div>

                    <div class="feed-filters">
                        <button class="feed-filter active" data-feed-filter="all">All</button>
                        <button class="feed-filter" data-feed-filter="badge">üéñÔ∏è Badges</button>
                        <button class="feed-filter" data-feed-filter="event">üèÜ Events</button>
                        <button class="feed-filter" data-feed-filter="spirit">üëè Spirit</button>
                        <button class="feed-filter" data-feed-filter="shoutout">‚≠ê Shoutouts</button>
                    </div>

                    <div class="feed-container">
                        <div class="feed-main" id="feedMain">
                            <!-- Populated by JS -->
                        </div>

                        <div class="spirit-sidebar">
                            <div class="spirit-card">
                                <h4>üëè Spirit Points</h4>
                                <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem;">Earned through event attendance & participation</p>
                                <div id="spiritPointsList">
                                    <!-- Populated by JS -->
                                </div>
                                <div class="spirit-info">
                                    üí° Attend events in house colors = +5 bonus spirit points!
                                </div>
                            </div>

                            <div class="spirit-card">
                                <h4>üåü Top Participants</h4>
                                <div class="top-participants" id="topParticipants">
                                    <!-- Populated by JS -->
                                </div>
                            </div>

                            <div class="spirit-card heritage-spotlight-card">
                                <h4>üèîÔ∏è Heritage Spotlight</h4>
                                <div id="heritageSpotlight">
                                    <!-- Populated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Events Page -->
            <div class="page" id="page-events">
                <div class="section-header">
                    <div>
                        <h3 class="section-title">üìÖ Upcoming Events</h3>
                        <p class="section-subtitle">Compete for your house</p>
                    </div>
                </div>
                <div class="events-grid" id="upcomingEventsFull">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Results Page -->
            <div class="page" id="page-results">
                <div class="section-header">
                    <div>
                        <h3 class="section-title">üèÜ Competition Results</h3>
                        <p class="section-subtitle">Past event outcomes</p>
                    </div>
                </div>
                <div class="events-grid" id="resultsGrid">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Awards Page -->
            <div class="page" id="page-awards">
                <div class="awards-header">
                    <h2>üéñÔ∏è Badge Collection</h2>
                    <p>150 achievements to unlock across academics, sport, arts, service, and faith. First to earn = 10pts, Second = 5pts, Third = 2pts, Fourth = 1pt.</p>
                </div>

                <!-- Badge Hunts -->
                <div class="badge-hunt-section">
                    <div class="section-header">
                        <div>
                            <h3 class="section-title">üéØ Badge Hunts</h3>
                            <p class="section-subtitle">Limited-time challenges for bonus points!</p>
                        </div>
                    </div>
                    <div id="badgeHuntsContainer">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Progress Tracker -->
                <div class="tier-progress-section">
                    <div class="section-header">
                        <div>
                            <h3 class="section-title">üìä House Badge Progress</h3>
                            <p class="section-subtitle">Track your house's journey to Legendary tier!</p>
                        </div>
                    </div>
                    <div id="tierProgressContainer">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <div class="awards-filters">
                    <button class="filter-btn active" data-filter="all">All Badges</button>
                    <button class="filter-btn" data-filter="explorer">üåç Explorer (Service)</button>
                    <button class="filter-btn" data-filter="scholar">üìö Scholar (Academic)</button>
                    <button class="filter-btn" data-filter="performer">üé≠ Performer (Arts)</button>
                    <button class="filter-btn" data-filter="champion">üèÖ Champion (Sport)</button>
                    <button class="filter-btn" data-filter="disciple">‚úùÔ∏è Disciple (Faith)</button>
                    <button class="filter-btn" data-filter="legendary">üëë Legendary</button>
                </div>

                <div class="badges-grid" id="badgesGrid">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Houses Page (Trophy Cabinet) -->
            <div class="page" id="page-houses">
                <div class="awards-header">
                    <h2>üèõÔ∏è House Profiles</h2>
                    <p>Trophy cabinets, recent wins, and badge collections for each house.</p>
                </div>

                <div class="house-profiles-grid" id="houseProfilesGrid">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Heritage Page -->
            <div class="page" id="page-heritage">
                <div class="awards-header">
                    <h2>üèîÔ∏è Our Antarctic Heritage</h2>
                    <p>The house names honour explorers connected to Middleton Grange ‚Äî where Scott, Shackleton, and Wilson stayed before their Antarctic expeditions.</p>
                </div>

                <!-- Explorer Stories -->
                <div class="heritage-section">
                    <div class="section-header">
                        <div>
                            <h3 class="section-title">‚õµ The Explorers</h3>
                            <p class="section-subtitle">Heroes of the Heroic Age of Antarctic Exploration</p>
                        </div>
                    </div>

                    <div class="explorer-cards">
                        <!-- Shackleton -->
                        <div class="explorer-card shackleton">
                            <div class="explorer-header">
                                <div class="explorer-icon">üßä</div>
                                <div class="explorer-title">
                                    <h4>Sir Ernest Shackleton</h4>
                                    <span class="explorer-dates">1874 ‚Äì 1922</span>
                                </div>
                            </div>
                            <div class="explorer-quote">
                                "Difficulties are just things to overcome, after all."
                            </div>
                            <div class="explorer-content">
                                <p><strong>The Boss</strong> ‚Äî Born in Ireland, Shackleton became one of history's greatest leaders. His family motto, <em>"Fortitudine Vincimus"</em> (By Endurance We Conquer), became the name of his famous ship.</p>
                                
                                <div class="explorer-expeditions">
                                    <div class="expedition">
                                        <span class="expedition-date">1901-04</span>
                                        <span class="expedition-name">Discovery Expedition</span>
                                        <p>Joined Scott's first Antarctic expedition; reached 82¬∞S with Scott and Wilson ‚Äî the furthest south any human had traveled.</p>
                                    </div>
                                    <div class="expedition">
                                        <span class="expedition-date">1907-09</span>
                                        <span class="expedition-name">Nimrod Expedition</span>
                                        <p>Led his own expedition to within 97 miles of the South Pole. Made the difficult decision to turn back to save his men's lives. Knighted upon return.</p>
                                    </div>
                                    <div class="expedition">
                                        <span class="expedition-date">1914-17</span>
                                        <span class="expedition-name">Endurance Expedition</span>
                                        <p>The legendary survival story. When Endurance was crushed by ice, Shackleton led all 28 men to safety ‚Äî including an 800-mile open boat journey to South Georgia. Not a single life was lost.</p>
                                    </div>
                                </div>

                                <div class="explorer-legacy">
                                    <h5>üèÜ House Values: Endurance, Leadership, Resilience</h5>
                                    <p>Shackleton House embodies the spirit of perseverance. When facing impossible odds, Shackleton never gave up on his men. His decision to turn back from the Pole ‚Äî "Better a live donkey than a dead lion" ‚Äî showed true leadership: valuing lives over glory.</p>
                                </div>
                            </div>
                            <button class="explorer-toggle" onclick="toggleExplorer(this)">Read More ‚ñº</button>
                        </div>

                        <!-- Scott -->
                        <div class="explorer-card scott">
                            <div class="explorer-header">
                                <div class="explorer-icon">üß≠</div>
                                <div class="explorer-title">
                                    <h4>Captain Robert Falcon Scott</h4>
                                    <span class="explorer-dates">1868 ‚Äì 1912</span>
                                </div>
                            </div>
                            <div class="explorer-quote">
                                "We took risks, we knew we took them; things have come out against us."
                            </div>
                            <div class="explorer-content">
                                <p><strong>Scott of the Antarctic</strong> ‚Äî A Royal Navy officer who led two expeditions to Antarctica. His tragic final journey made him a British national hero and symbol of courage against impossible odds.</p>
                                
                                <div class="explorer-expeditions">
                                    <div class="expedition">
                                        <span class="expedition-date">1901-04</span>
                                        <span class="expedition-name">Discovery Expedition</span>
                                        <p>Scott's first Antarctic command. Established base at McMurdo Sound and reached 82¬∞17'S with Wilson and Shackleton ‚Äî a new record. Major scientific discoveries made.</p>
                                    </div>
                                    <div class="expedition">
                                        <span class="expedition-date">1910-13</span>
                                        <span class="expedition-name">Terra Nova Expedition</span>
                                        <p>The race to the Pole. Scott and four companions reached the South Pole on 17 January 1912 ‚Äî only to find Amundsen had arrived 34 days earlier. All five perished on the return journey, just 11 miles from a supply depot.</p>
                                    </div>
                                </div>

                                <div class="explorer-middleton">
                                    <h5>üè† The Middleton Connection</h5>
                                    <p>Both the Discovery and Terra Nova expeditions used Lyttelton as their New Zealand base. The expedition members were guests at Middleton Grange, hosted by Sir Charles Bowen. Scott's cousin, Professor Robert J. Scott, had married Bowen's daughter Gertrude.</p>
                                </div>

                                <div class="explorer-legacy">
                                    <h5>üèÜ House Values: Courage, Science, Sacrifice</h5>
                                    <p>Scott House represents the pursuit of knowledge and the courage to push boundaries. Even in their final days, the team continued collecting geological specimens ‚Äî contributing to science until the very end.</p>
                                </div>
                            </div>
                            <button class="explorer-toggle" onclick="toggleExplorer(this)">Read More ‚ñº</button>
                        </div>

                        <!-- Wilson -->
                        <div class="explorer-card wilson">
                            <div class="explorer-header">
                                <div class="explorer-icon">üé®</div>
                                <div class="explorer-title">
                                    <h4>Dr. Edward Adrian Wilson</h4>
                                    <span class="explorer-dates">1872 ‚Äì 1912</span>
                                </div>
                            </div>
                            <div class="explorer-quote">
                                "I believe he really is the finest character I ever met." ‚Äî Captain Scott
                            </div>
                            <div class="explorer-content">
                                <p><strong>Uncle Bill</strong> ‚Äî A physician, naturalist, and artist whose beautiful watercolors documented Antarctica's landscapes and wildlife. Wilson was the heart and conscience of both Scott expeditions, respected by all for his wisdom and kindness.</p>
                                
                                <div class="explorer-expeditions">
                                    <div class="expedition">
                                        <span class="expedition-date">1901-04</span>
                                        <span class="expedition-name">Discovery Expedition</span>
                                        <p>Served as junior surgeon, zoologist, and expedition artist. Joined Scott and Shackleton on the record-breaking southern journey. His skills as mediator helped resolve tensions between Scott and Shackleton.</p>
                                    </div>
                                    <div class="expedition">
                                        <span class="expedition-date">1911</span>
                                        <span class="expedition-name">The Worst Journey in the World</span>
                                        <p>Led a winter expedition to Cape Crozier to collect Emperor penguin eggs ‚Äî enduring temperatures of -77¬∞F (-60¬∞C). This journey is considered one of the most brutal in exploration history.</p>
                                    </div>
                                    <div class="expedition">
                                        <span class="expedition-date">1912</span>
                                        <span class="expedition-name">The Polar Journey</span>
                                        <p>As Chief of Scientific Staff, Wilson accompanied Scott to the South Pole. He died alongside Scott and Bowers in their tent, 11 miles from safety. When found, Scott's arm was extended across Wilson ‚Äî his closest friend.</p>
                                    </div>
                                </div>

                                <div class="explorer-legacy">
                                    <h5>üèÜ House Values: Creativity, Compassion, Excellence</h5>
                                    <p>Wilson House celebrates the union of art and science. Wilson overcame tuberculosis to become an Antarctic explorer, combining his medical training with his passion for natural history and art. His paintings remain treasured scientific and artistic records.</p>
                                </div>
                            </div>
                            <button class="explorer-toggle" onclick="toggleExplorer(this)">Read More ‚ñº</button>
                        </div>

                        <!-- Bowen -->
                        <div class="explorer-card bowen">
                            <div class="explorer-header">
                                <div class="explorer-icon">‚õ∞Ô∏è</div>
                                <div class="explorer-title">
                                    <h4>Sir Charles Christopher Bowen</h4>
                                    <span class="explorer-dates">1830 ‚Äì 1917</span>
                                </div>
                            </div>
                            <div class="explorer-quote">
                                "Education for all children, regardless of background."
                            </div>
                            <div class="explorer-content">
                                <p><strong>Father of New Zealand Education</strong> ‚Äî An Irish-born pioneer who arrived in Canterbury on the Charlotte Jane in 1850. Bowen became one of New Zealand's most influential statesmen and the owner of Middleton Grange ‚Äî the historic property on which our school now stands.</p>
                                
                                <div class="explorer-expeditions">
                                    <div class="expedition">
                                        <span class="expedition-date">1850</span>
                                        <span class="expedition-name">Canterbury Settlement</span>
                                        <p>Arrived on the Charlotte Jane, one of the First Four Ships. Served as private secretary to John Robert Godley, founder of the Canterbury colony. Became a justice of the peace aged just 22.</p>
                                    </div>
                                    <div class="expedition">
                                        <span class="expedition-date">1859-60</span>
                                        <span class="expedition-name">Crossing the Andes</span>
                                        <p>Traveled with Clements Markham (later President of the Royal Geographical Society) across the Andes Mountains. This adventure earned him fellowship of the Royal Geographical Society.</p>
                                    </div>
                                    <div class="expedition">
                                        <span class="expedition-date">1877</span>
                                        <span class="expedition-name">Education Act</span>
                                        <p>As Minister of Justice, Bowen was the driving force behind the Education Act 1877 ‚Äî establishing free, compulsory, secular primary education for all New Zealand children.</p>
                                    </div>
                                    <div class="expedition">
                                        <span class="expedition-date">1901-12</span>
                                        <span class="expedition-name">Host to Explorers</span>
                                        <p>Through his brother-in-law Clements Markham (who planned Scott's expeditions), Bowen hosted members of both Antarctic expeditions at Middleton Grange before they departed for the ice.</p>
                                    </div>
                                </div>

                                <div class="explorer-legacy">
                                    <h5>üèÜ House Values: Service, Education, Hospitality</h5>
                                    <p>Bowen House honors our school's physical heritage. Sir Charles believed education should be available to everyone ‚Äî a vision that lives on in our school today. Middleton Grange stands as a testament to his legacy of service and learning.</p>
                                </div>
                            </div>
                            <button class="explorer-toggle" onclick="toggleExplorer(this)">Read More ‚ñº</button>
                        </div>
                    </div>
                </div>

                <!-- Timeline -->
                <div class="heritage-section">
                    <div class="section-header">
                        <div>
                            <h3 class="section-title">üìú Historical Timeline</h3>
                            <p class="section-subtitle">Key moments connecting Middleton Grange to Antarctic exploration</p>
                        </div>
                    </div>

                    <div class="timeline-container">
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-date">Dec 1850</div>
                                <div class="timeline-content">
                                    <h5>üö¢ Charlotte Jane Arrives</h5>
                                    <p>The Bowen family arrives in Canterbury on one of the First Four Ships.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">1861</div>
                                <div class="timeline-content">
                                    <h5>üè† Middleton Grange Established</h5>
                                    <p>Charles Bowen purchases the Middleton property and begins developing the estate.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">1877</div>
                                <div class="timeline-content">
                                    <h5>üìö Education Act Passed</h5>
                                    <p>Bowen's landmark legislation establishes free, compulsory education for all NZ children.</p>
                                </div>
                            </div>
                            <div class="timeline-item highlight">
                                <div class="timeline-date">Nov 1901</div>
                                <div class="timeline-content">
                                    <h5>üßä Discovery Expedition Visits</h5>
                                    <p>Scott, Wilson, and Shackleton stay at Middleton Grange before departing for Antarctica.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">Dec 1902</div>
                                <div class="timeline-content">
                                    <h5>üèîÔ∏è Furthest South Record</h5>
                                    <p>Scott, Wilson, and Shackleton reach 82¬∞17'S ‚Äî further south than any human before.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">Jan 1909</div>
                                <div class="timeline-content">
                                    <h5>‚ùÑÔ∏è Shackleton Turns Back</h5>
                                    <p>97 miles from the Pole, Shackleton makes the brave decision to save his men's lives.</p>
                                </div>
                            </div>
                            <div class="timeline-item highlight">
                                <div class="timeline-date">Nov 1910</div>
                                <div class="timeline-content">
                                    <h5>‚õµ Terra Nova Expedition Visits</h5>
                                    <p>Scott's polar party stays at Middleton Grange. They depart from Lyttelton on 29 November.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">Jan 1912</div>
                                <div class="timeline-content">
                                    <h5>üèÅ South Pole Reached</h5>
                                    <p>Scott, Wilson, Oates, Bowers, and Evans reach the Pole ‚Äî finding Amundsen arrived first.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">Mar 1912</div>
                                <div class="timeline-content">
                                    <h5>‚úùÔ∏è The Ultimate Sacrifice</h5>
                                    <p>Scott, Wilson, and Bowers perish in their tent, just 11 miles from safety.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">1914-16</div>
                                <div class="timeline-content">
                                    <h5>üö£ Endurance Epic</h5>
                                    <p>Shackleton's ship is crushed by ice. He leads all 28 men to safety in one of history's greatest survival stories.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">1917</div>
                                <div class="timeline-content">
                                    <h5>üïäÔ∏è Sir Charles Bowen Dies</h5>
                                    <p>Bowen passes away at Middleton Grange, leaving a legacy of education and service.</p>
                                </div>
                            </div>
                            <div class="timeline-item highlight">
                                <div class="timeline-date">1964</div>
                                <div class="timeline-content">
                                    <h5>üè´ Middleton Grange School Founded</h5>
                                    <p>The school is established on the historic Middleton Grange property.</p>
                                </div>
                            </div>
                            <div class="timeline-item highlight">
                                <div class="timeline-date">1967</div>
                                <div class="timeline-content">
                                    <h5>üèÜ House System Established</h5>
                                    <p>Four houses created: Scott, Shackleton, Wilson, and Bowen ‚Äî honoring the property's Antarctic heritage.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">Mar 2022</div>
                                <div class="timeline-content">
                                    <h5>üîç Endurance Found</h5>
                                    <p>Shackleton's ship is discovered on the seafloor, 107 years after sinking ‚Äî remarkably preserved.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Record Book -->
                <div class="heritage-section">
                    <div class="section-header">
                        <div>
                            <h3 class="section-title">üìñ House Competition Records</h3>
                            <p class="section-subtitle">Historic achievements and all-time records</p>
                        </div>
                    </div>

                    <div class="records-grid" id="recordsGrid">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Significant Dates -->
                <div class="heritage-section">
                    <div class="section-header">
                        <div>
                            <h3 class="section-title">üéÇ Anniversary Celebrations</h3>
                            <p class="section-subtitle">Important dates in our heritage</p>
                        </div>
                    </div>

                    <div class="anniversaries-grid" id="anniversariesGrid">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Leaderboard Page -->
            <div class="page" id="page-leaderboard">
                <div class="section-header">
                    <div>
                        <h3 class="section-title">üìä Full Leaderboard</h3>
                        <p class="section-subtitle">Complete standings breakdown</p>
                    </div>
                </div>

                <div class="leaderboard-table" id="leaderboardTable">
                    <div class="leaderboard-row header">
                        <span>Rank</span>
                        <span>House</span>
                        <span>Points</span>
                        <span>Badges</span>
                        <span>Events Won</span>
                    </div>
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Community Page -->
            <div class="page" id="page-community">
                <div class="section-header">
                    <div>
                        <h3 class="section-title">üåê Community Hub</h3>
                        <p class="section-subtitle">Share house competition updates across the school</p>
                    </div>
                </div>

                <div class="community-grid">
                    <!-- Newsletter Widgets Section -->
                    <div class="community-card">
                        <h4>üì∞ Newsletter Widgets</h4>
                        <p class="community-card-desc">Embed live standings in your school newsletter or website</p>
                        
                        <div class="widget-preview-section">
                            <h5>Standings Widget</h5>
                            <div class="widget-preview" id="standingsWidgetPreview">
                                <!-- Live preview rendered by JS -->
                            </div>
                            <div class="widget-code-section">
                                <label>Embed Code:</label>
                                <div class="code-copy-container">
                                    <textarea class="widget-code" id="standingsWidgetCode" readonly>&lt;iframe src="https://house.middleton.school.nz/widget/standings" width="400" height="300" frameborder="0"&gt;&lt;/iframe&gt;</textarea>
                                    <button class="btn btn-sm btn-secondary" onclick="copyWidgetCode('standingsWidgetCode')">üìã Copy</button>
                                </div>
                            </div>
                        </div>

                        <div class="widget-preview-section">
                            <h5>Mini Leaderboard Widget</h5>
                            <div class="widget-preview mini" id="miniLeaderboardPreview">
                                <!-- Live preview rendered by JS -->
                            </div>
                            <div class="widget-code-section">
                                <label>Embed Code:</label>
                                <div class="code-copy-container">
                                    <textarea class="widget-code" id="miniWidgetCode" readonly>&lt;iframe src="https://house.middleton.school.nz/widget/mini" width="300" height="200" frameborder="0"&gt;&lt;/iframe&gt;</textarea>
                                    <button class="btn btn-sm btn-secondary" onclick="copyWidgetCode('miniWidgetCode')">üìã Copy</button>
                                </div>
                            </div>
                        </div>

                        <div class="widget-preview-section">
                            <h5>House of the Week Badge</h5>
                            <div class="widget-preview badge-widget" id="hotwBadgePreview">
                                <!-- Live preview rendered by JS -->
                            </div>
                            <div class="widget-code-section">
                                <label>Embed Code:</label>
                                <div class="code-copy-container">
                                    <textarea class="widget-code" id="hotwWidgetCode" readonly>&lt;iframe src="https://house.middleton.school.nz/widget/hotw" width="250" height="150" frameborder="0"&gt;&lt;/iframe&gt;</textarea>
                                    <button class="btn btn-sm btn-secondary" onclick="copyWidgetCode('hotwWidgetCode')">üìã Copy</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Assembly Mode Section -->
                    <div class="community-card">
                        <h4>üé§ Assembly Mode</h4>
                        <p class="community-card-desc">Full-screen displays for school assemblies and events</p>
                        
                        <div class="assembly-options">
                            <div class="assembly-option" onclick="launchAssemblyMode('standings')">
                                <div class="assembly-option-icon">üèÜ</div>
                                <div class="assembly-option-info">
                                    <h5>Live Standings</h5>
                                    <p>Large format house rankings with points</p>
                                </div>
                                <button class="btn btn-primary btn-sm">Launch</button>
                            </div>

                            <div class="assembly-option" onclick="launchAssemblyMode('celebration')">
                                <div class="assembly-option-icon">üéâ</div>
                                <div class="assembly-option-info">
                                    <h5>Celebration Mode</h5>
                                    <p>Announce winners with animations</p>
                                </div>
                                <button class="btn btn-primary btn-sm">Launch</button>
                            </div>

                            <div class="assembly-option" onclick="launchAssemblyMode('results')">
                                <div class="assembly-option-icon">üìä</div>
                                <div class="assembly-option-info">
                                    <h5>Event Results</h5>
                                    <p>Display recent event placements</p>
                                </div>
                                <button class="btn btn-primary btn-sm">Launch</button>
                            </div>

                            <div class="assembly-option" onclick="launchAssemblyMode('badges')">
                                <div class="assembly-option-icon">üéñÔ∏è</div>
                                <div class="assembly-option-info">
                                    <h5>Badge Showcase</h5>
                                    <p>Recently awarded badges</p>
                                </div>
                                <button class="btn btn-primary btn-sm">Launch</button>
                            </div>

                            <div class="assembly-option" onclick="launchAssemblyMode('countdown')">
                                <div class="assembly-option-icon">‚è±Ô∏è</div>
                                <div class="assembly-option-info">
                                    <h5>Event Countdown</h5>
                                    <p>Timer for upcoming events</p>
                                </div>
                                <button class="btn btn-primary btn-sm">Launch</button>
                            </div>

                            <div class="assembly-option" onclick="launchAssemblyMode('heritage')">
                                <div class="assembly-option-icon">üèîÔ∏è</div>
                                <div class="assembly-option-info">
                                    <h5>Heritage Display</h5>
                                    <p>Explorer facts and history</p>
                                </div>
                                <button class="btn btn-primary btn-sm">Launch</button>
                            </div>
                        </div>

                        <div class="assembly-tips">
                            <h5>üí° Tips for Assembly Display</h5>
                            <ul>
                                <li>Press <kbd>F11</kbd> for full screen</li>
                                <li>Press <kbd>ESC</kbd> to exit assembly mode</li>
                                <li>Use arrow keys to navigate slides</li>
                                <li>Best viewed on projector or large display</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Photo Gallery Section -->
                    <div class="community-card full-width">
                        <div class="gallery-header">
                            <h4>üì∏ House Photo Gallery</h4>
                            <div class="gallery-filters">
                                <button class="filter-btn active" data-gallery-filter="all">All</button>
                                <button class="filter-btn" data-gallery-filter="shackleton">üßä Shackleton</button>
                                <button class="filter-btn" data-gallery-filter="wilson">üé® Wilson</button>
                                <button class="filter-btn" data-gallery-filter="bowen">‚õ∞Ô∏è Bowen</button>
                                <button class="filter-btn" data-gallery-filter="scott">üß≠ Scott</button>
                            </div>
                        </div>
                        
                        <div class="photo-gallery" id="photoGallery">
                            <!-- Photos rendered by JS -->
                        </div>

                        <div class="gallery-upload" id="galleryUpload">
                            <div class="upload-zone" id="uploadZone">
                                <div class="upload-icon">üì§</div>
                                <p>Drag photos here or click to upload</p>
                                <p class="upload-hint">Accepted: JPG, PNG (max 5MB)</p>
                                <input type="file" id="photoUpload" accept="image/*" multiple hidden>
                            </div>
                            <div class="upload-form" id="uploadForm" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Event/Caption</label>
                                        <input type="text" id="photoCaption" placeholder="e.g., Swimming Carnival 2025">
                                    </div>
                                    <div class="form-group">
                                        <label>House</label>
                                        <select id="photoHouse">
                                            <option value="">General</option>
                                            <option value="shackleton">Shackleton</option>
                                            <option value="wilson">Wilson</option>
                                            <option value="bowen">Bowen</option>
                                            <option value="scott">Scott</option>
                                        </select>
                                    </div>
                                </div>
                                <button class="btn btn-primary" onclick="submitPhotos()">Upload Photos</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Faith & Service Page -->
            <div class="page" id="page-faith">
                <div class="section-header">
                    <div>
                        <h3 class="section-title">‚úùÔ∏è Faith & Service</h3>
                        <p class="section-subtitle">Living out our values through kindness, service, and faith</p>
                    </div>
                </div>

                <div class="faith-grid">
                    <!-- Kindness Wall -->
                    <div class="faith-card kindness-wall-card">
                        <div class="faith-card-header">
                            <h4>üíù Kindness Wall</h4>
                            <button class="btn btn-primary btn-sm" onclick="openKindnessModal()">+ Add Kindness</button>
                        </div>
                        <p class="faith-card-desc">Recognize acts of kindness in our school community</p>
                        
                        <div class="kindness-wall" id="kindnessWall">
                            <!-- Kindness cards rendered by JS -->
                        </div>
                    </div>

                    <!-- Service Hours Tracker -->
                    <div class="faith-card">
                        <h4>ü§ù Service Hours</h4>
                        <p class="faith-card-desc">Track volunteer and community service contributions</p>
                        
                        <div class="service-overview">
                            <div class="service-stat-card">
                                <div class="service-stat-icon">‚è±Ô∏è</div>
                                <div class="service-stat-value" id="totalServiceHours">0</div>
                                <div class="service-stat-label">Total Hours</div>
                            </div>
                            <div class="service-stat-card">
                                <div class="service-stat-icon">üë•</div>
                                <div class="service-stat-value" id="totalVolunteers">0</div>
                                <div class="service-stat-label">Volunteers</div>
                            </div>
                            <div class="service-stat-card">
                                <div class="service-stat-icon">üìç</div>
                                <div class="service-stat-value" id="totalProjects">0</div>
                                <div class="service-stat-label">Projects</div>
                            </div>
                        </div>

                        <div class="service-house-breakdown">
                            <h5>Service Hours by House</h5>
                            <div class="service-bars" id="serviceHouseBars">
                                <!-- Service bars rendered by JS -->
                            </div>
                        </div>

                        <div class="service-leaderboard">
                            <h5>Top Service Contributors</h5>
                            <div class="service-leaders" id="serviceLeaders">
                                <!-- Leaders rendered by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Mission Trips -->
                    <div class="faith-card">
                        <h4>‚úàÔ∏è Mission Trips</h4>
                        <p class="faith-card-desc">Supporting missions locally and around the world</p>
                        
                        <div class="mission-trips" id="missionTrips">
                            <!-- Mission trips rendered by JS -->
                        </div>

                        <div class="mission-support">
                            <h5>üôè How You Can Help</h5>
                            <div class="support-options">
                                <div class="support-option">
                                    <span class="support-icon">üí∞</span>
                                    <span>Fundraise</span>
                                </div>
                                <div class="support-option">
                                    <span class="support-icon">üì¶</span>
                                    <span>Donate Supplies</span>
                                </div>
                                <div class="support-option">
                                    <span class="support-icon">üôè</span>
                                    <span>Prayer Support</span>
                                </div>
                                <div class="support-option">
                                    <span class="support-icon">‚úâÔ∏è</span>
                                    <span>Write Letters</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Prayer & Encouragement Board -->
                    <div class="faith-card prayer-card">
                        <div class="faith-card-header">
                            <h4>üôè Prayer & Encouragement</h4>
                            <button class="btn btn-primary btn-sm" onclick="openPrayerModal()">+ Add Prayer</button>
                        </div>
                        <p class="faith-card-desc">Share prayer requests and words of encouragement</p>
                        
                        <div class="prayer-filters">
                            <button class="filter-btn active" data-prayer-filter="all">All</button>
                            <button class="filter-btn" data-prayer-filter="prayer">üôè Prayers</button>
                            <button class="filter-btn" data-prayer-filter="praise">üéâ Praise</button>
                            <button class="filter-btn" data-prayer-filter="encouragement">üí™ Encouragement</button>
                        </div>

                        <div class="prayer-board" id="prayerBoard">
                            <!-- Prayer cards rendered by JS -->
                        </div>
                    </div>

                    <!-- Faith Quote of the Day -->
                    <div class="faith-card quote-card full-width">
                        <div class="faith-quote" id="faithQuote">
                            <!-- Quote rendered by JS -->
                        </div>
                    </div>

                    <!-- Upcoming Service Events -->
                    <div class="faith-card full-width">
                        <h4>üìÖ Upcoming Service Opportunities</h4>
                        <div class="service-events" id="serviceEvents">
                            <!-- Service events rendered by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kindness Modal -->
            <div class="modal-overlay" id="kindnessModal">
                <div class="modal">
                    <h3>üíù Share an Act of Kindness</h3>
                    <form id="kindnessForm">
                        <div class="form-group">
                            <label>Who showed kindness?</label>
                            <input type="text" id="kindnessPerson" placeholder="e.g., Sarah from Year 10" required>
                        </div>
                        <div class="form-group">
                            <label>Their House</label>
                            <select id="kindnessHouse">
                                <option value="">Select house...</option>
                                <option value="shackleton">üßä Shackleton</option>
                                <option value="wilson">üé® Wilson</option>
                                <option value="bowen">‚õ∞Ô∏è Bowen</option>
                                <option value="scott">üß≠ Scott</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>What did they do?</label>
                            <textarea id="kindnessAction" placeholder="Describe the kind act..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label>Your name (optional)</label>
                            <input type="text" id="kindnessFrom" placeholder="Anonymous">
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="closeKindnessModal()">Cancel</button>
                            <button type="submit" class="btn btn-primary">Share Kindness üíù</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Prayer Modal -->
            <div class="modal-overlay" id="prayerModal">
                <div class="modal">
                    <h3>üôè Add Prayer or Encouragement</h3>
                    <form id="prayerForm">
                        <div class="form-group">
                            <label>Type</label>
                            <select id="prayerType" required>
                                <option value="prayer">üôè Prayer Request</option>
                                <option value="praise">üéâ Praise Report</option>
                                <option value="encouragement">üí™ Encouragement</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Your message</label>
                            <textarea id="prayerMessage" placeholder="Share your prayer, praise, or encouragement..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label>Your name (optional)</label>
                            <input type="text" id="prayerName" placeholder="Anonymous">
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="closePrayerModal()">Cancel</button>
                            <button type="submit" class="btn btn-primary">Post üôè</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Admin Panel -->
            <div class="admin-panel" id="adminPanel">
                <div class="admin-header">
                    <h3>üîê Admin Control Panel</h3>
                    <button class="admin-logout" id="adminLogout">Logout</button>
                </div>

                <div class="admin-tabs">
                    <button class="admin-tab active" data-section="events">Manage Events</button>
                    <button class="admin-tab" data-section="results">Update Results</button>
                    <button class="admin-tab" data-section="badges">Award Badges</button>
                    <button class="admin-tab" data-section="hunts">Badge Hunts</button>
                    <button class="admin-tab" data-section="feed">Feed & Spirit</button>
                    <button class="admin-tab" data-section="points">Adjust Points</button>
                    <button class="admin-tab" data-section="analytics">üìä Analytics</button>
                    <button class="admin-tab" data-section="export">üì§ Export</button>
                    <button class="admin-tab" data-section="settings">‚öôÔ∏è Settings</button>
                </div>

                <div class="admin-section active" id="admin-events">
                    <div class="admin-card">
                        <h4>Create New Event</h4>
                        <form id="createEventForm">
                            <div class="form-group">
                                <label>Event Name</label>
                                <input type="text" id="eventName" required placeholder="e.g., House Athletics Day">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date</label>
                                    <input type="date" id="eventDate" required>
                                </div>
                                <div class="form-group">
                                    <label>Time</label>
                                    <input type="time" id="eventTime" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="eventDescription" placeholder="Event details, what to bring, etc."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Rules & Expectations</label>
                                <textarea id="eventRules" placeholder="Competition rules, dress code, behavior expectations..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Points Available (for winner)</label>
                                <input type="number" id="eventPoints" required placeholder="e.g., 100">
                            </div>
                            <button type="submit" class="btn btn-primary">Create Event</button>
                        </form>
                    </div>

                    <div class="admin-card">
                        <h4>Current Events</h4>
                        <div id="adminEventsList">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <div class="admin-section" id="admin-results">
                    <div class="admin-card">
                        <h4>Record Event Results</h4>
                        <form id="recordResultsForm">
                            <div class="form-group">
                                <label>Select Event</label>
                                <select id="resultEventSelect">
                                    <option value="">Choose an event...</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>1st Place</label>
                                    <select id="result1st" class="house-select">
                                        <option value="">Select...</option>
                                        <option value="shackleton">Shackleton</option>
                                        <option value="wilson">Wilson</option>
                                        <option value="bowen">Bowen</option>
                                        <option value="scott">Scott</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>2nd Place</label>
                                    <select id="result2nd" class="house-select">
                                        <option value="">Select...</option>
                                        <option value="shackleton">Shackleton</option>
                                        <option value="wilson">Wilson</option>
                                        <option value="bowen">Bowen</option>
                                        <option value="scott">Scott</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>3rd Place</label>
                                    <select id="result3rd" class="house-select">
                                        <option value="">Select...</option>
                                        <option value="shackleton">Shackleton</option>
                                        <option value="wilson">Wilson</option>
                                        <option value="bowen">Bowen</option>
                                        <option value="scott">Scott</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>4th Place</label>
                                    <select id="result4th" class="house-select">
                                        <option value="">Select...</option>
                                        <option value="shackleton">Shackleton</option>
                                        <option value="wilson">Wilson</option>
                                        <option value="bowen">Bowen</option>
                                        <option value="scott">Scott</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Record Results</button>
                        </form>
                    </div>
                </div>

                <div class="admin-section" id="admin-badges">
                    <div class="admin-card">
                        <h4>Award Badge to House</h4>
                        <form id="awardBadgeForm">
                            <div class="form-group">
                                <label>Select Badge</label>
                                <select id="badgeSelect">
                                    <option value="">Choose a badge...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Award To</label>
                                <select id="badgeHouse">
                                    <option value="">Select house...</option>
                                    <option value="shackleton">Shackleton</option>
                                    <option value="wilson">Wilson</option>
                                    <option value="bowen">Bowen</option>
                                    <option value="scott">Scott</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Award Badge</button>
                        </form>
                    </div>

                    <div class="admin-card">
                        <h4>Recent Badge Awards</h4>
                        <div id="recentBadgeAwards">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <div class="admin-section" id="admin-hunts">
                    <div class="admin-card">
                        <h4>üéØ Create Badge Hunt</h4>
                        <form id="createHuntForm">
                            <div class="form-group">
                                <label>Hunt Name</label>
                                <input type="text" id="huntName" required placeholder="e.g., Service Week Challenge">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="huntDescription" placeholder="Describe the challenge..." required></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Badge Category</label>
                                    <select id="huntCategory" required>
                                        <option value="explorer">üåç Explorer (Service)</option>
                                        <option value="scholar">üìö Scholar (Academic)</option>
                                        <option value="performer">üé≠ Performer (Arts)</option>
                                        <option value="champion">üèÖ Champion (Sport)</option>
                                        <option value="disciple">‚úùÔ∏è Disciple (Faith)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Target Badges</label>
                                    <input type="number" id="huntTarget" required value="3" min="1" max="10">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Start Date</label>
                                    <input type="date" id="huntStartDate" required>
                                </div>
                                <div class="form-group">
                                    <label>End Date</label>
                                    <input type="date" id="huntEndDate" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Bonus Points for Completion</label>
                                <input type="number" id="huntBonus" required value="25" min="5" max="100">
                            </div>
                            <button type="submit" class="btn btn-primary">Create Badge Hunt</button>
                        </form>
                    </div>

                    <div class="admin-card">
                        <h4>Active & Upcoming Hunts</h4>
                        <div id="adminHuntsList">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <div class="admin-card">
                        <h4>Update Hunt Progress</h4>
                        <form id="updateHuntProgressForm">
                            <div class="form-group">
                                <label>Select Hunt</label>
                                <select id="huntSelect">
                                    <option value="">Choose a hunt...</option>
                                </select>
                            </div>
                            <div class="points-grid" style="margin: 1rem 0;">
                                <div class="points-card shackleton">
                                    <h5>Shackleton</h5>
                                    <input type="number" id="hunt-progress-shackleton" value="0" min="0" style="text-align: center;">
                                </div>
                                <div class="points-card wilson">
                                    <h5>Wilson</h5>
                                    <input type="number" id="hunt-progress-wilson" value="0" min="0" style="text-align: center;">
                                </div>
                                <div class="points-card bowen">
                                    <h5>Bowen</h5>
                                    <input type="number" id="hunt-progress-bowen" value="0" min="0" style="text-align: center;">
                                </div>
                                <div class="points-card scott">
                                    <h5>Scott</h5>
                                    <input type="number" id="hunt-progress-scott" value="0" min="0" style="text-align: center;">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Update Progress</button>
                        </form>
                    </div>
                </div>

                <div class="admin-section" id="admin-feed">
                    <div class="admin-card">
                        <h4>üì£ Post to House Feed</h4>
                        <form id="postFeedForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Post Type</label>
                                    <select id="feedPostType">
                                        <option value="shoutout">‚≠ê Shoutout</option>
                                        <option value="spirit">üëè Spirit Points</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>House</label>
                                    <select id="feedPostHouse">
                                        <option value="shackleton">Shackleton</option>
                                        <option value="wilson">Wilson</option>
                                        <option value="bowen">Bowen</option>
                                        <option value="scott">Scott</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Message</label>
                                <textarea id="feedPostContent" placeholder="What's the shoutout or achievement?" required></textarea>
                            </div>
                            <div class="form-group" id="spiritPointsGroup" style="display: none;">
                                <label>Spirit Points to Award</label>
                                <input type="number" id="feedSpiritPoints" value="10" min="1" max="50">
                            </div>
                            <button type="submit" class="btn btn-primary">Post to Feed</button>
                        </form>
                    </div>

                    <div class="admin-card">
                        <h4>üëè Bulk Spirit Points</h4>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">Award spirit points for event attendance or participation.</p>
                        <form id="bulkSpiritForm">
                            <div class="form-group">
                                <label>Reason</label>
                                <input type="text" id="spiritReason" placeholder="e.g., Athletics Day Attendance" required>
                            </div>
                            <div class="points-grid" style="margin-bottom: 1rem;">
                                <div class="points-card shackleton">
                                    <h5>Shackleton</h5>
                                    <input type="number" id="spirit-shackleton" value="0" min="0" style="text-align: center;">
                                </div>
                                <div class="points-card wilson">
                                    <h5>Wilson</h5>
                                    <input type="number" id="spirit-wilson" value="0" min="0" style="text-align: center;">
                                </div>
                                <div class="points-card bowen">
                                    <h5>Bowen</h5>
                                    <input type="number" id="spirit-bowen" value="0" min="0" style="text-align: center;">
                                </div>
                                <div class="points-card scott">
                                    <h5>Scott</h5>
                                    <input type="number" id="spirit-scott" value="0" min="0" style="text-align: center;">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Award Spirit Points</button>
                        </form>
                    </div>

                    <div class="admin-card">
                        <h4>Recent Feed Posts</h4>
                        <div id="recentFeedPosts" style="max-height: 300px; overflow-y: auto;">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <div class="admin-section" id="admin-points">
                    <div class="admin-card">
                        <h4>Direct Points Adjustment</h4>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">Use for special awards, corrections, or bonus points.</p>
                        <div class="points-grid">
                            <div class="points-card shackleton">
                                <h5>Shackleton</h5>
                                <div class="points-input-group">
                                    <button class="points-btn" onclick="adjustPoints('shackleton', -10)">-</button>
                                    <input type="number" id="shackleton-points" value="0">
                                    <button class="points-btn" onclick="adjustPoints('shackleton', 10)">+</button>
                                </div>
                            </div>
                            <div class="points-card wilson">
                                <h5>Wilson</h5>
                                <div class="points-input-group">
                                    <button class="points-btn" onclick="adjustPoints('wilson', -10)">-</button>
                                    <input type="number" id="wilson-points" value="0">
                                    <button class="points-btn" onclick="adjustPoints('wilson', 10)">+</button>
                                </div>
                            </div>
                            <div class="points-card bowen">
                                <h5>Bowen</h5>
                                <div class="points-input-group">
                                    <button class="points-btn" onclick="adjustPoints('bowen', -10)">-</button>
                                    <input type="number" id="bowen-points" value="0">
                                    <button class="points-btn" onclick="adjustPoints('bowen', 10)">+</button>
                                </div>
                            </div>
                            <div class="points-card scott">
                                <h5>Scott</h5>
                                <div class="points-input-group">
                                    <button class="points-btn" onclick="adjustPoints('scott', -10)">-</button>
                                    <input type="number" id="scott-points" value="0">
                                    <button class="points-btn" onclick="adjustPoints('scott', 10)">+</button>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 1.5rem;">
                            <button class="btn btn-primary" onclick="applyPointsAdjustment()">Apply Adjustments</button>
                        </div>
                    </div>
                </div>

                <!-- Analytics Section -->
                <div class="admin-section" id="admin-analytics">
                    <div class="analytics-overview">
                        <div class="analytics-card">
                            <div class="analytics-icon">üìà</div>
                            <div class="analytics-value" id="totalPointsAwarded">0</div>
                            <div class="analytics-label">Total Points Awarded</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-icon">üéñÔ∏è</div>
                            <div class="analytics-value" id="totalBadgesAwarded">0</div>
                            <div class="analytics-label">Badges Awarded</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-icon">üèÜ</div>
                            <div class="analytics-value" id="totalEventsCompleted">0</div>
                            <div class="analytics-label">Events Completed</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-icon">üí¨</div>
                            <div class="analytics-value" id="totalFeedPosts">0</div>
                            <div class="analytics-label">Feed Posts</div>
                        </div>
                    </div>

                    <div class="admin-card">
                        <h4>üìä Points Trend (Last 8 Weeks)</h4>
                        <div class="chart-container">
                            <canvas id="pointsTrendChart"></canvas>
                        </div>
                    </div>

                    <div class="admin-card">
                        <h4>ü•ß Badge Distribution by Category</h4>
                        <div class="chart-container chart-small">
                            <canvas id="badgeDistChart"></canvas>
                        </div>
                    </div>

                    <div class="admin-card">
                        <h4>üèÖ House Performance Comparison</h4>
                        <div class="chart-container">
                            <canvas id="houseComparisonChart"></canvas>
                        </div>
                    </div>

                    <div class="admin-card">
                        <h4>üìã Activity Summary</h4>
                        <div class="activity-summary" id="activitySummary">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Export Section -->
                <div class="admin-section" id="admin-export">
                    <div class="admin-card">
                        <h4>üì§ Export Reports</h4>
                        <p style="color: var(--text-muted); margin-bottom: 1.5rem;">Generate and download reports for assemblies, newsletters, or record-keeping.</p>
                        
                        <div class="export-options">
                            <div class="export-option">
                                <div class="export-icon">üìä</div>
                                <div class="export-info">
                                    <h5>Current Standings Report</h5>
                                    <p>House points, rankings, streaks, and badge counts</p>
                                </div>
                                <div class="export-actions">
                                    <button class="btn btn-primary btn-sm" onclick="exportStandings('csv')">CSV</button>
                                    <button class="btn btn-secondary btn-sm" onclick="exportStandings('print')">Print</button>
                                </div>
                            </div>

                            <div class="export-option">
                                <div class="export-icon">üéñÔ∏è</div>
                                <div class="export-info">
                                    <h5>Badge Awards Report</h5>
                                    <p>All badge awards with dates and houses</p>
                                </div>
                                <div class="export-actions">
                                    <button class="btn btn-primary btn-sm" onclick="exportBadges('csv')">CSV</button>
                                    <button class="btn btn-secondary btn-sm" onclick="exportBadges('print')">Print</button>
                                </div>
                            </div>

                            <div class="export-option">
                                <div class="export-icon">üèÜ</div>
                                <div class="export-info">
                                    <h5>Event Results Report</h5>
                                    <p>All completed events with placements and points</p>
                                </div>
                                <div class="export-actions">
                                    <button class="btn btn-primary btn-sm" onclick="exportEvents('csv')">CSV</button>
                                    <button class="btn btn-secondary btn-sm" onclick="exportEvents('print')">Print</button>
                                </div>
                            </div>

                            <div class="export-option">
                                <div class="export-icon">üìú</div>
                                <div class="export-info">
                                    <h5>Full Audit Log</h5>
                                    <p>Complete history of all admin actions</p>
                                </div>
                                <div class="export-actions">
                                    <button class="btn btn-primary btn-sm" onclick="exportAuditLog('csv')">CSV</button>
                                    <button class="btn btn-secondary btn-sm" onclick="exportAuditLog('print')">Print</button>
                                </div>
                            </div>

                            <div class="export-option">
                                <div class="export-icon">üì∞</div>
                                <div class="export-info">
                                    <h5>Newsletter Summary</h5>
                                    <p>Formatted summary for school newsletter</p>
                                </div>
                                <div class="export-actions">
                                    <button class="btn btn-primary btn-sm" onclick="exportNewsletter()">Generate</button>
                                </div>
                            </div>

                            <div class="export-option">
                                <div class="export-icon">üé§</div>
                                <div class="export-info">
                                    <h5>Assembly Slides Data</h5>
                                    <p>Key stats formatted for presentation</p>
                                </div>
                                <div class="export-actions">
                                    <button class="btn btn-primary btn-sm" onclick="exportAssemblyData()">Generate</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="admin-card">
                        <h4>üìÖ Scheduled Posts</h4>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">Schedule feed posts to go live at a specific time.</p>
                        
                        <form id="scheduledPostForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Post Type</label>
                                    <select id="scheduledPostType">
                                        <option value="shoutout">‚≠ê Shoutout</option>
                                        <option value="announcement">üì¢ Announcement</option>
                                        <option value="reminder">‚è∞ Reminder</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>House (optional)</label>
                                    <select id="scheduledPostHouse">
                                        <option value="">All Houses</option>
                                        <option value="shackleton">üßä Shackleton</option>
                                        <option value="wilson">üé® Wilson</option>
                                        <option value="bowen">‚õ∞Ô∏è Bowen</option>
                                        <option value="scott">üß≠ Scott</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Content</label>
                                <textarea id="scheduledPostContent" placeholder="Post content..." required></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Schedule Date</label>
                                    <input type="date" id="scheduledPostDate" required>
                                </div>
                                <div class="form-group">
                                    <label>Schedule Time</label>
                                    <input type="time" id="scheduledPostTime" required>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Schedule Post</button>
                        </form>

                        <div class="scheduled-posts-list" id="scheduledPostsList">
                            <h5 style="margin-top: 1.5rem;">Upcoming Scheduled Posts</h5>
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div class="admin-section" id="admin-settings">
                    <div class="admin-card">
                        <h4>üë• Admin Roles</h4>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">Manage who has access to admin features.</p>
                        
                        <div class="admin-roles-list" id="adminRolesList">
                            <!-- Populated by JS -->
                        </div>

                        <form id="addAdminForm" style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                            <h5>Add New Admin</h5>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Name</label>
                                    <input type="text" id="newAdminName" placeholder="e.g., Mr. Johnson" required>
                                </div>
                                <div class="form-group">
                                    <label>Role</label>
                                    <select id="newAdminRole">
                                        <option value="super">Super Admin (Full Access)</option>
                                        <option value="house">House Captain (Limited)</option>
                                        <option value="viewer">Viewer (Read Only)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>House (for House Captains)</label>
                                <select id="newAdminHouse">
                                    <option value="">N/A</option>
                                    <option value="shackleton">Shackleton</option>
                                    <option value="wilson">Wilson</option>
                                    <option value="bowen">Bowen</option>
                                    <option value="scott">Scott</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Admin</button>
                        </form>
                    </div>

                    <div class="admin-card">
                        <h4>üìã Audit Log</h4>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">Track all admin actions for accountability.</p>
                        
                        <div class="audit-filters">
                            <select id="auditFilterType" onchange="filterAuditLog()">
                                <option value="all">All Actions</option>
                                <option value="points">Points Changes</option>
                                <option value="badges">Badge Awards</option>
                                <option value="events">Event Results</option>
                                <option value="feed">Feed Posts</option>
                                <option value="admin">Admin Changes</option>
                            </select>
                            <select id="auditFilterHouse" onchange="filterAuditLog()">
                                <option value="all">All Houses</option>
                                <option value="shackleton">Shackleton</option>
                                <option value="wilson">Wilson</option>
                                <option value="bowen">Bowen</option>
                                <option value="scott">Scott</option>
                            </select>
                        </div>

                        <div class="audit-log" id="auditLog">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <div class="admin-card">
                        <h4>‚öôÔ∏è Competition Settings</h4>
                        
                        <div class="settings-group">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h5>Points per Event Position</h5>
                                    <p>1st: 50pts, 2nd: 30pts, 3rd: 20pts, 4th: 10pts</p>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="showToast('Contact developer to change', 'info')">Edit</button>
                            </div>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h5>Badge Points</h5>
                                    <p>1st: 10pts, 2nd: 5pts, 3rd: 2pts, 4th: 1pt</p>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="showToast('Contact developer to change', 'info')">Edit</button>
                            </div>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h5>Spirit Points Conversion</h5>
                                    <p>50% of spirit points convert to house points</p>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="showToast('Contact developer to change', 'info')">Edit</button>
                            </div>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h5>Streak Bonus System</h5>
                                    <p>2-streak: +5%, 3-streak: +10%, 4-streak: +15%, 5+: +20%</p>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="showToast('Contact developer to change', 'info')">Edit</button>
                            </div>
                        </div>
                    </div>

                    <div class="admin-card danger-zone">
                        <h4>‚ö†Ô∏è Danger Zone</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <h5>Reset Competition</h5>
                                <p>Clear all points, badges, and results for new year</p>
                            </div>
                            <button class="btn btn-danger btn-sm" onclick="confirmReset()">Reset All</button>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <h5>Archive Current Year</h5>
                                <p>Save current data before starting fresh</p>
                            </div>
                            <button class="btn btn-secondary btn-sm" onclick="archiveYear()">Archive</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>MGS House Competition ¬© 2025 | <a href="https://www.middleton.school.nz" target="_blank">Middleton Grange School</a></p>
            <p style="margin-top: 0.5rem;">30 Acacia Ave, Upper Riccarton, Christchurch 8041, New Zealand</p>
        </footer>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <h3>üîê Admin Login</h3>
            <form id="loginForm">
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter admin password">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                <button type="button" class="btn btn-secondary" style="width: 100%; margin-top: 0.5rem;" onclick="closeLoginModal()">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // =====================
        // DATA STORE (Demo - would be Firebase in production)
        // =====================
        let appData = {
            houses: {
                shackleton: {
                    name: 'Shackleton',
                    explorer: 'Sir Ernest Henry Shackleton',
                    icon: 'üßä',
                    color: 'shackleton',
                    points: 847,
                    badgesEarned: 24,
                    eventsWon: 5,
                    streak: 3, // Consecutive first-place badge wins
                    weeklyActivity: { badges: 4, events: 1, points: 78 },
                    spiritPoints: 156
                },
                wilson: {
                    name: 'Wilson',
                    explorer: 'Dr Edward Adrian Wilson',
                    icon: 'üé®',
                    color: 'wilson',
                    points: 792,
                    badgesEarned: 22,
                    eventsWon: 4,
                    streak: 0,
                    weeklyActivity: { badges: 2, events: 1, points: 45 },
                    spiritPoints: 142
                },
                bowen: {
                    name: 'Bowen',
                    explorer: 'Sir Charles Christopher Bowen',
                    icon: '‚õ∞Ô∏è',
                    color: 'bowen',
                    points: 815,
                    badgesEarned: 23,
                    eventsWon: 4,
                    streak: 1,
                    weeklyActivity: { badges: 3, events: 0, points: 52 },
                    spiritPoints: 168
                },
                scott: {
                    name: 'Scott',
                    explorer: 'Captain Robert Falcon Scott',
                    icon: 'üß≠',
                    color: 'scott',
                    points: 763,
                    badgesEarned: 20,
                    eventsWon: 3,
                    streak: 0,
                    weeklyActivity: { badges: 5, events: 2, points: 95 },
                    spiritPoints: 135
                }
            },
            events: [
                {
                    id: 1,
                    name: 'House Athletics Day',
                    date: '2025-02-15',
                    time: '09:00',
                    description: 'Annual athletics competition featuring track and field events. All students participate in at least 2 events.',
                    rules: 'Full PE uniform required. House colors encouraged. Be at the track by 8:45am.',
                    points: 150,
                    status: 'upcoming'
                },
                {
                    id: 2,
                    name: 'House Singing Competition',
                    date: '2025-03-20',
                    time: '13:30',
                    description: 'Each house performs a unified song with choreography. Judged on harmony, creativity, and participation.',
                    rules: 'All house members must participate. No backing tracks allowed. 5-minute maximum.',
                    points: 100,
                    status: 'upcoming'
                },
                {
                    id: 3,
                    name: 'Cross Country',
                    date: '2025-01-10',
                    time: '10:00',
                    description: 'The annual cross country race through the school grounds and surrounding area.',
                    rules: 'Running shoes required. Water stations at 1km and 2km marks.',
                    points: 120,
                    status: 'completed',
                    results: {
                        '1st': 'shackleton',
                        '2nd': 'bowen',
                        '3rd': 'wilson',
                        '4th': 'scott'
                    }
                },
                {
                    id: 4,
                    name: 'Lip Sync Battle',
                    date: '2024-12-05',
                    time: '14:00',
                    description: 'Creative lip sync performance competition. Houses battle for supremacy!',
                    rules: 'Song must be school-appropriate. Costumes encouraged. 3-minute limit.',
                    points: 80,
                    status: 'completed',
                    results: {
                        '1st': 'wilson',
                        '2nd': 'scott',
                        '3rd': 'shackleton',
                        '4th': 'bowen'
                    }
                },
                {
                    id: 5,
                    name: 'Kapa Haka Performance',
                    date: '2025-04-15',
                    time: '11:00',
                    description: 'Traditional MƒÅori performing arts competition. Houses showcase their cultural skills.',
                    rules: 'Respectful performance expected. Traditional dress optional but encouraged.',
                    points: 100,
                    status: 'upcoming'
                }
            ],
            badges: generateBadges(),
            feed: [
                {
                    id: 1,
                    type: 'badge',
                    house: 'shackleton',
                    content: 'Earned the <strong>Community Clean-up</strong> badge ‚Äî first house to complete 50 hours of community service this term!',
                    points: 10,
                    timestamp: new Date(Date.now() - 1000 * 60 * 30) // 30 mins ago
                },
                {
                    id: 2,
                    type: 'event',
                    house: 'wilson',
                    content: 'Won the <strong>Lip Sync Battle</strong> with an incredible performance of "Don\'t Stop Me Now"! üé§',
                    points: 80,
                    timestamp: new Date(Date.now() - 1000 * 60 * 60 * 2) // 2 hours ago
                },
                {
                    id: 3,
                    type: 'spirit',
                    house: 'bowen',
                    content: 'Had the highest attendance at Cross Country with <strong>94% participation</strong>! Amazing house spirit! üèÉ',
                    points: 25,
                    timestamp: new Date(Date.now() - 1000 * 60 * 60 * 5) // 5 hours ago
                },
                {
                    id: 4,
                    type: 'shoutout',
                    house: 'scott',
                    content: 'Shoutout to the Year 10 Scott students who organized the lunch-time basketball tournament! Great initiative! üèÄ',
                    points: 0,
                    timestamp: new Date(Date.now() - 1000 * 60 * 60 * 8) // 8 hours ago
                },
                {
                    id: 5,
                    type: 'badge',
                    house: 'bowen',
                    content: 'Earned the <strong>Drama Star</strong> badge for outstanding performances in the school production!',
                    points: 10,
                    timestamp: new Date(Date.now() - 1000 * 60 * 60 * 24) // 1 day ago
                },
                {
                    id: 6,
                    type: 'spirit',
                    house: 'shackleton',
                    content: 'Best dressed house at Athletics Day! <strong>87% wore house colors</strong> ‚Äî that\'s dedication! üíô',
                    points: 15,
                    timestamp: new Date(Date.now() - 1000 * 60 * 60 * 26) // 26 hours ago
                },
                {
                    id: 7,
                    type: 'event',
                    house: 'shackleton',
                    content: 'Dominated the <strong>Cross Country</strong> event with 3 runners in the top 10!',
                    points: 120,
                    timestamp: new Date(Date.now() - 1000 * 60 * 60 * 48) // 2 days ago
                },
                {
                    id: 8,
                    type: 'shoutout',
                    house: 'wilson',
                    content: 'Thank you Wilson House for helping set up chairs for assembly every day this week! True servants! üôè',
                    points: 0,
                    timestamp: new Date(Date.now() - 1000 * 60 * 60 * 72) // 3 days ago
                }
            ],
            topParticipants: [
                { name: 'Sarah M.', house: 'bowen', events: 12 },
                { name: 'James T.', house: 'shackleton', events: 11 },
                { name: 'Emma W.', house: 'wilson', events: 10 },
                { name: 'Liam K.', house: 'scott', events: 9 },
                { name: 'Olivia R.', house: 'shackleton', events: 9 }
            ],
            badgeHunts: [
                {
                    id: 1,
                    name: 'Service Week Challenge',
                    description: 'Complete 3 Explorer badges this week to earn bonus points!',
                    category: 'explorer',
                    targetBadges: 3,
                    bonusPoints: 25,
                    startDate: new Date(Date.now() - 1000 * 60 * 60 * 24 * 2),
                    endDate: new Date(Date.now() + 1000 * 60 * 60 * 24 * 5),
                    active: true,
                    progress: { shackleton: 2, wilson: 1, bowen: 3, scott: 1 }
                },
                {
                    id: 2,
                    name: 'Arts Showcase Sprint',
                    description: 'First house to earn 5 Performer badges wins 50 bonus points!',
                    category: 'performer',
                    targetBadges: 5,
                    bonusPoints: 50,
                    startDate: new Date(Date.now() + 1000 * 60 * 60 * 24 * 7),
                    endDate: new Date(Date.now() + 1000 * 60 * 60 * 24 * 21),
                    active: false,
                    progress: { shackleton: 0, wilson: 0, bowen: 0, scott: 0 }
                }
            ],
            badgeTiers: {
                bronze: { min: 0, max: 29, name: 'Bronze', emoji: 'ü•â', color: '#cd7f32' },
                silver: { min: 30, max: 59, name: 'Silver', emoji: 'ü•à', color: '#c0c0c0' },
                gold: { min: 60, max: 99, name: 'Gold', emoji: 'ü•á', color: '#ffd700' },
                platinum: { min: 100, max: 149, name: 'Platinum', emoji: 'üíé', color: '#e5e4e2' },
                legendary: { min: 150, max: 999, name: 'Legendary', emoji: 'üëë', color: '#9b59b6' }
            },
            records: [
                { icon: 'üèÜ', title: 'Most Points (Year)', value: '2,847 pts', holder: 'Scott', houseKey: 'scott', year: '2019' },
                { icon: 'üéñÔ∏è', title: 'Most Badges (Year)', value: '67 badges', holder: 'Shackleton', houseKey: 'shackleton', year: '2022' },
                { icon: 'üî•', title: 'Longest Winning Streak', value: '8 events', holder: 'Bowen', houseKey: 'bowen', year: '2021' },
                { icon: 'üèÉ', title: 'Athletics Day Record', value: '342 pts', holder: 'Wilson', houseKey: 'wilson', year: '2018' },
                { icon: 'üé≠', title: 'House Singing Victory', value: '98.5/100', holder: 'Shackleton', houseKey: 'shackleton', year: '2023' },
                { icon: 'üìö', title: 'Most Scholar Badges', value: '24 badges', holder: 'Scott', houseKey: 'scott', year: '2020' },
                { icon: 'üí™', title: 'Swimming Carnival Record', value: '285 pts', holder: 'Bowen', houseKey: 'bowen', year: '2019' },
                { icon: '‚ú®', title: 'Spirit Points Record', value: '412 pts', holder: 'Wilson', houseKey: 'wilson', year: '2024' },
                { icon: 'üåü', title: 'Service Hours Record', value: '1,247 hrs', holder: 'Bowen', houseKey: 'bowen', year: '2023' },
                { icon: 'üëë', title: 'Most Championships', value: '12 titles', holder: 'Shackleton', houseKey: 'shackleton', year: 'All-time' },
                { icon: 'üéØ', title: 'Badge Hunt Wins', value: '7 hunts', holder: 'Scott', houseKey: 'scott', year: 'All-time' },
                { icon: '‚ö°', title: 'Fastest to 1000 pts', value: 'Week 6', holder: 'Bowen', houseKey: 'bowen', year: '2022' }
            ],
            anniversaries: [
                { date: '2026-01-17', title: 'üèîÔ∏è South Pole Anniversary', description: 'Scott, Wilson & team reached the South Pole (1912)', years: 114 },
                { date: '2026-02-15', title: 'üßä Shackleton Birthday', description: 'Sir Ernest Shackleton was born (1874)', years: 152 },
                { date: '2026-03-29', title: '‚úùÔ∏è Scott & Wilson Memorial', description: 'Scott, Wilson & Bowers died in their tent (1912)', years: 114 },
                { date: '2026-07-23', title: 'üé® Wilson Birthday', description: 'Dr Edward Wilson was born (1872)', years: 154 },
                { date: '2026-06-06', title: 'üß≠ Scott Birthday', description: 'Captain Robert Falcon Scott was born (1868)', years: 158 },
                { date: '2026-08-29', title: '‚õ∞Ô∏è Bowen Birthday', description: 'Sir Charles Bowen was born (1830)', years: 196 },
                { date: '2026-11-21', title: 'üö¢ Endurance Sank', description: 'Shackleton\'s ship sank in Weddell Sea (1915)', years: 111 },
                { date: '2026-12-16', title: 'üè† Charlotte Jane Arrived', description: 'Bowen family arrived in Canterbury (1850)', years: 176 },
                { date: '2025-03-09', title: 'üîç Endurance Found', description: 'Shackleton\'s ship discovered on seafloor (2022)', years: 3 }
            ],
            auditLog: [
                { id: 1, type: 'points', action: 'Added 50 points to Shackleton', user: 'Mr. Thompson', house: 'shackleton', timestamp: new Date(Date.now() - 1000 * 60 * 30) },
                { id: 2, type: 'badges', action: 'Awarded "Community Clean-up" badge to Bowen (1st)', user: 'Mr. Thompson', house: 'bowen', timestamp: new Date(Date.now() - 1000 * 60 * 60 * 2) },
                { id: 3, type: 'events', action: 'Recorded results for Swimming Carnival', user: 'Mrs. Roberts', house: null, timestamp: new Date(Date.now() - 1000 * 60 * 60 * 24) },
                { id: 4, type: 'feed', action: 'Posted shoutout for Wilson House', user: 'Mr. Thompson', house: 'wilson', timestamp: new Date(Date.now() - 1000 * 60 * 60 * 24 * 2) },
                { id: 5, type: 'points', action: 'Awarded 25 spirit points to all houses', user: 'Mrs. Roberts', house: null, timestamp: new Date(Date.now() - 1000 * 60 * 60 * 24 * 3) },
                { id: 6, type: 'admin', action: 'Added new admin: Miss Chen (House Captain)', user: 'Mr. Thompson', house: 'scott', timestamp: new Date(Date.now() - 1000 * 60 * 60 * 24 * 5) },
                { id: 7, type: 'badges', action: 'Awarded "Science Fair Victor" badge to Scott (1st)', user: 'Mrs. Roberts', house: 'scott', timestamp: new Date(Date.now() - 1000 * 60 * 60 * 24 * 6) },
                { id: 8, type: 'events', action: 'Created new event: Cross Country', user: 'Mr. Thompson', house: null, timestamp: new Date(Date.now() - 1000 * 60 * 60 * 24 * 7) }
            ],
            scheduledPosts: [
                { id: 1, type: 'announcement', house: null, content: 'üèÜ Reminder: Athletics Day is next Friday! Wear your house colours!', scheduledFor: new Date(Date.now() + 1000 * 60 * 60 * 24 * 2) },
                { id: 2, type: 'shoutout', house: 'bowen', content: 'Congratulations to Bowen House for their amazing community service last week!', scheduledFor: new Date(Date.now() + 1000 * 60 * 60 * 24 * 5) }
            ],
            adminRoles: [
                { id: 1, name: 'Mr. Thompson', role: 'super', house: null, initials: 'MT' },
                { id: 2, name: 'Mrs. Roberts', role: 'super', house: null, initials: 'MR' },
                { id: 3, name: 'Miss Chen', role: 'house', house: 'scott', initials: 'MC' },
                { id: 4, name: 'Mr. Patel', role: 'house', house: 'shackleton', initials: 'MP' },
                { id: 5, name: 'Mrs. Wilson', role: 'house', house: 'wilson', initials: 'MW' },
                { id: 6, name: 'Mr. Brown', role: 'house', house: 'bowen', initials: 'MB' }
            ],
            weeklyPointsHistory: [
                { week: 'Week 1', shackleton: 120, wilson: 95, bowen: 110, scott: 85 },
                { week: 'Week 2', shackleton: 245, wilson: 210, bowen: 230, scott: 195 },
                { week: 'Week 3', shackleton: 380, wilson: 340, bowen: 395, scott: 310 },
                { week: 'Week 4', shackleton: 520, wilson: 480, bowen: 545, scott: 440 },
                { week: 'Week 5', shackleton: 680, wilson: 620, bowen: 710, scott: 585 },
                { week: 'Week 6', shackleton: 850, wilson: 780, bowen: 875, scott: 745 },
                { week: 'Week 7', shackleton: 1020, wilson: 940, bowen: 1050, scott: 905 },
                { week: 'Week 8', shackleton: 1245, wilson: 1180, bowen: 1320, scott: 1105 }
            ],
            photos: [
                { id: 1, caption: 'Swimming Carnival 2025', house: 'bowen', url: null, event: 'swimming', date: '2025-02-15' },
                { id: 2, caption: 'House Singing Practice', house: 'shackleton', url: null, event: 'singing', date: '2025-02-10' },
                { id: 3, caption: 'Athletics Day Relay', house: 'wilson', url: null, event: 'athletics', date: '2025-01-28' },
                { id: 4, caption: 'Quiz Night Champions', house: 'scott', url: null, event: 'quiz', date: '2025-02-01' },
                { id: 5, caption: 'Community Service Day', house: 'bowen', url: null, event: 'service', date: '2025-01-20' },
                { id: 6, caption: 'Chapel Service', house: null, url: null, event: 'chapel', date: '2025-02-05' },
                { id: 7, caption: 'Cross Country Run', house: 'shackleton', url: null, event: 'athletics', date: '2025-01-15' },
                { id: 8, caption: 'Drama Performance', house: 'wilson', url: null, event: 'arts', date: '2025-01-25' }
            ],
            // Faith & Service Data
            kindnessWall: [
                { id: 1, person: 'Emma S.', house: 'wilson', action: 'Helped a new student find their way around school and sat with them at lunch all week.', from: 'Mrs. Thompson', date: new Date(Date.now() - 1000 * 60 * 60 * 2), reactions: { heart: 12, pray: 3 } },
                { id: 2, person: 'James L.', house: 'shackleton', action: 'Organised a surprise thank-you card for our caretaker Mr. Roberts.', from: 'Year 9 Class', date: new Date(Date.now() - 1000 * 60 * 60 * 24), reactions: { heart: 24, pray: 5 } },
                { id: 3, person: 'Sophie M.', house: 'bowen', action: 'Spent her lunch breaks teaching younger students how to play chess.', from: 'Anonymous', date: new Date(Date.now() - 1000 * 60 * 60 * 48), reactions: { heart: 18, pray: 2 } },
                { id: 4, person: 'Ryan T.', house: 'scott', action: 'Donated his birthday money to the school mission fund.', from: 'Mr. Patel', date: new Date(Date.now() - 1000 * 60 * 60 * 72), reactions: { heart: 31, pray: 8 } },
                { id: 5, person: 'Mia K.', house: 'wilson', action: 'Made get-well cards for every patient at Burwood Hospital children\'s ward.', from: 'Miss Chen', date: new Date(Date.now() - 1000 * 60 * 60 * 96), reactions: { heart: 45, pray: 12 } }
            ],
            serviceHours: {
                shackleton: { hours: 342, volunteers: 28, projects: 12 },
                wilson: { hours: 298, volunteers: 24, projects: 10 },
                bowen: { hours: 385, volunteers: 31, projects: 14 },
                scott: { hours: 276, volunteers: 22, projects: 9 }
            },
            serviceLeaders: [
                { name: 'Grace W.', house: 'bowen', hours: 48 },
                { name: 'Daniel H.', house: 'shackleton', hours: 42 },
                { name: 'Olivia T.', house: 'wilson', hours: 38 },
                { name: 'Ethan R.', house: 'scott', hours: 35 },
                { name: 'Chloe M.', house: 'bowen', hours: 32 }
            ],
            missionTrips: [
                { id: 1, name: 'Fiji School Building', location: 'Suva, Fiji', icon: 'üè´', dates: 'April 15-22, 2025', status: 'upcoming', raised: 8500, goal: 15000, description: 'Building classrooms for Nasinu Primary School' },
                { id: 2, name: 'Cambodia Water Wells', location: 'Siem Reap, Cambodia', icon: 'üíß', dates: 'July 5-15, 2025', status: 'upcoming', raised: 3200, goal: 12000, description: 'Installing clean water systems in rural villages' },
                { id: 3, name: 'Local Food Bank', location: 'Christchurch', icon: 'ü•´', dates: 'Ongoing', status: 'active', raised: null, goal: null, description: 'Weekly volunteering at City Mission' }
            ],
            prayerBoard: [
                { id: 1, type: 'prayer', message: 'Please pray for my grandmother who is unwell. She\'s been in hospital for a week.', name: 'Sarah', date: new Date(Date.now() - 1000 * 60 * 60 * 4), prayedCount: 23 },
                { id: 2, type: 'praise', message: 'My dad got the job he interviewed for! God is so good! üôå', name: 'Anonymous', date: new Date(Date.now() - 1000 * 60 * 60 * 12), prayedCount: 45 },
                { id: 3, type: 'encouragement', message: 'To everyone stressing about exams - you\'ve got this! Remember Philippians 4:13 üí™', name: 'Josh', date: new Date(Date.now() - 1000 * 60 * 60 * 24), prayedCount: 67 },
                { id: 4, type: 'prayer', message: 'Praying for our mission team heading to Fiji. Safe travels and open hearts.', name: 'Mrs. Roberts', date: new Date(Date.now() - 1000 * 60 * 60 * 36), prayedCount: 89 },
                { id: 5, type: 'praise', message: 'Our house raised over $2000 for the Cambodia trip! So proud of everyone!', name: 'Wilson House', date: new Date(Date.now() - 1000 * 60 * 60 * 48), prayedCount: 34 }
            ],
            faithQuotes: [
                { text: 'For I know the plans I have for you, declares the Lord, plans to prosper you and not to harm you, plans to give you hope and a future.', reference: 'Jeremiah 29:11' },
                { text: 'Be strong and courageous. Do not be afraid; do not be discouraged, for the Lord your God will be with you wherever you go.', reference: 'Joshua 1:9' },
                { text: 'Trust in the Lord with all your heart and lean not on your own understanding; in all your ways submit to him, and he will make your paths straight.', reference: 'Proverbs 3:5-6' },
                { text: 'I can do all things through Christ who strengthens me.', reference: 'Philippians 4:13' },
                { text: 'Love is patient, love is kind. It does not envy, it does not boast, it is not proud.', reference: '1 Corinthians 13:4' },
                { text: 'The Lord is my shepherd, I lack nothing. He makes me lie down in green pastures, he leads me beside quiet waters, he refreshes my soul.', reference: 'Psalm 23:1-3' },
                { text: 'Do not be anxious about anything, but in every situation, by prayer and petition, with thanksgiving, present your requests to God.', reference: 'Philippians 4:6' }
            ],
            serviceEvents: [
                { id: 1, name: 'Beach Clean-up', location: 'New Brighton Beach', date: '2025-02-22', spots: 15, description: 'Help clean our beautiful coastline' },
                { id: 2, name: 'Retirement Home Visit', location: 'Mary Potter Hospice', date: '2025-02-28', spots: 8, description: 'Singing and games with residents' },
                { id: 3, name: 'Food Bank Sorting', location: 'City Mission', date: '2025-03-01', spots: 12, description: 'Sort and pack food parcels' },
                { id: 4, name: 'Tree Planting Day', location: 'Hagley Park', date: '2025-03-08', spots: 25, description: 'Plant native trees in the park' }
            ],
            isAdmin: false,
            logoClickCount: 0
        };

        // Generate detailed badges with unique emojis
        function generateBadges() {
            const badgeDefinitions = {
                explorer: [
                    { name: 'Community Clean-up', emoji: 'üßπ', desc: 'Organized or led a community clean-up event' },
                    { name: 'Food Bank Hero', emoji: 'ü•´', desc: 'Collected 100+ items for the food bank' },
                    { name: 'Elderly Companion', emoji: 'üë¥', desc: 'Visited retirement home 5+ times' },
                    { name: 'Mission Heart', emoji: '‚úàÔ∏è', desc: 'Participated in a mission trip' },
                    { name: 'Fundraiser Champion', emoji: 'üí∞', desc: 'Raised $500+ for charity' },
                    { name: 'Green Warrior', emoji: 'üå±', desc: 'Led environmental initiative' },
                    { name: 'Peer Tutor', emoji: 'üìñ', desc: 'Tutored classmates for 20+ hours' },
                    { name: 'Hospital Helper', emoji: 'üè•', desc: 'Volunteered at hospital/hospice' },
                    { name: 'Refugee Friend', emoji: 'ü§ù', desc: 'Helped refugee family settle' },
                    { name: 'Animal Advocate', emoji: 'üêæ', desc: 'Volunteered at animal shelter' },
                    { name: 'Beach Guardian', emoji: 'üèñÔ∏è', desc: 'Participated in beach clean-up' },
                    { name: 'Soup Kitchen Star', emoji: 'üç≤', desc: 'Served at soup kitchen 10+ times' },
                    { name: 'Blanket Maker', emoji: 'üß∂', desc: 'Made blankets for those in need' },
                    { name: 'Letter Writer', emoji: '‚úâÔ∏è', desc: 'Wrote letters to isolated elderly' },
                    { name: 'Garden Grower', emoji: 'ü•ï', desc: 'Grew vegetables for community' },
                    { name: 'Tech Helper', emoji: 'üíª', desc: 'Taught tech skills to seniors' },
                    { name: 'First Aid Ready', emoji: 'ü©π', desc: 'Completed first aid certification' },
                    { name: 'Disaster Relief', emoji: 'üö®', desc: 'Helped in disaster response' },
                    { name: 'Habitat Builder', emoji: 'üè†', desc: 'Helped build/repair homes' },
                    { name: 'Blood Donor', emoji: 'ü©∏', desc: 'Organized blood drive' },
                    { name: 'Clothes Collector', emoji: 'üëï', desc: 'Collected 200+ clothing items' },
                    { name: 'Toy Drive Leader', emoji: 'üß∏', desc: 'Led Christmas toy drive' },
                    { name: 'Reading Buddy', emoji: 'üìö', desc: 'Read to children 15+ times' },
                    { name: 'Special Olympics Helper', emoji: 'üèÖ', desc: 'Volunteered at Special Olympics' },
                    { name: 'Recycling Champion', emoji: '‚ôªÔ∏è', desc: 'Set up school recycling program' },
                    { name: 'Kindness Ambassador', emoji: 'üíù', desc: '30 days of documented kindness' },
                    { name: 'Community Cook', emoji: 'üë®‚Äçüç≥', desc: 'Cooked meals for families in need' },
                    { name: 'Bike Mechanic', emoji: 'üö≤', desc: 'Fixed bikes for underprivileged kids' },
                    { name: 'Park Restorer', emoji: 'üå≥', desc: 'Helped restore local park' },
                    { name: 'Service Legend', emoji: 'üåü', desc: '100+ total service hours', legendary: true }
                ],
                scholar: [
                    { name: 'Science Fair Victor', emoji: 'üî¨', desc: 'Won science fair competition' },
                    { name: 'Essay Excellence', emoji: '‚úçÔ∏è', desc: 'Published or award-winning essay' },
                    { name: 'Math Olympiad', emoji: 'üî¢', desc: 'Placed in math competition' },
                    { name: 'Spelling Bee Champ', emoji: 'üêù', desc: 'Won spelling competition' },
                    { name: 'Debate Master', emoji: 'üé§', desc: 'Won debate tournament' },
                    { name: 'Research Star', emoji: 'üîç', desc: 'Completed original research project' },
                    { name: 'History Quest', emoji: 'üèõÔ∏è', desc: 'Won history competition' },
                    { name: 'Language Master', emoji: 'üó£Ô∏è', desc: 'Achieved fluency certification' },
                    { name: 'Innovation Award', emoji: 'üí°', desc: 'Created innovative solution' },
                    { name: 'Geography Guru', emoji: 'üåç', desc: 'Won geography bee' },
                    { name: 'Chemistry Whiz', emoji: '‚öóÔ∏è', desc: 'Excellence in chemistry' },
                    { name: 'Physics Pro', emoji: '‚öõÔ∏è', desc: 'Excellence in physics' },
                    { name: 'Biology Brain', emoji: 'üß¨', desc: 'Excellence in biology' },
                    { name: 'Coding Ninja', emoji: 'üë®‚Äçüíª', desc: 'Won coding competition' },
                    { name: 'Robotics Builder', emoji: 'ü§ñ', desc: 'Built competition robot' },
                    { name: 'Economics Expert', emoji: 'üìà', desc: 'Won economics challenge' },
                    { name: 'Philosophy Thinker', emoji: 'ü§î', desc: 'Excellence in critical thinking' },
                    { name: 'Quiz Bowl Victor', emoji: 'üß†', desc: 'Won quiz bowl competition' },
                    { name: 'Book Worm', emoji: 'üìï', desc: 'Read 50+ books in a year' },
                    { name: 'Scholarship Winner', emoji: 'üéì', desc: 'Won academic scholarship' },
                    { name: 'Perfect Score', emoji: 'üíØ', desc: 'Achieved perfect test score' },
                    { name: 'Study Group Leader', emoji: 'üë•', desc: 'Led successful study group' },
                    { name: 'Academic Mentor', emoji: 'üßë‚Äçüè´', desc: 'Mentored struggling students' },
                    { name: 'Library Champion', emoji: 'üìñ', desc: 'Most library books borrowed' },
                    { name: 'STEM Ambassador', emoji: 'üöÄ', desc: 'Promoted STEM in community' },
                    { name: 'Writing Workshop', emoji: 'üìù', desc: 'Led creative writing workshop' },
                    { name: 'Model UN', emoji: 'üåê', desc: 'Excelled at Model UN' },
                    { name: 'Academic Decathlon', emoji: 'üèÜ', desc: 'Competed in academic decathlon' },
                    { name: 'Thesis Excellence', emoji: 'üìú', desc: 'Outstanding research thesis' },
                    { name: 'Scholar Supreme', emoji: 'üëë', desc: 'Top academic achiever of year', legendary: true }
                ],
                performer: [
                    { name: 'Drama Star', emoji: 'üé≠', desc: 'Lead role in school production' },
                    { name: 'Choir Excellence', emoji: 'üéµ', desc: 'Solo performance at concert' },
                    { name: 'Band Performer', emoji: 'üé∫', desc: 'Performed with school band' },
                    { name: 'Dance Champion', emoji: 'üíÉ', desc: 'Won dance competition' },
                    { name: 'Art Exhibition', emoji: 'üñºÔ∏è', desc: 'Featured in art exhibition' },
                    { name: 'Film Festival', emoji: 'üé¨', desc: 'Film shown at festival' },
                    { name: 'Poetry Slam', emoji: 'üìú', desc: 'Won poetry competition' },
                    { name: 'Musical Theatre', emoji: 'üéπ', desc: 'Performed in musical' },
                    { name: 'Orchestra Solo', emoji: 'üéª', desc: 'Performed orchestra solo' },
                    { name: 'Creative Writer', emoji: '‚úíÔ∏è', desc: 'Published creative work' },
                    { name: 'Photography Pro', emoji: 'üì∑', desc: 'Won photography competition' },
                    { name: 'Kapa Haka Star', emoji: 'üá≥üáø', desc: 'Excellence in Kapa Haka' },
                    { name: 'Hip Hop Hero', emoji: 'üï∫', desc: 'Won hip hop competition' },
                    { name: 'Ballet Beauty', emoji: 'ü©∞', desc: 'Excellence in ballet' },
                    { name: 'Guitar Legend', emoji: 'üé∏', desc: 'Outstanding guitar performance' },
                    { name: 'Piano Virtuoso', emoji: 'üéπ', desc: 'Excellence in piano' },
                    { name: 'Drum Major', emoji: 'ü•Å', desc: 'Led marching band' },
                    { name: 'Voice of Gold', emoji: 'üéôÔ∏è', desc: 'Outstanding vocal performance' },
                    { name: 'Improv Master', emoji: 'üòÑ', desc: 'Won improv competition' },
                    { name: 'Sculpture Artist', emoji: 'üóø', desc: 'Created public sculpture' },
                    { name: 'Mural Painter', emoji: 'üé®', desc: 'Painted school mural' },
                    { name: 'Costume Designer', emoji: 'üßµ', desc: 'Designed production costumes' },
                    { name: 'Stage Manager', emoji: 'üé™', desc: 'Managed school production' },
                    { name: 'Lighting Tech', emoji: 'üí°', desc: 'Technical excellence' },
                    { name: 'Sound Engineer', emoji: 'üîä', desc: 'Sound design excellence' },
                    { name: 'Lip Sync Legend', emoji: 'üëÑ', desc: 'Won lip sync competition' },
                    { name: 'House Singing Star', emoji: 'üé§', desc: 'Led house singing to victory' },
                    { name: 'Cultural Festival', emoji: 'üéä', desc: 'Organized cultural performance' },
                    { name: 'Talent Show', emoji: '‚≠ê', desc: 'Won school talent show' },
                    { name: 'Performer Supreme', emoji: 'üåü', desc: 'Outstanding performer of year', legendary: true }
                ],
                champion: [
                    { name: 'Athletics Day Hero', emoji: 'üèÉ', desc: 'Won athletics day event' },
                    { name: 'Swimming Champion', emoji: 'üèä', desc: 'Won swimming competition' },
                    { name: 'Rugby Excellence', emoji: 'üèâ', desc: 'Outstanding rugby performance' },
                    { name: 'Netball Star', emoji: 'üèÄ', desc: 'Excellence in netball' },
                    { name: 'Cricket Master', emoji: 'üèè', desc: 'Outstanding cricket performance' },
                    { name: 'Hockey Hero', emoji: 'üèë', desc: 'Excellence in hockey' },
                    { name: 'Tennis Ace', emoji: 'üéæ', desc: 'Won tennis competition' },
                    { name: 'Basketball MVP', emoji: '‚õπÔ∏è', desc: 'Most valuable player' },
                    { name: 'Football Glory', emoji: '‚öΩ', desc: 'Football championship' },
                    { name: 'Cross Country King', emoji: 'üèîÔ∏è', desc: 'Won cross country race' },
                    { name: 'Volleyball Victor', emoji: 'üèê', desc: 'Won volleyball tournament' },
                    { name: 'Badminton Boss', emoji: 'üè∏', desc: 'Won badminton competition' },
                    { name: 'Table Tennis Titan', emoji: 'üèì', desc: 'Won table tennis tournament' },
                    { name: 'Golf Great', emoji: '‚õ≥', desc: 'Excellence in golf' },
                    { name: 'Martial Artist', emoji: 'ü•ã', desc: 'Achieved martial arts rank' },
                    { name: 'Gymnastics Grace', emoji: 'ü§∏', desc: 'Excellence in gymnastics' },
                    { name: 'Rowing Champion', emoji: 'üö£', desc: 'Won rowing competition' },
                    { name: 'Cycling Star', emoji: 'üö¥', desc: 'Won cycling race' },
                    { name: 'Triathlon Finisher', emoji: 'üèä‚Äç‚ôÇÔ∏è', desc: 'Completed triathlon' },
                    { name: 'Touch Rugby Titan', emoji: 'üèà', desc: 'Won touch rugby' },
                    { name: 'Skiing Superstar', emoji: '‚õ∑Ô∏è', desc: 'Won skiing competition' },
                    { name: 'Surfing Champion', emoji: 'üèÑ', desc: 'Won surfing competition' },
                    { name: 'Skateboard Pro', emoji: 'üõπ', desc: 'Won skateboard competition' },
                    { name: 'Ultimate Frisbee', emoji: 'ü•è', desc: 'Won ultimate frisbee' },
                    { name: 'Archery Ace', emoji: 'üèπ', desc: 'Excellence in archery' },
                    { name: 'Rock Climbing', emoji: 'üßó', desc: 'Completed climbing challenge' },
                    { name: 'Sports Captain', emoji: '¬©Ô∏è', desc: 'Elected sports captain' },
                    { name: 'Fair Play Award', emoji: 'ü§ù', desc: 'Outstanding sportsmanship' },
                    { name: 'Most Improved', emoji: 'üìà', desc: 'Most improved athlete' },
                    { name: 'Champion Supreme', emoji: 'üèÜ', desc: 'Athlete of the year', legendary: true }
                ],
                disciple: [
                    { name: 'Chapel Leader', emoji: '‚õ™', desc: 'Led chapel service' },
                    { name: 'Bible Study Host', emoji: 'üìñ', desc: 'Hosted bible study group' },
                    { name: 'Prayer Warrior', emoji: 'üôè', desc: 'Led prayer initiatives' },
                    { name: 'Worship Team', emoji: 'üé∂', desc: 'Served on worship team' },
                    { name: 'Mission Minded', emoji: 'üåè', desc: 'Active in missions' },
                    { name: 'Kindness Champion', emoji: 'üíï', desc: 'Documented acts of kindness' },
                    { name: 'Integrity Award', emoji: '‚öñÔ∏è', desc: 'Demonstrated integrity' },
                    { name: 'Faith in Action', emoji: 'üí™', desc: 'Faith demonstrated through service' },
                    { name: 'Servant Heart', emoji: '‚ù§Ô∏è', desc: 'Consistent selfless service' },
                    { name: 'Grace Ambassador', emoji: 'üïäÔ∏è', desc: 'Showed grace to others' },
                    { name: 'Encourager', emoji: 'üí¨', desc: 'Known for encouragement' },
                    { name: 'Peacemaker', emoji: '‚òÆÔ∏è', desc: 'Resolved conflicts peacefully' },
                    { name: 'Hospitality Hero', emoji: 'üè°', desc: 'Welcomed newcomers' },
                    { name: 'Generous Giver', emoji: 'üéÅ', desc: 'Known for generosity' },
                    { name: 'Faithful Friend', emoji: 'üë´', desc: 'Loyal friendship demonstrated' },
                    { name: 'Humility Award', emoji: 'üôá', desc: 'Demonstrated humility' },
                    { name: 'Patience Prize', emoji: '‚è≥', desc: 'Showed exceptional patience' },
                    { name: 'Forgiveness Star', emoji: 'üíù', desc: 'Demonstrated forgiveness' },
                    { name: 'Joy Spreader', emoji: 'üòä', desc: 'Spread joy to others' },
                    { name: 'Thankful Heart', emoji: 'üôå', desc: 'Attitude of gratitude' },
                    { name: 'Truth Teller', emoji: '‚ú®', desc: 'Known for honesty' },
                    { name: 'Compassion Award', emoji: 'ü§ó', desc: 'Showed deep compassion' },
                    { name: 'Respect Champion', emoji: 'üéñÔ∏è', desc: 'Respected all people' },
                    { name: 'Self-Control Star', emoji: 'üßò', desc: 'Demonstrated self-control' },
                    { name: 'Perseverance Prize', emoji: 'üèîÔ∏è', desc: 'Never gave up' },
                    { name: 'Wisdom Seeker', emoji: 'ü¶â', desc: 'Sought godly wisdom' },
                    { name: 'Love in Action', emoji: 'üíó', desc: 'Love demonstrated practically' },
                    { name: 'Hope Giver', emoji: 'üåÖ', desc: 'Gave hope to others' },
                    { name: 'Light Bearer', emoji: 'üïØÔ∏è', desc: 'Was a light to others' },
                    { name: 'Disciple Supreme', emoji: '‚úùÔ∏è', desc: 'Outstanding faith & character', legendary: true }
                ]
            };

            const badges = [];
            let id = 1;

            Object.entries(badgeDefinitions).forEach(([category, categoryBadges]) => {
                categoryBadges.forEach(badge => {
                    badges.push({
                        id: id++,
                        name: badge.name,
                        category: category,
                        emoji: badge.emoji,
                        description: badge.desc,
                        legendary: badge.legendary || false,
                        earnedBy: generateRandomEarned(badge.legendary)
                    });
                });
            });

            return badges;
        }

        function generateRandomEarned(isLegendary) {
            const houses = ['shackleton', 'wilson', 'bowen', 'scott'];
            const earned = {};
            // Legendary badges are rarely earned
            const maxEarned = isLegendary ? 1 : 4;
            const numEarned = isLegendary ? (Math.random() > 0.7 ? 1 : 0) : Math.floor(Math.random() * (maxEarned + 1));
            const shuffled = [...houses].sort(() => Math.random() - 0.5);
            
            for (let i = 0; i < numEarned; i++) {
                earned[shuffled[i]] = i + 1;
            }
            return earned;
        }

        // =====================
        // THEME TOGGLE
        // =====================
        const themeToggle = document.getElementById('themeToggle');
        
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('mgs-theme', theme);
            themeToggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            themeToggle.title = theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode';
        }

        // Check for saved theme or default to light
        const savedTheme = localStorage.getItem('mgs-theme') || 'light';
        setTheme(savedTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            setTheme(currentTheme === 'dark' ? 'light' : 'dark');
        });

        // =====================
        // NAVIGATION
        // =====================
        const navTabs = document.querySelectorAll('.nav-tab');
        const pages = document.querySelectorAll('.page');

        navTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetPage = tab.dataset.page;
                
                navTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                pages.forEach(p => p.classList.remove('active'));
                document.getElementById(`page-${targetPage}`).classList.add('active');
                
                // Hide admin panel when switching pages
                if (!appData.isAdmin || targetPage !== 'admin') {
                    document.getElementById('adminPanel').classList.remove('active');
                }
            });
        });

        // Helper function to show a specific page
        function showPage(pageName) {
            const navTabs = document.querySelectorAll('.nav-tab');
            const pages = document.querySelectorAll('.page');
            
            navTabs.forEach(t => t.classList.remove('active'));
            const targetTab = document.querySelector(`.nav-tab[data-page="${pageName}"]`);
            if (targetTab) targetTab.classList.add('active');
            
            pages.forEach(p => p.classList.remove('active'));
            const targetPage = document.getElementById(`page-${pageName}`);
            if (targetPage) targetPage.classList.add('active');
        }

        // =====================
        // LOGO CLICK (Secret Admin Access)
        // =====================
        const logoCrest = document.getElementById('logoCrest');
        let clickTimeout;

        logoCrest.addEventListener('click', () => {
            appData.logoClickCount++;
            logoCrest.classList.add('clicked');
            setTimeout(() => logoCrest.classList.remove('clicked'), 300);

            clearTimeout(clickTimeout);
            clickTimeout = setTimeout(() => {
                appData.logoClickCount = 0;
            }, 2000);

            if (appData.logoClickCount >= 5) {
                appData.logoClickCount = 0;
                if (!appData.isAdmin) {
                    openLoginModal();
                } else {
                    toggleAdminPanel();
                }
            }
        });

        // =====================
        // LOGIN MODAL
        // =====================
        function openLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('adminPassword').value = '';
        }

        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const password = document.getElementById('adminPassword').value;
            
            // Demo password - in production this would be Firebase Auth
            if (password === 'mgs2025admin') {
                appData.isAdmin = true;
                closeLoginModal();
                toggleAdminPanel();
                showToast('Welcome, Admin!', 'success');
            } else {
                showToast('Incorrect password', 'error');
            }
        });

        document.getElementById('adminLogout').addEventListener('click', () => {
            appData.isAdmin = false;
            document.getElementById('adminPanel').classList.remove('active');
            showToast('Logged out', 'info');
        });

        function toggleAdminPanel() {
            const adminPanel = document.getElementById('adminPanel');
            pages.forEach(p => p.classList.remove('active'));
            adminPanel.classList.add('active');
        }

        // =====================
        // ADMIN TABS
        // =====================
        const adminTabs = document.querySelectorAll('.admin-tab');
        const adminSections = document.querySelectorAll('.admin-section');

        adminTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetSection = tab.dataset.section;
                
                adminTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                adminSections.forEach(s => s.classList.remove('active'));
                document.getElementById(`admin-${targetSection}`).classList.add('active');
            });
        });

        // =====================
        // RENDER FUNCTIONS
        // =====================
        function renderHouseOfTheWeek() {
            const container = document.getElementById('houseOfTheWeek');
            
            // Calculate house of the week based on weekly activity
            const housesArray = Object.entries(appData.houses)
                .map(([key, value]) => ({ ...value, key }))
                .sort((a, b) => b.weeklyActivity.points - a.weeklyActivity.points);
            
            const winner = housesArray[0];
            const reason = getHOTWReason(winner);

            container.innerHTML = `
                <div class="hotw-header">
                    <span class="hotw-label">üåü House of the Week</span>
                </div>
                <div class="hotw-content">
                    <div class="hotw-house-icon ${winner.key}">${winner.icon}</div>
                    <div class="hotw-info">
                        <h3>${winner.name}${winner.streak >= 2 ? `<span class="streak-badge">üî• ${winner.streak} streak <span class="streak-multiplier">+${getStreakBonus(winner.streak)}%</span></span>` : ''}</h3>
                        <p>${reason}</p>
                    </div>
                    <div class="hotw-stats">
                        <div class="hotw-stat">
                            <div class="hotw-stat-value">+${winner.weeklyActivity.points}</div>
                            <div class="hotw-stat-label">Points This Week</div>
                        </div>
                        <div class="hotw-stat">
                            <div class="hotw-stat-value">${winner.weeklyActivity.badges}</div>
                            <div class="hotw-stat-label">Badges Earned</div>
                        </div>
                        <div class="hotw-stat">
                            <div class="hotw-stat-value">${winner.weeklyActivity.events}</div>
                            <div class="hotw-stat-label">Events Won</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getHOTWReason(house) {
            const reasons = [
                `Dominated this week with ${house.weeklyActivity.badges} badge${house.weeklyActivity.badges !== 1 ? 's' : ''} earned!`,
                `Outstanding performance across all categories this week.`,
                `Leading the charge with exceptional teamwork and spirit.`,
                `Setting the pace with ${house.weeklyActivity.points} points gained this week.`
            ];
            return reasons[Math.floor(Math.random() * reasons.length)];
        }

        function getStreakBonus(streak) {
            // Streak bonus: 2=5%, 3=10%, 4=15%, 5+=20%
            if (streak < 2) return 0;
            if (streak === 2) return 5;
            if (streak === 3) return 10;
            if (streak === 4) return 15;
            return 20;
        }

        function renderFeed(filter = 'all') {
            const container = document.getElementById('feedMain');
            let feedItems = [...appData.feed].sort((a, b) => b.timestamp - a.timestamp);
            
            if (filter !== 'all') {
                feedItems = feedItems.filter(item => item.type === filter);
            }

            if (feedItems.length === 0) {
                container.innerHTML = `<p style="color: var(--text-muted); text-align: center; padding: 2rem;">No ${filter} updates yet.</p>`;
                return;
            }

            container.innerHTML = feedItems.map(item => {
                const house = appData.houses[item.house];
                return `
                    <div class="feed-item">
                        <div class="feed-item-header">
                            <div class="feed-house-icon ${item.house}">${house.icon}</div>
                            <div class="feed-item-meta">
                                <div class="feed-item-house">${house.name}</div>
                                <div class="feed-item-time">${formatTimeAgo(item.timestamp)}</div>
                            </div>
                            <span class="feed-item-type ${item.type}">${getFeedTypeLabel(item.type)}</span>
                        </div>
                        <div class="feed-item-content">
                            ${item.content}
                        </div>
                        ${item.points > 0 ? `<div class="feed-item-points">+${item.points} points</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function getFeedTypeLabel(type) {
            const labels = {
                badge: 'üéñÔ∏è Badge',
                event: 'üèÜ Event',
                spirit: 'üëè Spirit',
                shoutout: '‚≠ê Shoutout'
            };
            return labels[type] || type;
        }

        function formatTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)} minutes ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours ago`;
            if (seconds < 604800) return `${Math.floor(seconds / 86400)} days ago`;
            return date.toLocaleDateString('en-NZ', { day: 'numeric', month: 'short' });
        }

        function renderSpiritPoints() {
            const container = document.getElementById('spiritPointsList');
            const housesArray = Object.entries(appData.houses)
                .map(([key, value]) => ({ ...value, key }))
                .sort((a, b) => b.spiritPoints - a.spiritPoints);
            
            const maxSpirit = Math.max(...housesArray.map(h => h.spiritPoints));

            container.innerHTML = housesArray.map(house => `
                <div class="spirit-house-row">
                    <div class="spirit-house-dot ${house.key}"></div>
                    <span class="spirit-house-name">${house.name}</span>
                    <span class="spirit-house-value">${house.spiritPoints}</span>
                </div>
                <div class="spirit-progress">
                    <div class="spirit-progress-bar">
                        <div class="spirit-progress-fill ${house.key}" style="width: ${(house.spiritPoints / maxSpirit) * 100}%"></div>
                    </div>
                </div>
            `).join('');
        }

        function renderTopParticipants() {
            const container = document.getElementById('topParticipants');
            
            container.innerHTML = appData.topParticipants.map((participant, index) => {
                const rankClass = index === 0 ? 'gold' : (index === 1 ? 'silver' : (index === 2 ? 'bronze' : ''));
                return `
                    <div class="participant-row">
                        <div class="participant-rank ${rankClass}">${index + 1}</div>
                        <span class="participant-name">${participant.name}</span>
                        <div class="spirit-house-dot ${participant.house}"></div>
                        <span class="participant-events">${participant.events} events</span>
                    </div>
                `;
            }).join('');
        }

        function renderStandings() {
            const grid = document.getElementById('standingsGrid');
            const housesArray = Object.entries(appData.houses)
                .map(([key, value]) => ({ ...value, key }))
                .sort((a, b) => b.points - a.points);

            grid.innerHTML = housesArray.map((house, index) => `
                <div class="house-card ${house.key}">
                    <div class="house-rank ${index === 0 ? 'first' : ''}">${index + 1}</div>
                    <div class="house-icon">${house.icon}</div>
                    <div class="house-name">
                        ${house.name}
                        ${house.streak >= 2 ? `<span class="streak-badge">üî• ${house.streak}</span>` : ''}
                    </div>
                    <div class="house-explorer">${house.explorer}</div>
                    <div class="house-points">${house.points.toLocaleString()}</div>
                    <div class="house-points-label">Total Points</div>
                    <div class="house-badges">
                        <span class="badge-count"><span class="icon">üéñÔ∏è</span> ${house.badgesEarned}</span>
                        <span class="badge-count"><span class="icon">üèÜ</span> ${house.eventsWon}</span>
                        <span class="badge-count"><span class="icon">üëè</span> ${house.spiritPoints}</span>
                    </div>
                </div>
            `).join('');
        }

        function renderEvents(containerId, filter = 'upcoming', limit = null) {
            const container = document.getElementById(containerId);
            let events = appData.events.filter(e => e.status === filter);
            
            if (limit) events = events.slice(0, limit);

            if (events.length === 0) {
                container.innerHTML = `<p style="color: var(--text-muted); text-align: center; padding: 2rem;">No ${filter} events at this time.</p>`;
                return;
            }

            container.innerHTML = events.map(event => `
                <div class="event-card">
                    <span class="event-status ${event.status}">${event.status}</span>
                    <h4 class="event-title">${event.name}</h4>
                    <div class="event-date">
                        üìÖ ${formatDate(event.date)} at ${formatTime(event.time)}
                    </div>
                    <p class="event-description">${event.description}</p>
                    <div class="event-points">
                        üèÜ Points available: <strong>${event.points}</strong> (1st place)
                    </div>
                    ${event.results ? renderResults(event.results, event.points) : ''}
                </div>
            `).join('');
        }

        function renderResults(results, basePoints) {
            const pointsMap = { '1st': 1, '2nd': 0.5, '3rd': 0.2, '4th': 0.1 };
            return `
                <div class="event-results">
                    ${Object.entries(results).map(([place, house]) => `
                        <div class="result-row">
                            <div class="result-house">
                                <span class="result-house-dot ${house}"></span>
                                <span>${place}: ${appData.houses[house].name}</span>
                            </div>
                            <span class="result-points">+${Math.round(basePoints * pointsMap[place])} pts</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderBadges(filter = 'all') {
            const container = document.getElementById('badgesGrid');
            let badges = appData.badges;
            
            if (filter === 'legendary') {
                badges = badges.filter(b => b.legendary);
            } else if (filter !== 'all') {
                badges = badges.filter(b => b.category === filter);
            }

            container.innerHTML = badges.map(badge => {
                const hasAnyEarned = Object.keys(badge.earnedBy).length > 0;
                return `
                    <div class="badge-card ${hasAnyEarned ? 'earned' : ''} ${badge.legendary ? 'legendary' : ''}" data-category="${badge.category}">
                        <div class="badge-icon-wrapper">
                            ${badge.emoji}
                        </div>
                        <div class="badge-name">${badge.name}</div>
                        <div class="badge-category">${badge.category}</div>
                        ${badge.description ? `<div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.25rem;">${badge.description}</div>` : ''}
                        ${badge.legendary ? '<span class="legendary-tag">LEGENDARY</span>' : ''}
                        <div class="badge-earned-by">
                            <div class="badge-earned-houses">
                                ${['shackleton', 'wilson', 'bowen', 'scott'].map(house => `
                                    <div class="earned-dot ${house} ${badge.earnedBy[house] ? 'earned' : ''}" title="${badge.earnedBy[house] ? `${appData.houses[house].name}: ${getPlaceText(badge.earnedBy[house])}` : 'Not earned'}"></div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getPlaceText(place) {
            const places = { 1: '1st', 2: '2nd', 3: '3rd', 4: '4th' };
            return places[place] || `${place}th`;
        }

        function renderBadgeHunts() {
            const container = document.getElementById('badgeHuntsContainer');
            if (!container) return;

            const now = new Date();
            const hunts = appData.badgeHunts.sort((a, b) => {
                if (a.active && !b.active) return -1;
                if (!a.active && b.active) return 1;
                return a.startDate - b.startDate;
            });

            container.innerHTML = hunts.map(hunt => {
                const isActive = hunt.active && now >= hunt.startDate && now <= hunt.endDate;
                const isUpcoming = now < hunt.startDate;
                const daysLeft = Math.ceil((hunt.endDate - now) / (1000 * 60 * 60 * 24));

                return `
                    <div class="badge-hunt-card ${isUpcoming ? 'upcoming' : ''}">
                        <div class="badge-hunt-header">
                            <div class="badge-hunt-title">${hunt.name}</div>
                            <span class="badge-hunt-status ${isActive ? 'active' : 'upcoming'}">
                                ${isActive ? `üî• ${daysLeft} days left` : `Starts ${formatDate(hunt.startDate)}`}
                            </span>
                        </div>
                        <p class="badge-hunt-description">${hunt.description}</p>
                        <div class="badge-hunt-reward">üéÅ Reward: +${hunt.bonusPoints} bonus points</div>
                        <div class="badge-hunt-progress">
                            ${['shackleton', 'wilson', 'bowen', 'scott'].map(house => `
                                <div class="hunt-progress-item">
                                    <div class="hunt-progress-house">${appData.houses[house].icon} ${appData.houses[house].name}</div>
                                    <div class="hunt-progress-bar">
                                        <div class="hunt-progress-fill ${house}" style="width: ${(hunt.progress[house] / hunt.targetBadges) * 100}%"></div>
                                    </div>
                                    <div class="hunt-progress-count">${hunt.progress[house]}/${hunt.targetBadges}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderTierProgress() {
            const container = document.getElementById('tierProgressContainer');
            if (!container) return;

            const housesArray = Object.entries(appData.houses)
                .map(([key, value]) => ({ ...value, key }))
                .sort((a, b) => b.badgesEarned - a.badgesEarned);

            container.innerHTML = housesArray.map(house => {
                const tier = getCurrentTier(house.badgesEarned);
                const nextTier = getNextTier(house.badgesEarned);
                const progressInTier = nextTier ? 
                    ((house.badgesEarned - tier.min) / (nextTier.min - tier.min)) * 100 : 100;
                const badgesToNext = nextTier ? nextTier.min - house.badgesEarned : 0;

                return `
                    <div class="tier-progress-card" style="margin-bottom: 1rem;">
                        <div class="tier-header">
                            <h4>${house.icon} ${house.name}</h4>
                            <span class="current-tier-badge tier-${tier.name.toLowerCase()}">${tier.emoji} ${tier.name}</span>
                        </div>
                        <div class="tier-progress-row">
                            <div class="tier-progress-bar-container">
                                <div class="tier-progress-labels">
                                    <span>${house.badgesEarned} badges earned</span>
                                    <span>${nextTier ? `${nextTier.min} for ${nextTier.name}` : 'MAX TIER!'}</span>
                                </div>
                                <div class="tier-progress-bar">
                                    <div class="tier-progress-fill" style="width: ${progressInTier}%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="tier-milestones">
                            ${Object.values(appData.badgeTiers).map(t => `
                                <div class="tier-milestone">
                                    <div class="tier-milestone-icon ${house.badgesEarned >= t.min ? 'achieved' : ''}">${t.emoji}</div>
                                    <div>${t.min}</div>
                                </div>
                            `).join('')}
                        </div>
                        ${nextTier ? `
                            <div class="tier-next-info" style="margin-top: 1rem;">
                                ‚¨ÜÔ∏è <strong>${badgesToNext} more badge${badgesToNext !== 1 ? 's' : ''}</strong> to reach ${nextTier.emoji} ${nextTier.name} tier!
                            </div>
                        ` : `
                            <div class="tier-next-info" style="margin-top: 1rem;">
                                üëë <strong>LEGENDARY STATUS ACHIEVED!</strong> Maximum tier reached!
                            </div>
                        `}
                    </div>
                `;
            }).join('');
        }

        function getCurrentTier(badges) {
            const tiers = Object.values(appData.badgeTiers).sort((a, b) => b.min - a.min);
            return tiers.find(t => badges >= t.min) || tiers[tiers.length - 1];
        }

        function getNextTier(badges) {
            const tiers = Object.values(appData.badgeTiers).sort((a, b) => a.min - b.min);
            return tiers.find(t => t.min > badges);
        }

        function renderHouseProfiles() {
            const container = document.getElementById('houseProfilesGrid');
            if (!container) return;

            const housesArray = Object.entries(appData.houses)
                .map(([key, value]) => ({ ...value, key }));

            container.innerHTML = housesArray.map(house => {
                // Get badges earned by this house
                const earnedBadges = appData.badges.filter(b => b.earnedBy[house.key]);
                const firstPlaceBadges = earnedBadges.filter(b => b.earnedBy[house.key] === 1);
                const legendaryBadges = earnedBadges.filter(b => b.legendary);

                // Get recent event results
                const recentResults = appData.events
                    .filter(e => e.results)
                    .map(e => ({
                        name: e.name,
                        place: Object.entries(e.results).find(([_, h]) => h === house.key)?.[0]
                    }))
                    .filter(r => r.place)
                    .slice(0, 3);

                const displayBadges = earnedBadges.slice(0, 12);
                const tier = getCurrentTier(house.badgesEarned);

                return `
                    <div class="house-profile-card">
                        <div class="house-profile-header ${house.key}">
                            <div class="house-profile-icon">${house.icon}</div>
                            <div class="house-profile-name">${house.name}</div>
                            <div class="house-profile-stats">
                                <div class="house-profile-stat">
                                    <div class="house-profile-stat-value">${house.points.toLocaleString()}</div>
                                    <div class="house-profile-stat-label">Points</div>
                                </div>
                                <div class="house-profile-stat">
                                    <div class="house-profile-stat-value">${house.badgesEarned}</div>
                                    <div class="house-profile-stat-label">Badges</div>
                                </div>
                                <div class="house-profile-stat">
                                    <div class="house-profile-stat-value">${tier.emoji}</div>
                                    <div class="house-profile-stat-label">${tier.name}</div>
                                </div>
                            </div>
                        </div>
                        <div class="house-profile-body">
                            <div class="trophy-cabinet">
                                <h5>üèÜ Trophy Cabinet (${earnedBadges.length} badges)</h5>
                                <div class="trophy-badges">
                                    ${displayBadges.map(badge => `
                                        <div class="trophy-badge ${badge.legendary ? 'legendary' : ''} ${badge.earnedBy[house.key] === 1 ? 'first' : ''}">
                                            ${badge.emoji}
                                            <div class="trophy-badge-tooltip">${badge.name} (${getPlaceText(badge.earnedBy[house.key])})</div>
                                        </div>
                                    `).join('')}
                                    ${earnedBadges.length > 12 ? `<span class="trophy-show-more">+${earnedBadges.length - 12} more</span>` : ''}
                                </div>
                                ${legendaryBadges.length > 0 ? `
                                    <div style="margin-top: 0.75rem; font-size: 0.8rem; color: var(--accent-aurora);">
                                        üëë ${legendaryBadges.length} Legendary badge${legendaryBadges.length > 1 ? 's' : ''} earned!
                                    </div>
                                ` : ''}
                            </div>
                            <div class="recent-wins">
                                <h5>üèÖ Recent Event Results</h5>
                                ${recentResults.length > 0 ? recentResults.map(r => `
                                    <div class="recent-win-item">
                                        <span class="recent-win-place ${r.place === '1st' ? 'first' : ''}">${r.place}</span>
                                        <span>${r.name}</span>
                                    </div>
                                `).join('') : '<p style="font-size: 0.85rem; color: var(--text-muted);">No recent results</p>'}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Heritage Page Functions
        function toggleExplorer(button) {
            const card = button.closest('.explorer-card');
            const isExpanded = card.classList.contains('expanded');
            
            // Close all others first
            document.querySelectorAll('.explorer-card').forEach(c => {
                c.classList.remove('expanded');
                c.querySelector('.explorer-toggle').textContent = 'Read More ‚ñº';
            });

            if (!isExpanded) {
                card.classList.add('expanded');
                button.textContent = 'Show Less ‚ñ≤';
            }
        }

        function renderRecords() {
            const container = document.getElementById('recordsGrid');
            if (!container) return;

            container.innerHTML = appData.records.map(record => `
                <div class="record-card">
                    <div class="record-icon">${record.icon}</div>
                    <div class="record-title">${record.title}</div>
                    <div class="record-value">${record.value}</div>
                    <div class="record-holder">
                        ${appData.houses[record.houseKey].icon} ${record.holder}
                    </div>
                    <div class="record-year">${record.year}</div>
                </div>
            `).join('');
        }

        function renderAnniversaries() {
            const container = document.getElementById('anniversariesGrid');
            if (!container) return;

            const now = new Date();
            const thisYear = now.getFullYear();
            
            // Sort by proximity to today
            const sorted = [...appData.anniversaries].sort((a, b) => {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                
                // Adjust to current year for comparison
                dateA.setFullYear(thisYear);
                dateB.setFullYear(thisYear);
                
                // If date has passed, move to next year
                if (dateA < now) dateA.setFullYear(thisYear + 1);
                if (dateB < now) dateB.setFullYear(thisYear + 1);
                
                return dateA - dateB;
            });

            container.innerHTML = sorted.map(ann => {
                const date = new Date(ann.date);
                const adjustedDate = new Date(date);
                adjustedDate.setFullYear(thisYear);
                if (adjustedDate < now) adjustedDate.setFullYear(thisYear + 1);
                
                const daysUntil = Math.ceil((adjustedDate - now) / (1000 * 60 * 60 * 24));
                const isUpcoming = daysUntil <= 30 && daysUntil > 0;
                
                const day = date.getDate();
                const month = date.toLocaleString('en-US', { month: 'short' }).toUpperCase();
                
                // Calculate years for upcoming anniversary
                const yearsNow = thisYear - (parseInt(ann.date.split('-')[0]) - ann.years + (ann.years || 0));
                
                return `
                    <div class="anniversary-card ${isUpcoming ? 'upcoming' : ''}">
                        <div class="anniversary-date-box">
                            <div class="anniversary-day">${day}</div>
                            <div class="anniversary-month">${month}</div>
                        </div>
                        <div class="anniversary-content">
                            <h5>${ann.title}</h5>
                            <p>${ann.description}</p>
                            ${ann.years ? `<span class="anniversary-years">${ann.years} years</span>` : ''}
                            ${isUpcoming ? `<span class="anniversary-years" style="background: var(--accent-ice); margin-left: 0.5rem;">In ${daysUntil} day${daysUntil !== 1 ? 's' : ''}!</span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderHeritageSpotlight() {
            const container = document.getElementById('heritageSpotlight');
            if (!container) return;

            // Rotating explorer facts
            const explorerFacts = [
                { house: 'shackleton', icon: 'üßä', name: 'Shackleton', quote: '"Difficulties are just things to overcome."', fact: 'Saved all 28 of his crew' },
                { house: 'scott', icon: 'üß≠', name: 'Scott', quote: '"We took risks, we knew we took them."', fact: 'Reached the South Pole in 1912' },
                { house: 'wilson', icon: 'üé®', name: 'Wilson', quote: '"The finest character I ever met." ‚Äî Scott', fact: 'Artist, doctor & naturalist' },
                { house: 'bowen', icon: '‚õ∞Ô∏è', name: 'Bowen', quote: '"Education for all children."', fact: 'Established free NZ education' }
            ];

            // Pick based on day
            const todayIndex = new Date().getDate() % explorerFacts.length;
            const explorer = explorerFacts[todayIndex];

            // Find next upcoming anniversary
            const now = new Date();
            const thisYear = now.getFullYear();
            
            let nextAnniversary = null;
            let minDays = Infinity;
            
            appData.anniversaries.forEach(ann => {
                const date = new Date(ann.date);
                date.setFullYear(thisYear);
                if (date < now) date.setFullYear(thisYear + 1);
                
                const daysUntil = Math.ceil((date - now) / (1000 * 60 * 60 * 24));
                if (daysUntil > 0 && daysUntil < minDays) {
                    minDays = daysUntil;
                    nextAnniversary = { ...ann, daysUntil };
                }
            });

            container.innerHTML = `
                <div class="spotlight-explorer">
                    <div class="spotlight-explorer-icon">${explorer.icon}</div>
                    <div class="spotlight-explorer-info">
                        <h5>${explorer.name} House</h5>
                        <p>${explorer.fact}</p>
                    </div>
                </div>
                <div class="spotlight-quote">${explorer.quote}</div>
                ${nextAnniversary ? `
                    <div class="upcoming-anniversary">
                        <span class="upcoming-anniversary-icon">üìÖ</span>
                        <span>${nextAnniversary.title.split(' ').slice(1).join(' ')}</span>
                        <span class="upcoming-anniversary-days">${nextAnniversary.daysUntil}d</span>
                    </div>
                ` : ''}
                <div class="spotlight-link" onclick="showPage('heritage')">Explore Our Heritage ‚Üí</div>
            `;
        }

        function renderLeaderboard() {
            const container = document.getElementById('leaderboardTable');
            const housesArray = Object.entries(appData.houses)
                .map(([key, value]) => ({ ...value, key }))
                .sort((a, b) => b.points - a.points);

            const rows = housesArray.map((house, index) => `
                <div class="leaderboard-row">
                    <span class="leaderboard-rank">#${index + 1}</span>
                    <div class="leaderboard-house">
                        <div class="leaderboard-house-icon ${house.key}">${house.icon}</div>
                        <span class="leaderboard-house-name">
                            ${house.name}
                            ${house.streak >= 2 ? `<span class="streak-badge" style="font-size: 0.65rem;">üî• ${house.streak}</span>` : ''}
                        </span>
                    </div>
                    <span class="leaderboard-points">${house.points.toLocaleString()}</span>
                    <span class="leaderboard-badges">${house.badgesEarned}</span>
                    <span class="leaderboard-events">${house.eventsWon}</span>
                    <span class="leaderboard-spirit">${house.spiritPoints}</span>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="leaderboard-row header">
                    <span>Rank</span>
                    <span>House</span>
                    <span>Points</span>
                    <span>Badges</span>
                    <span>Wins</span>
                    <span>Spirit</span>
                </div>
                ${rows}
            `;
        }

        function renderAdminEventsList() {
            const container = document.getElementById('adminEventsList');
            container.innerHTML = appData.events.map(event => `
                <div class="admin-list-item">
                    <div class="admin-list-item-info">
                        <h5>${event.name}</h5>
                        <span>${formatDate(event.date)} ‚Ä¢ ${event.status}</span>
                    </div>
                    <div class="admin-list-actions">
                        <button class="btn btn-secondary" onclick="editEvent(${event.id})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteEvent(${event.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function populateEventSelect() {
            const select = document.getElementById('resultEventSelect');
            const upcomingEvents = appData.events.filter(e => e.status === 'upcoming');
            select.innerHTML = '<option value="">Choose an event...</option>' +
                upcomingEvents.map(e => `<option value="${e.id}">${e.name}</option>`).join('');
        }

        function populateBadgeSelect() {
            const select = document.getElementById('badgeSelect');
            select.innerHTML = '<option value="">Choose a badge...</option>' +
                appData.badges.map(b => `<option value="${b.id}">${b.emoji} ${b.name} (${b.category})${b.legendary ? ' üëë' : ''}</option>`).join('');
        }

        // =====================
        // ADMIN ACTIONS
        // =====================
        document.getElementById('createEventForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const newEvent = {
                id: Date.now(),
                name: document.getElementById('eventName').value,
                date: document.getElementById('eventDate').value,
                time: document.getElementById('eventTime').value,
                description: document.getElementById('eventDescription').value,
                rules: document.getElementById('eventRules').value,
                points: parseInt(document.getElementById('eventPoints').value),
                status: 'upcoming'
            };

            appData.events.push(newEvent);
            e.target.reset();
            renderAll();
            showToast('Event created successfully!', 'success');
        });

        document.getElementById('recordResultsForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const eventId = parseInt(document.getElementById('resultEventSelect').value);
            const results = {
                '1st': document.getElementById('result1st').value,
                '2nd': document.getElementById('result2nd').value,
                '3rd': document.getElementById('result3rd').value,
                '4th': document.getElementById('result4th').value
            };

            const event = appData.events.find(e => e.id === eventId);
            if (event) {
                event.status = 'completed';
                event.results = results;

                // Award points
                const pointsMap = { '1st': 1, '2nd': 0.5, '3rd': 0.2, '4th': 0.1 };
                Object.entries(results).forEach(([place, house]) => {
                    if (house) {
                        appData.houses[house].points += Math.round(event.points * pointsMap[place]);
                        if (place === '1st') appData.houses[house].eventsWon++;
                    }
                });

                e.target.reset();
                renderAll();
                showToast('Results recorded!', 'success');
            }
        });

        document.getElementById('awardBadgeForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const badgeId = parseInt(document.getElementById('badgeSelect').value);
            const house = document.getElementById('badgeHouse').value;

            const badge = appData.badges.find(b => b.id === badgeId);
            if (badge && house) {
                const currentEarned = Object.keys(badge.earnedBy).length;
                if (!badge.earnedBy[house]) {
                    badge.earnedBy[house] = currentEarned + 1;
                    
                    // Award points based on position
                    const pointsMap = [10, 5, 2, 1];
                    let basePoints = pointsMap[currentEarned] || 1;
                    
                    // Apply streak bonus if first place
                    let streakBonus = 0;
                    if (currentEarned === 0) {
                        // This house got first place - increase their streak
                        appData.houses[house].streak++;
                        streakBonus = Math.round(basePoints * (getStreakBonus(appData.houses[house].streak) / 100));
                        
                        // Reset other houses' streaks for this badge type (if they were on a streak)
                        // In a real app, you'd track this per badge category
                    }
                    
                    const totalPoints = basePoints + streakBonus;
                    appData.houses[house].points += totalPoints;
                    appData.houses[house].badgesEarned++;
                    appData.houses[house].weeklyActivity.badges++;
                    appData.houses[house].weeklyActivity.points += totalPoints;

                    e.target.reset();
                    renderAll();
                    
                    const streakMsg = streakBonus > 0 ? ` (includes +${streakBonus} streak bonus!)` : '';
                    showToast(`Badge awarded to ${appData.houses[house].name}! +${totalPoints} pts${streakMsg}`, 'success');
                } else {
                    showToast('This house already has this badge!', 'error');
                }
            }
        });

        // Toggle spirit points field based on post type
        document.getElementById('feedPostType').addEventListener('change', (e) => {
            const spiritGroup = document.getElementById('spiritPointsGroup');
            spiritGroup.style.display = e.target.value === 'spirit' ? 'block' : 'none';
        });

        // Post to feed form
        document.getElementById('postFeedForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const type = document.getElementById('feedPostType').value;
            const house = document.getElementById('feedPostHouse').value;
            const content = document.getElementById('feedPostContent').value;
            const spiritPoints = type === 'spirit' ? parseInt(document.getElementById('feedSpiritPoints').value) : 0;

            const newPost = {
                id: Date.now(),
                type: type,
                house: house,
                content: content,
                points: spiritPoints,
                timestamp: new Date()
            };

            appData.feed.unshift(newPost);

            // If spirit points, add them to the house
            if (spiritPoints > 0) {
                appData.houses[house].spiritPoints += spiritPoints;
                // Also add to main points (spirit points contribute to overall)
                appData.houses[house].points += Math.round(spiritPoints * 0.5);
            }

            e.target.reset();
            document.getElementById('spiritPointsGroup').style.display = 'none';
            renderAll();
            renderRecentFeedPosts();
            showToast('Posted to feed!', 'success');
        });

        // Bulk spirit points form
        document.getElementById('bulkSpiritForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const reason = document.getElementById('spiritReason').value;
            const houses = ['shackleton', 'wilson', 'bowen', 'scott'];
            let anyAwarded = false;

            houses.forEach(house => {
                const points = parseInt(document.getElementById(`spirit-${house}`).value) || 0;
                if (points > 0) {
                    appData.houses[house].spiritPoints += points;
                    appData.houses[house].points += Math.round(points * 0.5);
                    anyAwarded = true;

                    // Create feed post for houses with significant spirit points
                    if (points >= 10) {
                        appData.feed.unshift({
                            id: Date.now() + Math.random(),
                            type: 'spirit',
                            house: house,
                            content: `Earned <strong>${points} spirit points</strong> for ${reason}!`,
                            points: points,
                            timestamp: new Date()
                        });
                    }
                }
                document.getElementById(`spirit-${house}`).value = 0;
            });

            if (anyAwarded) {
                document.getElementById('spiritReason').value = '';
                renderAll();
                renderRecentFeedPosts();
                showToast('Spirit points awarded!', 'success');
            } else {
                showToast('Enter points for at least one house', 'error');
            }
        });

        function renderRecentFeedPosts() {
            const container = document.getElementById('recentFeedPosts');
            if (!container) return;
            
            const recentPosts = appData.feed.slice(0, 10);
            container.innerHTML = recentPosts.map(post => `
                <div class="admin-list-item">
                    <div class="admin-list-item-info">
                        <h5>${appData.houses[post.house].icon} ${appData.houses[post.house].name} - ${getFeedTypeLabel(post.type)}</h5>
                        <span>${post.content.replace(/<[^>]*>/g, '').substring(0, 50)}...</span>
                    </div>
                    <div class="admin-list-actions">
                        <button class="btn btn-danger" onclick="deleteFeedPost(${post.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteFeedPost(id) {
            if (confirm('Delete this feed post?')) {
                appData.feed = appData.feed.filter(p => p.id !== id);
                renderAll();
                renderRecentFeedPosts();
                showToast('Post deleted', 'info');
            }
        }

        // Badge Hunt form handlers
        document.getElementById('createHuntForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const newHunt = {
                id: Date.now(),
                name: document.getElementById('huntName').value,
                description: document.getElementById('huntDescription').value,
                category: document.getElementById('huntCategory').value,
                targetBadges: parseInt(document.getElementById('huntTarget').value),
                bonusPoints: parseInt(document.getElementById('huntBonus').value),
                startDate: new Date(document.getElementById('huntStartDate').value),
                endDate: new Date(document.getElementById('huntEndDate').value),
                active: true,
                progress: { shackleton: 0, wilson: 0, bowen: 0, scott: 0 }
            };

            appData.badgeHunts.push(newHunt);
            e.target.reset();
            renderAll();
            renderAdminHuntsList();
            populateHuntSelect();
            showToast('Badge Hunt created!', 'success');
        });

        document.getElementById('updateHuntProgressForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const huntId = parseInt(document.getElementById('huntSelect').value);
            const hunt = appData.badgeHunts.find(h => h.id === huntId);
            
            if (hunt) {
                ['shackleton', 'wilson', 'bowen', 'scott'].forEach(house => {
                    hunt.progress[house] = parseInt(document.getElementById(`hunt-progress-${house}`).value) || 0;
                    
                    // Check if house completed the hunt
                    if (hunt.progress[house] >= hunt.targetBadges) {
                        // Award bonus points (only once per house, track this)
                        if (!hunt.completedBy) hunt.completedBy = [];
                        if (!hunt.completedBy.includes(house)) {
                            hunt.completedBy.push(house);
                            appData.houses[house].points += hunt.bonusPoints;
                            
                            // Post to feed
                            appData.feed.unshift({
                                id: Date.now(),
                                type: 'badge',
                                house: house,
                                content: `Completed the <strong>${hunt.name}</strong> badge hunt! üéØ`,
                                points: hunt.bonusPoints,
                                timestamp: new Date()
                            });
                            
                            showToast(`${appData.houses[house].name} completed the hunt! +${hunt.bonusPoints} pts`, 'success');
                        }
                    }
                });
                
                renderAll();
                showToast('Hunt progress updated!', 'success');
            }
        });

        document.getElementById('huntSelect').addEventListener('change', (e) => {
            const huntId = parseInt(e.target.value);
            const hunt = appData.badgeHunts.find(h => h.id === huntId);
            
            if (hunt) {
                ['shackleton', 'wilson', 'bowen', 'scott'].forEach(house => {
                    document.getElementById(`hunt-progress-${house}`).value = hunt.progress[house];
                });
            }
        });

        function renderAdminHuntsList() {
            const container = document.getElementById('adminHuntsList');
            if (!container) return;
            
            container.innerHTML = appData.badgeHunts.map(hunt => `
                <div class="admin-list-item">
                    <div class="admin-list-item-info">
                        <h5>üéØ ${hunt.name}</h5>
                        <span>${hunt.category} ‚Ä¢ ${hunt.targetBadges} badges ‚Ä¢ +${hunt.bonusPoints} pts</span>
                    </div>
                    <div class="admin-list-actions">
                        <button class="btn btn-danger" onclick="deleteHunt(${hunt.id})">Delete</button>
                    </div>
                </div>
            `).join('') || '<p style="color: var(--text-muted);">No badge hunts created yet.</p>';
        }

        function populateHuntSelect() {
            const select = document.getElementById('huntSelect');
            if (!select) return;
            
            select.innerHTML = '<option value="">Choose a hunt...</option>' +
                appData.badgeHunts.map(h => `<option value="${h.id}">${h.name}</option>`).join('');
        }

        function deleteHunt(id) {
            if (confirm('Delete this badge hunt?')) {
                appData.badgeHunts = appData.badgeHunts.filter(h => h.id !== id);
                renderAll();
                renderAdminHuntsList();
                populateHuntSelect();
                showToast('Hunt deleted', 'info');
            }
        }

        function deleteEvent(id) {
            if (confirm('Are you sure you want to delete this event?')) {
                appData.events = appData.events.filter(e => e.id !== id);
                renderAll();
                showToast('Event deleted', 'info');
            }
        }

        function editEvent(id) {
            const event = appData.events.find(e => e.id === id);
            if (event) {
                document.getElementById('eventName').value = event.name;
                document.getElementById('eventDate').value = event.date;
                document.getElementById('eventTime').value = event.time;
                document.getElementById('eventDescription').value = event.description;
                document.getElementById('eventRules').value = event.rules;
                document.getElementById('eventPoints').value = event.points;
                
                // Remove old event
                appData.events = appData.events.filter(e => e.id !== id);
                showToast('Edit the form and submit to update', 'info');
            }
        }

        function adjustPoints(house, amount) {
            const input = document.getElementById(`${house}-points`);
            input.value = parseInt(input.value || 0) + amount;
        }

        function applyPointsAdjustment() {
            ['shackleton', 'wilson', 'bowen', 'scott'].forEach(house => {
                const input = document.getElementById(`${house}-points`);
                const adjustment = parseInt(input.value) || 0;
                if (adjustment !== 0) {
                    appData.houses[house].points += adjustment;
                    addAuditEntry('points', `Adjusted ${adjustment > 0 ? '+' : ''}${adjustment} points to ${appData.houses[house].name}`, house);
                    input.value = 0;
                }
            });
            renderAll();
            showToast('Points adjusted!', 'success');
        }

        // =====================
        // ANALYTICS FUNCTIONS
        // =====================
        let chartInstances = {};

        function renderAnalytics() {
            // Update overview stats
            const totalPoints = Object.values(appData.houses).reduce((sum, h) => sum + h.points, 0);
            const totalBadges = Object.values(appData.houses).reduce((sum, h) => sum + h.badgesEarned, 0);
            const completedEvents = appData.events.filter(e => e.results).length;
            
            document.getElementById('totalPointsAwarded').textContent = totalPoints.toLocaleString();
            document.getElementById('totalBadgesAwarded').textContent = totalBadges;
            document.getElementById('totalEventsCompleted').textContent = completedEvents;
            document.getElementById('totalFeedPosts').textContent = appData.feed.length;

            // Render charts
            renderPointsTrendChart();
            renderBadgeDistChart();
            renderHouseComparisonChart();
            renderActivitySummary();
        }

        function renderPointsTrendChart() {
            const ctx = document.getElementById('pointsTrendChart');
            if (!ctx) return;

            if (chartInstances.pointsTrend) {
                chartInstances.pointsTrend.destroy();
            }

            chartInstances.pointsTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: appData.weeklyPointsHistory.map(w => w.week),
                    datasets: [
                        {
                            label: 'Shackleton',
                            data: appData.weeklyPointsHistory.map(w => w.shackleton),
                            borderColor: '#3a7bc8',
                            backgroundColor: 'rgba(58, 123, 200, 0.1)',
                            tension: 0.3,
                            fill: false
                        },
                        {
                            label: 'Wilson',
                            data: appData.weeklyPointsHistory.map(w => w.wilson),
                            borderColor: '#2d9d5f',
                            backgroundColor: 'rgba(45, 157, 95, 0.1)',
                            tension: 0.3,
                            fill: false
                        },
                        {
                            label: 'Bowen',
                            data: appData.weeklyPointsHistory.map(w => w.bowen),
                            borderColor: '#c73838',
                            backgroundColor: 'rgba(199, 56, 56, 0.1)',
                            tension: 0.3,
                            fill: false
                        },
                        {
                            label: 'Scott',
                            data: appData.weeklyPointsHistory.map(w => w.scott),
                            borderColor: '#e8b82a',
                            backgroundColor: 'rgba(232, 184, 42, 0.1)',
                            tension: 0.3,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderBadgeDistChart() {
            const ctx = document.getElementById('badgeDistChart');
            if (!ctx) return;

            if (chartInstances.badgeDist) {
                chartInstances.badgeDist.destroy();
            }

            const categories = ['explorer', 'scholar', 'performer', 'champion', 'disciple'];
            const categoryLabels = ['Explorer', 'Scholar', 'Performer', 'Champion', 'Disciple'];
            const categoryColors = ['#2d9d5f', '#3a7bc8', '#a78bfa', '#e8b82a', '#c73838'];

            const data = categories.map(cat => 
                appData.badges.filter(b => b.category === cat && Object.keys(b.earnedBy).length > 0).length
            );

            chartInstances.badgeDist = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categoryLabels,
                    datasets: [{
                        data: data,
                        backgroundColor: categoryColors,
                        borderWidth: 2,
                        borderColor: 'var(--bg-card)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function renderHouseComparisonChart() {
            const ctx = document.getElementById('houseComparisonChart');
            if (!ctx) return;

            if (chartInstances.houseComparison) {
                chartInstances.houseComparison.destroy();
            }

            const houses = ['Shackleton', 'Wilson', 'Bowen', 'Scott'];
            const houseKeys = ['shackleton', 'wilson', 'bowen', 'scott'];
            const houseColors = ['#3a7bc8', '#2d9d5f', '#c73838', '#e8b82a'];

            chartInstances.houseComparison = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: houses,
                    datasets: [
                        {
                            label: 'Points',
                            data: houseKeys.map(h => appData.houses[h].points),
                            backgroundColor: houseColors.map(c => c + '80'),
                            borderColor: houseColors,
                            borderWidth: 2
                        },
                        {
                            label: 'Badges √ó 10',
                            data: houseKeys.map(h => appData.houses[h].badgesEarned * 10),
                            backgroundColor: houseColors.map(c => c + '40'),
                            borderColor: houseColors,
                            borderWidth: 2
                        },
                        {
                            label: 'Spirit Points',
                            data: houseKeys.map(h => appData.houses[h].spiritPoints),
                            backgroundColor: houseColors.map(c => c + '20'),
                            borderColor: houseColors,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderActivitySummary() {
            const container = document.getElementById('activitySummary');
            if (!container) return;

            const recentActivities = [
                ...appData.auditLog.slice(0, 5).map(a => ({
                    icon: a.type === 'points' ? 'üìä' : a.type === 'badges' ? 'üéñÔ∏è' : a.type === 'events' ? 'üèÜ' : a.type === 'feed' ? 'üí¨' : '‚öôÔ∏è',
                    title: a.action,
                    subtitle: `by ${a.user}`,
                    time: formatTimeAgo(a.timestamp)
                }))
            ];

            container.innerHTML = recentActivities.map(a => `
                <div class="activity-item">
                    <div class="activity-item-icon">${a.icon}</div>
                    <div class="activity-item-info">
                        <h5>${a.title}</h5>
                        <p>${a.subtitle}</p>
                    </div>
                    <div class="activity-item-time">${a.time}</div>
                </div>
            `).join('');
        }

        // =====================
        // EXPORT FUNCTIONS
        // =====================
        function exportStandings(format) {
            const housesArray = Object.entries(appData.houses)
                .map(([key, value]) => ({ ...value, key }))
                .sort((a, b) => b.points - a.points);

            if (format === 'csv') {
                let csv = 'Rank,House,Points,Badges,Events Won,Streak,Spirit Points\n';
                housesArray.forEach((h, i) => {
                    csv += `${i + 1},${h.name},${h.points},${h.badgesEarned},${h.eventsWon},${h.streak},${h.spiritPoints}\n`;
                });
                downloadCSV(csv, 'house_standings.csv');
            } else {
                const printContent = `
                    <h1>MGS House Competition - Current Standings</h1>
                    <p>Generated: ${new Date().toLocaleString()}</p>
                    <table border="1" cellpadding="10" style="border-collapse: collapse; width: 100%;">
                        <tr><th>Rank</th><th>House</th><th>Points</th><th>Badges</th><th>Events Won</th><th>Streak</th><th>Spirit Points</th></tr>
                        ${housesArray.map((h, i) => `<tr><td>${i + 1}</td><td>${h.icon} ${h.name}</td><td>${h.points}</td><td>${h.badgesEarned}</td><td>${h.eventsWon}</td><td>${h.streak}</td><td>${h.spiritPoints}</td></tr>`).join('')}
                    </table>
                `;
                printReport(printContent);
            }
            showToast('Report generated!', 'success');
        }

        function exportBadges(format) {
            const earnedBadges = appData.badges.filter(b => Object.keys(b.earnedBy).length > 0);

            if (format === 'csv') {
                let csv = 'Badge Name,Category,1st Place,2nd Place,3rd Place,4th Place\n';
                earnedBadges.forEach(b => {
                    const places = ['shackleton', 'wilson', 'bowen', 'scott'].map(h => {
                        const place = b.earnedBy[h];
                        return place ? appData.houses[h].name : '';
                    });
                    // Sort by placement
                    const sorted = ['', '', '', ''];
                    Object.entries(b.earnedBy).forEach(([house, place]) => {
                        sorted[place - 1] = appData.houses[house].name;
                    });
                    csv += `"${b.name}",${b.category},${sorted.join(',')}\n`;
                });
                downloadCSV(csv, 'badge_awards.csv');
            } else {
                const printContent = `
                    <h1>MGS House Competition - Badge Awards</h1>
                    <p>Generated: ${new Date().toLocaleString()}</p>
                    <p>Total Badges Awarded: ${earnedBadges.length}</p>
                    <table border="1" cellpadding="8" style="border-collapse: collapse; width: 100%;">
                        <tr><th>Badge</th><th>Category</th><th>1st</th><th>2nd</th><th>3rd</th><th>4th</th></tr>
                        ${earnedBadges.map(b => {
                            const sorted = ['', '', '', ''];
                            Object.entries(b.earnedBy).forEach(([house, place]) => {
                                sorted[place - 1] = appData.houses[house].name;
                            });
                            return `<tr><td>${b.emoji} ${b.name}</td><td>${b.category}</td><td>${sorted[0]}</td><td>${sorted[1]}</td><td>${sorted[2]}</td><td>${sorted[3]}</td></tr>`;
                        }).join('')}
                    </table>
                `;
                printReport(printContent);
            }
            showToast('Report generated!', 'success');
        }

        function exportEvents(format) {
            const completedEvents = appData.events.filter(e => e.results);

            if (format === 'csv') {
                let csv = 'Event Name,Date,1st Place,2nd Place,3rd Place,4th Place,Points\n';
                completedEvents.forEach(e => {
                    const results = e.results || {};
                    csv += `"${e.name}",${e.date},${results['1st'] ? appData.houses[results['1st']].name : ''},${results['2nd'] ? appData.houses[results['2nd']].name : ''},${results['3rd'] ? appData.houses[results['3rd']].name : ''},${results['4th'] ? appData.houses[results['4th']].name : ''},${e.points}\n`;
                });
                downloadCSV(csv, 'event_results.csv');
            } else {
                const printContent = `
                    <h1>MGS House Competition - Event Results</h1>
                    <p>Generated: ${new Date().toLocaleString()}</p>
                    <table border="1" cellpadding="8" style="border-collapse: collapse; width: 100%;">
                        <tr><th>Event</th><th>Date</th><th>1st</th><th>2nd</th><th>3rd</th><th>4th</th></tr>
                        ${completedEvents.map(e => {
                            const r = e.results || {};
                            return `<tr><td>${e.name}</td><td>${formatDate(e.date)}</td><td>${r['1st'] ? appData.houses[r['1st']].name : ''}</td><td>${r['2nd'] ? appData.houses[r['2nd']].name : ''}</td><td>${r['3rd'] ? appData.houses[r['3rd']].name : ''}</td><td>${r['4th'] ? appData.houses[r['4th']].name : ''}</td></tr>`;
                        }).join('')}
                    </table>
                `;
                printReport(printContent);
            }
            showToast('Report generated!', 'success');
        }

        function exportAuditLog(format) {
            if (format === 'csv') {
                let csv = 'Date,Time,Type,Action,User,House\n';
                appData.auditLog.forEach(a => {
                    const date = new Date(a.timestamp);
                    csv += `${date.toLocaleDateString()},${date.toLocaleTimeString()},${a.type},"${a.action}",${a.user},${a.house ? appData.houses[a.house].name : 'All'}\n`;
                });
                downloadCSV(csv, 'audit_log.csv');
            } else {
                const printContent = `
                    <h1>MGS House Competition - Audit Log</h1>
                    <p>Generated: ${new Date().toLocaleString()}</p>
                    <table border="1" cellpadding="8" style="border-collapse: collapse; width: 100%;">
                        <tr><th>Date/Time</th><th>Type</th><th>Action</th><th>User</th><th>House</th></tr>
                        ${appData.auditLog.map(a => `<tr><td>${new Date(a.timestamp).toLocaleString()}</td><td>${a.type}</td><td>${a.action}</td><td>${a.user}</td><td>${a.house ? appData.houses[a.house].name : 'All'}</td></tr>`).join('')}
                    </table>
                `;
                printReport(printContent);
            }
            showToast('Report generated!', 'success');
        }

        function exportNewsletter() {
            const housesArray = Object.entries(appData.houses)
                .map(([key, value]) => ({ ...value, key }))
                .sort((a, b) => b.points - a.points);

            const leader = housesArray[0];
            const recentEvents = appData.events.filter(e => e.results).slice(0, 3);

            const content = `
                <div style="font-family: Georgia, serif; max-width: 600px; margin: 0 auto; padding: 20px;">
                    <h1 style="color: #0284c7; text-align: center;">üèÜ House Competition Update</h1>
                    <p style="text-align: center; color: #666;">Middleton Grange School | ${new Date().toLocaleDateString('en-NZ', { month: 'long', year: 'numeric' })}</p>
                    
                    <div style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); padding: 20px; border-radius: 12px; margin: 20px 0;">
                        <h2 style="margin: 0; color: #0369a1;">Current Leader: ${leader.icon} ${leader.name}</h2>
                        <p style="font-size: 24px; font-weight: bold; color: #0284c7; margin: 10px 0;">${leader.points.toLocaleString()} points</p>
                    </div>

                    <h3>üìä Current Standings</h3>
                    <ol style="font-size: 16px;">
                        ${housesArray.map(h => `<li><strong>${h.name}</strong> ‚Äî ${h.points.toLocaleString()} pts (${h.badgesEarned} badges)</li>`).join('')}
                    </ol>

                    ${recentEvents.length > 0 ? `
                        <h3>üèÖ Recent Results</h3>
                        <ul>
                            ${recentEvents.map(e => `<li><strong>${e.name}</strong>: 1st ‚Äî ${appData.houses[e.results['1st']].name}</li>`).join('')}
                        </ul>
                    ` : ''}

                    <p style="text-align: center; margin-top: 30px; color: #666; font-size: 12px;">
                        Go ${housesArray[0].name}! üéâ
                    </p>
                </div>
            `;
            printReport(content);
            showToast('Newsletter summary generated!', 'success');
        }

        function exportAssemblyData() {
            const housesArray = Object.entries(appData.houses)
                .map(([key, value]) => ({ ...value, key }))
                .sort((a, b) => b.points - a.points);

            const content = `
                <div style="font-family: Arial, sans-serif; padding: 40px; text-align: center;">
                    <h1 style="font-size: 48px; color: #0284c7;">House Competition Update</h1>
                    
                    <div style="display: flex; justify-content: center; gap: 30px; margin: 40px 0;">
                        ${housesArray.map((h, i) => `
                            <div style="background: ${i === 0 ? '#fef9c3' : '#f1f5f9'}; padding: 30px; border-radius: 20px; min-width: 200px;">
                                <div style="font-size: 48px;">${h.icon}</div>
                                <h2 style="margin: 10px 0;">${h.name}</h2>
                                <div style="font-size: 36px; font-weight: bold; color: #0284c7;">${h.points.toLocaleString()}</div>
                                <div style="color: #666;">points</div>
                                ${i === 0 ? '<div style="margin-top: 10px; font-size: 24px;">üëë LEADING</div>' : ''}
                            </div>
                        `).join('')}
                    </div>

                    <div style="margin-top: 40px; font-size: 24px; color: #666;">
                        üéñÔ∏è ${Object.values(appData.houses).reduce((sum, h) => sum + h.badgesEarned, 0)} badges awarded | 
                        üèÜ ${appData.events.filter(e => e.results).length} events completed
                    </div>
                </div>
            `;
            printReport(content);
            showToast('Assembly data generated!', 'success');
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        function printReport(content) {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head><title>MGS House Competition Report</title></head>
                <body style="font-family: Arial, sans-serif; padding: 20px;">
                    ${content}
                    <script>window.print();</script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        // =====================
        // SCHEDULED POSTS
        // =====================
        document.getElementById('scheduledPostForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const post = {
                id: Date.now(),
                type: document.getElementById('scheduledPostType').value,
                house: document.getElementById('scheduledPostHouse').value || null,
                content: document.getElementById('scheduledPostContent').value,
                scheduledFor: new Date(`${document.getElementById('scheduledPostDate').value}T${document.getElementById('scheduledPostTime').value}`)
            };

            appData.scheduledPosts.push(post);
            addAuditEntry('feed', `Scheduled ${post.type} post for ${formatDate(post.scheduledFor)}`, post.house);
            e.target.reset();
            renderScheduledPosts();
            showToast('Post scheduled!', 'success');
        });

        function renderScheduledPosts() {
            const container = document.getElementById('scheduledPostsList');
            if (!container) return;

            const upcoming = appData.scheduledPosts
                .filter(p => new Date(p.scheduledFor) > new Date())
                .sort((a, b) => new Date(a.scheduledFor) - new Date(b.scheduledFor));

            container.innerHTML = `
                <h5 style="margin-top: 1.5rem;">Upcoming Scheduled Posts</h5>
                ${upcoming.length > 0 ? upcoming.map(p => `
                    <div class="scheduled-post-item">
                        <div class="scheduled-post-time">
                            ${new Date(p.scheduledFor).toLocaleDateString('en-NZ', { day: 'numeric', month: 'short' })}<br>
                            ${new Date(p.scheduledFor).toLocaleTimeString('en-NZ', { hour: '2-digit', minute: '2-digit' })}
                        </div>
                        <div class="scheduled-post-content">
                            <strong>${p.type === 'announcement' ? 'üì¢' : p.type === 'reminder' ? '‚è∞' : '‚≠ê'}</strong>
                            ${p.content.substring(0, 60)}${p.content.length > 60 ? '...' : ''}
                            ${p.house ? `<span style="color: var(--text-muted);"> (${appData.houses[p.house].name})</span>` : ''}
                        </div>
                        <button class="btn btn-danger btn-sm" onclick="deleteScheduledPost(${p.id})">‚úï</button>
                    </div>
                `).join('') : '<p style="color: var(--text-muted); padding: 1rem;">No scheduled posts.</p>'}
            `;
        }

        function deleteScheduledPost(id) {
            appData.scheduledPosts = appData.scheduledPosts.filter(p => p.id !== id);
            renderScheduledPosts();
            showToast('Scheduled post deleted', 'info');
        }

        // =====================
        // ADMIN ROLES
        // =====================
        document.getElementById('addAdminForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const name = document.getElementById('newAdminName').value;
            const role = document.getElementById('newAdminRole').value;
            const house = document.getElementById('newAdminHouse').value || null;
            
            const initials = name.split(' ').map(n => n[0]).join('').toUpperCase();

            appData.adminRoles.push({
                id: Date.now(),
                name,
                role,
                house,
                initials
            });

            addAuditEntry('admin', `Added new admin: ${name} (${role === 'super' ? 'Super Admin' : role === 'house' ? 'House Captain' : 'Viewer'})`, house);
            e.target.reset();
            renderAdminRoles();
            showToast('Admin added!', 'success');
        });

        function renderAdminRoles() {
            const container = document.getElementById('adminRolesList');
            if (!container) return;

            container.innerHTML = appData.adminRoles.map(admin => `
                <div class="admin-role-item">
                    <div class="admin-role-avatar" style="background: ${admin.role === 'super' ? '#9b59b6' : admin.house ? `var(--${admin.house}-light)` : 'var(--accent-ice)'};">${admin.initials}</div>
                    <div class="admin-role-info">
                        <h5>${admin.name}</h5>
                        <span class="admin-role-badge ${admin.role}">${admin.role === 'super' ? 'üëë Super Admin' : admin.role === 'house' ? `üè† ${appData.houses[admin.house]?.name || ''} Captain` : 'üëÅÔ∏è Viewer'}</span>
                    </div>
                    ${admin.role !== 'super' ? `<button class="btn btn-danger btn-sm" onclick="removeAdmin(${admin.id})">Remove</button>` : ''}
                </div>
            `).join('');
        }

        function removeAdmin(id) {
            const admin = appData.adminRoles.find(a => a.id === id);
            if (confirm(`Remove ${admin.name} as admin?`)) {
                appData.adminRoles = appData.adminRoles.filter(a => a.id !== id);
                addAuditEntry('admin', `Removed admin: ${admin.name}`, null);
                renderAdminRoles();
                showToast('Admin removed', 'info');
            }
        }

        // =====================
        // AUDIT LOG
        // =====================
        function addAuditEntry(type, action, house) {
            appData.auditLog.unshift({
                id: Date.now(),
                type,
                action,
                user: 'Current Admin', // Would be actual user in production
                house,
                timestamp: new Date()
            });
        }

        function renderAuditLog(filterType = 'all', filterHouse = 'all') {
            const container = document.getElementById('auditLog');
            if (!container) return;

            let entries = [...appData.auditLog];

            if (filterType !== 'all') {
                entries = entries.filter(e => e.type === filterType);
            }
            if (filterHouse !== 'all') {
                entries = entries.filter(e => e.house === filterHouse || e.house === null);
            }

            container.innerHTML = entries.slice(0, 50).map(entry => `
                <div class="audit-entry">
                    <div class="audit-icon ${entry.type}">
                        ${entry.type === 'points' ? 'üìä' : entry.type === 'badges' ? 'üéñÔ∏è' : entry.type === 'events' ? 'üèÜ' : entry.type === 'feed' ? 'üí¨' : '‚öôÔ∏è'}
                    </div>
                    <div class="audit-content">
                        <p>${entry.action}</p>
                        <div class="audit-meta">
                            ${entry.user} ‚Ä¢ ${formatTimeAgo(entry.timestamp)}
                            ${entry.house ? ` ‚Ä¢ ${appData.houses[entry.house].name}` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterAuditLog() {
            const type = document.getElementById('auditFilterType').value;
            const house = document.getElementById('auditFilterHouse').value;
            renderAuditLog(type, house);
        }

        // =====================
        // SETTINGS FUNCTIONS
        // =====================
        function confirmReset() {
            if (confirm('‚ö†Ô∏è WARNING: This will reset ALL points, badges, and results. This cannot be undone. Are you absolutely sure?')) {
                if (confirm('FINAL CONFIRMATION: Type "RESET" in your mind and click OK to proceed.')) {
                    // Reset all data
                    Object.keys(appData.houses).forEach(house => {
                        appData.houses[house].points = 0;
                        appData.houses[house].badgesEarned = 0;
                        appData.houses[house].eventsWon = 0;
                        appData.houses[house].streak = 0;
                        appData.houses[house].spiritPoints = 0;
                    });
                    appData.events.forEach(e => delete e.results);
                    appData.badges.forEach(b => b.earnedBy = {});
                    appData.feed = [];
                    addAuditEntry('admin', 'COMPETITION RESET - All data cleared', null);
                    renderAll();
                    showToast('Competition has been reset', 'success');
                }
            }
        }

        function archiveYear() {
            const archiveData = JSON.stringify(appData, null, 2);
            const blob = new Blob([archiveData], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `mgs_house_competition_archive_${new Date().getFullYear()}.json`;
            link.click();
            addAuditEntry('admin', 'Archived competition data', null);
            showToast('Archive downloaded!', 'success');
        }

        // =====================
        // COMMUNITY PAGE FUNCTIONS
        // =====================
        
        // Render newsletter widget previews
        function renderWidgetPreviews() {
            renderStandingsWidget();
            renderMiniLeaderboardWidget();
            renderHOTWWidget();
            renderPhotoGallery();
        }

        function renderStandingsWidget() {
            const container = document.getElementById('standingsWidgetPreview');
            if (!container) return;

            const housesArray = Object.entries(appData.houses)
                .map(([key, value]) => ({ ...value, key }))
                .sort((a, b) => b.points - a.points);

            container.innerHTML = `
                <div style="font-weight: 700; font-size: 0.9rem; margin-bottom: 0.75rem; text-align: center;">üèÜ House Standings</div>
                ${housesArray.map((house, index) => `
                    <div class="widget-standings-row">
                        <span class="widget-rank">${index + 1}</span>
                        <span class="widget-house-icon">${house.icon}</span>
                        <span class="widget-house-name">${house.name}</span>
                        <span class="widget-house-points">${house.points.toLocaleString()}</span>
                    </div>
                `).join('')}
            `;
        }

        function renderMiniLeaderboardWidget() {
            const container = document.getElementById('miniLeaderboardPreview');
            if (!container) return;

            const housesArray = Object.entries(appData.houses)
                .map(([key, value]) => ({ ...value, key }))
                .sort((a, b) => b.points - a.points);

            container.innerHTML = `
                <div style="font-size: 0.8rem; text-align: center; margin-bottom: 0.5rem;">MGS House Competition</div>
                ${housesArray.slice(0, 4).map((house, index) => `
                    <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.25rem; font-size: 0.85rem;">
                        <span style="font-weight: 700; color: var(--text-muted);">${index + 1}</span>
                        <span>${house.icon}</span>
                        <span style="flex: 1;">${house.name}</span>
                        <span style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">${house.points}</span>
                    </div>
                `).join('')}
            `;
        }

        function renderHOTWWidget() {
            const container = document.getElementById('hotwBadgePreview');
            if (!container) return;

            const housesArray = Object.entries(appData.houses)
                .map(([key, value]) => ({ ...value, key }))
                .sort((a, b) => (b.weeklyActivity?.points || 0) - (a.weeklyActivity?.points || 0));
            const winner = housesArray[0];

            container.innerHTML = `
                <div class="widget-hotw">
                    <div class="widget-hotw-icon">${winner.icon}</div>
                    <div class="widget-hotw-label">House of the Week</div>
                    <div class="widget-hotw-house">${winner.name}</div>
                </div>
            `;
        }

        function copyWidgetCode(textareaId) {
            const textarea = document.getElementById(textareaId);
            textarea.select();
            document.execCommand('copy');
            showToast('Embed code copied!', 'success');
        }

        // Assembly Mode
        function launchAssemblyMode(mode) {
            const overlay = document.createElement('div');
            overlay.className = 'assembly-fullscreen';
            overlay.id = 'assemblyOverlay';

            const housesArray = Object.entries(appData.houses)
                .map(([key, value]) => ({ ...value, key }))
                .sort((a, b) => b.points - a.points);

            let content = '';

            switch(mode) {
                case 'standings':
                    content = `
                        <button class="assembly-close" onclick="closeAssemblyMode()">‚úï</button>
                        <div class="assembly-content">
                            <h1 class="assembly-title">üèÜ House Competition Standings</h1>
                            <div class="assembly-standings">
                                ${housesArray.map((house, index) => `
                                    <div class="assembly-house-card ${index === 0 ? 'rank-1' : ''}">
                                        <div class="assembly-house-icon">${house.icon}</div>
                                        <div class="assembly-house-name">${house.name}</div>
                                        <div class="assembly-house-points">${house.points.toLocaleString()}</div>
                                        <div class="assembly-house-rank">${getOrdinal(index + 1)} Place</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    break;

                case 'celebration':
                    const winner = housesArray[0];
                    content = `
                        <button class="assembly-close" onclick="closeAssemblyMode()">‚úï</button>
                        <div class="assembly-content assembly-celebration">
                            <h1 class="assembly-title">üéâ Congratulations!</h1>
                            <div class="assembly-house-card rank-1" style="display: inline-block; margin: 2rem auto;">
                                <div style="font-size: 6rem; margin-bottom: 1rem;">üëë</div>
                                <div class="assembly-house-icon">${winner.icon}</div>
                                <div class="assembly-house-name" style="font-size: 3rem;">${winner.name}</div>
                                <div class="assembly-house-points">${winner.points.toLocaleString()} pts</div>
                                <div style="margin-top: 1rem; font-size: 1.5rem;">HOUSE OF THE WEEK!</div>
                            </div>
                        </div>
                    `;
                    // Add confetti
                    setTimeout(() => launchConfetti(), 500);
                    break;

                case 'results':
                    const recentResults = appData.events.filter(e => e.results).slice(-3);
                    content = `
                        <button class="assembly-close" onclick="closeAssemblyMode()">‚úï</button>
                        <div class="assembly-content">
                            <h1 class="assembly-title">üìä Recent Event Results</h1>
                            <div style="display: grid; gap: 2rem; max-width: 800px; margin: 0 auto;">
                                ${recentResults.map(event => `
                                    <div style="background: rgba(255,255,255,0.1); border-radius: 16px; padding: 1.5rem;">
                                        <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 1rem;">${event.name}</h2>
                                        <div style="display: flex; justify-content: center; gap: 2rem;">
                                            ${['1st', '2nd', '3rd', '4th'].map(place => {
                                                const house = event.results[place];
                                                return house ? `
                                                    <div style="text-align: center;">
                                                        <div style="font-size: 2rem;">${appData.houses[house].icon}</div>
                                                        <div style="font-size: 0.9rem; opacity: 0.8;">${place}</div>
                                                    </div>
                                                ` : '';
                                            }).join('')}
                                        </div>
                                    </div>
                                `).join('') || '<p>No recent results</p>'}
                            </div>
                        </div>
                    `;
                    break;

                case 'badges':
                    const recentBadges = appData.badges.filter(b => Object.keys(b.earnedBy).length > 0).slice(0, 6);
                    content = `
                        <button class="assembly-close" onclick="closeAssemblyMode()">‚úï</button>
                        <div class="assembly-content">
                            <h1 class="assembly-title">üéñÔ∏è Recently Awarded Badges</h1>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; max-width: 900px; margin: 0 auto;">
                                ${recentBadges.map(badge => `
                                    <div style="background: rgba(255,255,255,0.1); border-radius: 16px; padding: 1.5rem; text-align: center;">
                                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">${badge.emoji}</div>
                                        <div style="font-weight: 700; margin-bottom: 0.5rem;">${badge.name}</div>
                                        <div style="display: flex; justify-content: center; gap: 0.5rem;">
                                            ${Object.entries(badge.earnedBy).sort((a, b) => a[1] - b[1]).map(([house, place]) => `
                                                <span title="${appData.houses[house].name} - ${place}${['st','nd','rd','th'][place-1] || 'th'}" style="font-size: 1.5rem;">${appData.houses[house].icon}</span>
                                            `).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    break;

                case 'countdown':
                    const nextEvent = appData.events.find(e => !e.results && new Date(e.date) > new Date());
                    content = `
                        <button class="assembly-close" onclick="closeAssemblyMode()">‚úï</button>
                        <div class="assembly-content">
                            <h1 class="assembly-title">‚è±Ô∏è Coming Up Next</h1>
                            ${nextEvent ? `
                                <div style="background: rgba(255,255,255,0.1); border-radius: 20px; padding: 3rem; display: inline-block; margin-top: 2rem;">
                                    <h2 style="font-family: 'Playfair Display', serif; font-size: 2.5rem; margin-bottom: 1rem;">${nextEvent.name}</h2>
                                    <div style="font-size: 1.25rem; opacity: 0.8; margin-bottom: 2rem;">${formatDate(nextEvent.date)} at ${formatTime(nextEvent.time)}</div>
                                    <div id="countdownTimer" style="font-family: 'JetBrains Mono', monospace; font-size: 4rem; font-weight: 700;"></div>
                                    <div style="margin-top: 2rem; font-size: 1.5rem;">üèÜ ${nextEvent.points} points at stake!</div>
                                </div>
                            ` : '<p style="font-size: 1.5rem;">No upcoming events scheduled</p>'}
                        </div>
                    `;
                    if (nextEvent) {
                        setTimeout(() => startCountdown(nextEvent.date, nextEvent.time), 100);
                    }
                    break;

                case 'heritage':
                    const explorers = [
                        { key: 'shackleton', name: 'Sir Ernest Shackleton', dates: '1874-1922', quote: 'By Endurance We Conquer' },
                        { key: 'scott', name: 'Captain Robert Falcon Scott', dates: '1868-1912', quote: 'I do not regret this journey' },
                        { key: 'wilson', name: 'Dr Edward Wilson', dates: '1872-1912', quote: 'The closest friend I\'ve ever had' },
                        { key: 'bowen', name: 'Sir Charles Bowen', dates: '1830-1917', quote: 'Education for all' }
                    ];
                    content = `
                        <button class="assembly-close" onclick="closeAssemblyMode()">‚úï</button>
                        <div class="assembly-content">
                            <h1 class="assembly-title">üèîÔ∏è Our Antarctic Heritage</h1>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; max-width: 1100px; margin: 0 auto;">
                                ${explorers.map(exp => `
                                    <div style="background: rgba(255,255,255,0.1); border-radius: 16px; padding: 1.5rem; text-align: center;">
                                        <div style="font-size: 4rem; margin-bottom: 0.5rem;">${appData.houses[exp.key].icon}</div>
                                        <div style="font-family: 'Playfair Display', serif; font-size: 1.1rem; font-weight: 700;">${exp.name}</div>
                                        <div style="font-size: 0.9rem; opacity: 0.7; margin: 0.5rem 0;">${exp.dates}</div>
                                        <div style="font-style: italic; font-size: 0.85rem; opacity: 0.8;">"${exp.quote}"</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    break;
            }

            overlay.innerHTML = content;
            document.body.appendChild(overlay);
            document.body.style.overflow = 'hidden';

            // ESC key to close
            document.addEventListener('keydown', handleAssemblyKeydown);
        }

        function closeAssemblyMode() {
            const overlay = document.getElementById('assemblyOverlay');
            if (overlay) {
                overlay.remove();
                document.body.style.overflow = '';
                document.removeEventListener('keydown', handleAssemblyKeydown);
            }
        }

        function handleAssemblyKeydown(e) {
            if (e.key === 'Escape') {
                closeAssemblyMode();
            }
        }

        function launchConfetti() {
            const colors = ['#3a7bc8', '#2d9d5f', '#c73838', '#e8b82a', '#a78bfa', '#ffd700'];
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    document.getElementById('assemblyOverlay').appendChild(confetti);
                    setTimeout(() => confetti.remove(), 5000);
                }, i * 30);
            }
        }

        function startCountdown(date, time) {
            const eventDate = new Date(`${date}T${time}`);
            const timer = document.getElementById('countdownTimer');
            
            function update() {
                const now = new Date();
                const diff = eventDate - now;
                
                if (diff <= 0) {
                    timer.innerHTML = 'NOW!';
                    return;
                }
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                timer.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            }
            
            update();
            const interval = setInterval(() => {
                if (!document.getElementById('countdownTimer')) {
                    clearInterval(interval);
                    return;
                }
                update();
            }, 1000);
        }

        function getOrdinal(n) {
            const s = ['th', 'st', 'nd', 'rd'];
            const v = n % 100;
            return n + (s[(v - 20) % 10] || s[v] || s[0]);
        }

        // Photo Gallery
        function renderPhotoGallery(filter = 'all') {
            const container = document.getElementById('photoGallery');
            if (!container) return;

            let photos = appData.photos;
            if (filter !== 'all') {
                photos = photos.filter(p => p.house === filter);
            }

            // Generate placeholder icons based on event type
            const eventIcons = {
                swimming: 'üèä',
                singing: 'üé§',
                athletics: 'üèÉ',
                quiz: 'üß†',
                service: 'ü§ù',
                chapel: '‚õ™',
                arts: 'üé≠',
                default: 'üì∏'
            };

            container.innerHTML = photos.map(photo => `
                <div class="photo-item" onclick="openLightbox(${photo.id})">
                    ${photo.url ? `
                        <img src="${photo.url}" alt="${photo.caption}">
                    ` : `
                        <div class="photo-item-placeholder">
                            <span>${eventIcons[photo.event] || eventIcons.default}</span>
                            <small>${photo.event || 'Event'}</small>
                        </div>
                    `}
                    <div class="photo-overlay">
                        <div class="photo-caption">${photo.caption}</div>
                        ${photo.house ? `<span class="photo-house-tag ${photo.house}">${appData.houses[photo.house].name}</span>` : ''}
                    </div>
                </div>
            `).join('') || '<div class="empty-state"><div class="empty-state-icon">üì∑</div><p>No photos yet</p></div>';
        }

        function openLightbox(photoId) {
            const photo = appData.photos.find(p => p.id === photoId);
            if (!photo) return;

            const eventIcons = {
                swimming: 'üèä', singing: 'üé§', athletics: 'üèÉ', quiz: 'üß†',
                service: 'ü§ù', chapel: '‚õ™', arts: 'üé≠', default: 'üì∏'
            };

            const lightbox = document.createElement('div');
            lightbox.className = 'lightbox';
            lightbox.id = 'photoLightbox';
            lightbox.innerHTML = `
                <button class="lightbox-close" onclick="closeLightbox()">‚úï</button>
                ${photo.url ? `
                    <img src="${photo.url}" alt="${photo.caption}">
                ` : `
                    <div style="font-size: 10rem; color: white;">${eventIcons[photo.event] || eventIcons.default}</div>
                `}
                <div class="lightbox-caption">
                    <h3>${photo.caption}</h3>
                    ${photo.house ? `<p>${appData.houses[photo.house].icon} ${appData.houses[photo.house].name}</p>` : ''}
                </div>
            `;

            document.body.appendChild(lightbox);
            document.body.style.overflow = 'hidden';

            lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox) closeLightbox();
            });
        }

        function closeLightbox() {
            const lightbox = document.getElementById('photoLightbox');
            if (lightbox) {
                lightbox.remove();
                document.body.style.overflow = '';
            }
        }

        // Photo Upload
        function setupPhotoUpload() {
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('photoUpload');
            const uploadForm = document.getElementById('uploadForm');

            if (!uploadZone || !fileInput) return;

            uploadZone.addEventListener('click', () => fileInput.click());

            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });

            fileInput.addEventListener('change', () => {
                handleFiles(fileInput.files);
            });
        }

        let pendingPhotos = [];

        function handleFiles(files) {
            pendingPhotos = Array.from(files).filter(f => f.type.startsWith('image/') && f.size <= 5 * 1024 * 1024);
            
            if (pendingPhotos.length > 0) {
                document.getElementById('uploadForm').style.display = 'block';
                showToast(`${pendingPhotos.length} photo(s) ready to upload`, 'info');
            } else {
                showToast('Please select valid images (max 5MB)', 'warning');
            }
        }

        function submitPhotos() {
            const caption = document.getElementById('photoCaption').value || 'House Event';
            const house = document.getElementById('photoHouse').value || null;

            // In production, this would upload to Firebase Storage
            // For demo, we'll add placeholder entries
            pendingPhotos.forEach(file => {
                appData.photos.unshift({
                    id: Date.now() + Math.random(),
                    caption: caption,
                    house: house,
                    url: null, // Would be Firebase Storage URL
                    event: 'upload',
                    date: new Date().toISOString().split('T')[0]
                });
            });

            showToast(`${pendingPhotos.length} photo(s) uploaded!`, 'success');
            pendingPhotos = [];
            document.getElementById('uploadForm').style.display = 'none';
            document.getElementById('photoCaption').value = '';
            document.getElementById('photoHouse').value = '';
            renderPhotoGallery();
        }

        // Gallery filter event listeners
        function setupGalleryFilters() {
            document.querySelectorAll('[data-gallery-filter]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-gallery-filter]').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderPhotoGallery(btn.dataset.galleryFilter);
                });
            });
        }

        // =====================
        // FAITH & SERVICE FUNCTIONS
        // =====================

        function renderFaithPage() {
            renderKindnessWall();
            renderServiceHours();
            renderServiceLeaders();
            renderMissionTrips();
            renderPrayerBoard();
            renderFaithQuote();
            renderServiceEvents();
        }

        function renderKindnessWall() {
            const container = document.getElementById('kindnessWall');
            if (!container) return;

            container.innerHTML = appData.kindnessWall.map(item => `
                <div class="kindness-card">
                    <div class="kindness-person">
                        <span class="kindness-house-icon">${item.house ? appData.houses[item.house].icon : 'üåü'}</span>
                        <span>${item.person}</span>
                    </div>
                    <div class="kindness-action">${item.action}</div>
                    <div class="kindness-footer">
                        <span class="kindness-from">‚Äî ${item.from || 'Anonymous'}</span>
                        <div class="kindness-reactions">
                            <button class="kindness-reaction" onclick="reactKindness(${item.id}, 'heart')">‚ù§Ô∏è ${item.reactions.heart}</button>
                            <button class="kindness-reaction" onclick="reactKindness(${item.id}, 'pray')">üôè ${item.reactions.pray}</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function reactKindness(id, type) {
            const item = appData.kindnessWall.find(k => k.id === id);
            if (item) {
                item.reactions[type]++;
                renderKindnessWall();
            }
        }

        function renderServiceHours() {
            // Calculate totals
            const totals = Object.values(appData.serviceHours).reduce((acc, h) => ({
                hours: acc.hours + h.hours,
                volunteers: acc.volunteers + h.volunteers,
                projects: acc.projects + h.projects
            }), { hours: 0, volunteers: 0, projects: 0 });

            document.getElementById('totalServiceHours').textContent = totals.hours.toLocaleString();
            document.getElementById('totalVolunteers').textContent = totals.volunteers;
            document.getElementById('totalProjects').textContent = totals.projects;

            // Render house bars
            const barsContainer = document.getElementById('serviceHouseBars');
            if (!barsContainer) return;

            const maxHours = Math.max(...Object.values(appData.serviceHours).map(h => h.hours));

            barsContainer.innerHTML = Object.entries(appData.serviceHours)
                .sort((a, b) => b[1].hours - a[1].hours)
                .map(([key, data]) => `
                    <div class="service-bar-item">
                        <span class="service-bar-icon">${appData.houses[key].icon}</span>
                        <div class="service-bar-track">
                            <div class="service-bar-fill ${key}" style="width: ${(data.hours / maxHours) * 100}%">
                                ${data.hours}h
                            </div>
                        </div>
                    </div>
                `).join('');
        }

        function renderServiceLeaders() {
            const container = document.getElementById('serviceLeaders');
            if (!container) return;

            container.innerHTML = appData.serviceLeaders.map((leader, index) => {
                const rankClass = index === 0 ? 'gold' : (index === 1 ? 'silver' : (index === 2 ? 'bronze' : ''));
                return `
                    <div class="service-leader-row">
                        <span class="service-leader-rank ${rankClass}">${index + 1}</span>
                        <span class="service-leader-name">${leader.name}</span>
                        <span class="service-leader-house">${appData.houses[leader.house].icon}</span>
                        <span class="service-leader-hours">${leader.hours}h</span>
                    </div>
                `;
            }).join('');
        }

        function renderMissionTrips() {
            const container = document.getElementById('missionTrips');
            if (!container) return;

            container.innerHTML = appData.missionTrips.map(trip => `
                <div class="mission-card ${trip.status}">
                    <div class="mission-icon">${trip.icon}</div>
                    <div class="mission-info">
                        <div class="mission-name">${trip.name}</div>
                        <div class="mission-location">üìç ${trip.location}</div>
                        <div class="mission-dates">${trip.dates}</div>
                        ${trip.goal ? `
                            <div class="mission-progress">
                                <div class="mission-progress-label">
                                    <span>$${trip.raised.toLocaleString()} raised</span>
                                    <span>Goal: $${trip.goal.toLocaleString()}</span>
                                </div>
                                <div class="mission-progress-bar">
                                    <div class="mission-progress-fill" style="width: ${Math.min((trip.raised / trip.goal) * 100, 100)}%"></div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function renderPrayerBoard(filter = 'all') {
            const container = document.getElementById('prayerBoard');
            if (!container) return;

            let prayers = appData.prayerBoard;
            if (filter !== 'all') {
                prayers = prayers.filter(p => p.type === filter);
            }

            const typeIcons = {
                prayer: 'üôè',
                praise: 'üéâ',
                encouragement: 'üí™'
            };

            container.innerHTML = prayers.map(item => `
                <div class="prayer-item ${item.type}">
                    <span class="prayer-type-icon">${typeIcons[item.type]}</span>
                    <div class="prayer-message">${item.message}</div>
                    <div class="prayer-footer">
                        <span>‚Äî ${item.name || 'Anonymous'} ‚Ä¢ ${formatTimeAgo(item.date)}</span>
                        <div class="prayer-actions">
                            <button class="prayer-action ${item.prayedCount > 0 ? 'prayed' : ''}" onclick="prayForItem(${item.id})">
                                üôè ${item.prayedCount} prayed
                            </button>
                        </div>
                    </div>
                </div>
            `).join('') || '<div class="empty-state"><p>No items yet</p></div>';
        }

        function prayForItem(id) {
            const item = appData.prayerBoard.find(p => p.id === id);
            if (item) {
                item.prayedCount++;
                renderPrayerBoard();
                showToast('Thank you for praying! üôè', 'success');
            }
        }

        function renderFaithQuote() {
            const container = document.getElementById('faithQuote');
            if (!container) return;

            // Get quote based on day of year for consistency
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 86400000);
            const quote = appData.faithQuotes[dayOfYear % appData.faithQuotes.length];

            container.innerHTML = `
                <div class="faith-quote-text">${quote.text}</div>
                <div class="faith-quote-reference">‚Äî ${quote.reference}</div>
            `;
        }

        function renderServiceEvents() {
            const container = document.getElementById('serviceEvents');
            if (!container) return;

            container.innerHTML = appData.serviceEvents.map(event => {
                const eventDate = new Date(event.date);
                return `
                    <div class="service-event-card">
                        <div class="service-event-date">
                            <div class="service-event-day">${eventDate.getDate()}</div>
                            <div class="service-event-month">${eventDate.toLocaleString('en', { month: 'short' })}</div>
                        </div>
                        <div class="service-event-info">
                            <h5>${event.name}</h5>
                            <p>üìç ${event.location}</p>
                            <p>${event.description}</p>
                            <span class="service-event-spots">${event.spots} spots available</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Kindness Modal
        function openKindnessModal() {
            document.getElementById('kindnessModal').classList.add('active');
        }

        function closeKindnessModal() {
            document.getElementById('kindnessModal').classList.remove('active');
            document.getElementById('kindnessForm').reset();
        }

        document.getElementById('kindnessForm')?.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const newKindness = {
                id: Date.now(),
                person: document.getElementById('kindnessPerson').value,
                house: document.getElementById('kindnessHouse').value || null,
                action: document.getElementById('kindnessAction').value,
                from: document.getElementById('kindnessFrom').value || 'Anonymous',
                date: new Date(),
                reactions: { heart: 0, pray: 0 }
            };

            appData.kindnessWall.unshift(newKindness);
            closeKindnessModal();
            renderKindnessWall();
            showToast('Kindness shared! üíù', 'success');

            // Award spirit points
            if (newKindness.house) {
                appData.houses[newKindness.house].spiritPoints += 2;
            }
        });

        // Prayer Modal
        function openPrayerModal() {
            document.getElementById('prayerModal').classList.add('active');
        }

        function closePrayerModal() {
            document.getElementById('prayerModal').classList.remove('active');
            document.getElementById('prayerForm').reset();
        }

        document.getElementById('prayerForm')?.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const newPrayer = {
                id: Date.now(),
                type: document.getElementById('prayerType').value,
                message: document.getElementById('prayerMessage').value,
                name: document.getElementById('prayerName').value || 'Anonymous',
                date: new Date(),
                prayedCount: 0
            };

            appData.prayerBoard.unshift(newPrayer);
            closePrayerModal();
            renderPrayerBoard();
            
            const messages = {
                prayer: 'Prayer request shared üôè',
                praise: 'Praise report shared! üéâ',
                encouragement: 'Encouragement posted! üí™'
            };
            showToast(messages[newPrayer.type], 'success');
        });

        // Prayer filter listeners
        function setupPrayerFilters() {
            document.querySelectorAll('[data-prayer-filter]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-prayer-filter]').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderPrayerBoard(btn.dataset.prayerFilter);
                });
            });
        }

        // =====================
        // FILTER BADGES
        // =====================
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderBadges(btn.dataset.filter);
            });
        });

        // =====================
        // FILTER FEED
        // =====================
        document.querySelectorAll('.feed-filter').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.feed-filter').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderFeed(btn.dataset.feedFilter);
            });
        });

        // =====================
        // UTILITIES
        // =====================
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-NZ', { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' });
        }

        function formatTime(timeStr) {
            const [hours, minutes] = timeStr.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span>${message}</span>`;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function renderAll() {
            renderHouseOfTheWeek();
            renderStandings();
            renderEvents('upcomingEventsPreview', 'upcoming', 3);
            renderEvents('upcomingEventsFull', 'upcoming');
            renderEvents('resultsGrid', 'completed');
            renderBadges();
            renderBadgeHunts();
            renderTierProgress();
            renderHouseProfiles();
            renderRecords();
            renderAnniversaries();
            renderHeritageSpotlight();
            renderLeaderboard();
            renderFeed();
            renderSpiritPoints();
            renderTopParticipants();
            renderAdminEventsList();
            renderAdminHuntsList();
            renderRecentFeedPosts();
            renderAnalytics();
            renderScheduledPosts();
            renderAdminRoles();
            renderAuditLog();
            renderWidgetPreviews();
            renderFaithPage();
            populateEventSelect();
            populateBadgeSelect();
            populateHuntSelect();
        }

        // =====================
        // INITIALIZE
        // =====================
        renderAll();
        setupPhotoUpload();
        setupGalleryFilters();
        setupPrayerFilters();
    </script>
</body>
</html>
